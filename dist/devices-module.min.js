var DevicesModule=function(e,t,r,n,i,a,c,o,u,s,d,p,l,f,h,E,v,m,g){"use strict";function T(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function y(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var R,w,N,I,b,A,D,k,O=T(n),_=y(i),S=T(a),x=T(c),C=T(o),P=T(u),G=T(s),M=T(p),H=y(l),L=y(f),U=y(h),F=y(E),Y=y(v),j=y(m),V=y(g);function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t,r,n,i,a,c){try{var o=e[a](c),u=o.value}catch(e){return void r(e)}o.done?t(u):Promise.resolve(u).then(n,i)}function z(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function c(e){q(a,n,i,c,o,"next",e)}function o(e){q(a,n,i,c,o,"throw",e)}c(void 0)}))}}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Z(e,t,r){return t&&$(e.prototype,t),r&&$(e,r),e}function J(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function W(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ee(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function te(e,t,r){return(te=ee()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&X(i,r.prototype),i}).apply(null,arguments)}function re(e){var t="function"==typeof Map?new Map:void 0;return(re=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return te(e,arguments,Q(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),X(n,e)})(e)}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ie(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?ne(e):t}function ae(e){var t=ee();return function(){var r,n=Q(e);if(t){var i=Q(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return ie(this,r)}}function ce(e){return function(e){if(Array.isArray(e))return oe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return oe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oe(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}!function(e){e.FETCHING="fetching",e.GETTING="getting",e.CREATING="creating",e.UPDATING="updating",e.DELETING="deleting"}(R||(R={})),function(e){e.DEVICE="devices-module/device"}(w||(w={})),function(e){e[e.CHAR=t.DataType.CHAR]="CHAR",e[e.UNSIGNED_CHAR=t.DataType.UCHAR]="UNSIGNED_CHAR",e[e.SHORT=t.DataType.SHORT]="SHORT",e[e.UNSIGNED_SHORT=t.DataType.USHORT]="UNSIGNED_SHORT",e[e.INT=t.DataType.INT]="INT",e[e.UNSIGNED_INT=t.DataType.UINT]="UNSIGNED_INT",e[e.FLOAT=t.DataType.FLOAT]="FLOAT"}(N||(N={})),function(e){e[e.CHAR=t.DataType.CHAR]="CHAR",e[e.UNSIGNED_CHAR=t.DataType.UCHAR]="UNSIGNED_CHAR",e[e.SHORT=t.DataType.SHORT]="SHORT",e[e.UNSIGNED_SHORT=t.DataType.USHORT]="UNSIGNED_SHORT",e[e.INT=t.DataType.INT]="INT",e[e.UNSIGNED_INT=t.DataType.UINT]="UNSIGNED_INT"}(I||(I={})),function(e){e.SENDING="sending",e.COMPLETED="completed"}(b||(b={})),function(e){e.OK="ok",e.ERR="err"}(A||(A={})),function(e){e.SENSOR="sensor",e.AIR_QUALITY="air_quality",e.LIGHT_LEVEL="light_level",e.NOISE_LEVEL="noise_level",e.TEMPERATURE="temperature",e.HUMIDITY="humidity"}(D||(D={})),function(e){e.ACTOR="actor",e.SWITCH="switch"}(k||(k={}));var ue,se,de=function(e){W(n,e);var r=ae(n);function n(){var e;B(this,n);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return J(ne(e=r.call.apply(r,[this].concat(i))),"id",void 0),J(ne(e),"key",void 0),J(ne(e),"identifier",void 0),J(ne(e),"name",void 0),J(ne(e),"settable",void 0),J(ne(e),"queryable",void 0),J(ne(e),"dataType",void 0),J(ne(e),"unit",void 0),J(ne(e),"format",void 0),J(ne(e),"value",void 0),J(ne(e),"expected",void 0),J(ne(e),"pending",void 0),J(ne(e),"command",void 0),J(ne(e),"lastResult",void 0),J(ne(e),"backup",void 0),J(ne(e),"relationshipNames",void 0),J(ne(e),"device",void 0),e}return Z(n,[{key:"isAnalogSensor",get:function(){return!this.isSettable&&Object.values(N).includes(this.dataType)}},{key:"isBinarySensor",get:function(){return!this.isSettable&&[t.DataType.BOOLEAN].includes(this.dataType)}},{key:"isAnalogActor",get:function(){return this.isSettable&&Object.values(N).includes(this.dataType)}},{key:"isBinaryActor",get:function(){return this.isSettable&&[t.DataType.BOOLEAN].includes(this.dataType)}},{key:"isSwitch",get:function(){return"switch"===this.identifier}},{key:"isInteger",get:function(){return Object.values(I).includes(this.dataType)}},{key:"isFloat",get:function(){return this.dataType===t.DataType.FLOAT}},{key:"isNumber",get:function(){return Object.values(N).includes(this.dataType)}},{key:"isBoolean",get:function(){return this.dataType===t.DataType.BOOLEAN}},{key:"isString",get:function(){return this.dataType===t.DataType.STRING}},{key:"isEnum",get:function(){return this.dataType===t.DataType.ENUM}},{key:"isColor",get:function(){return this.dataType===t.DataType.COLOR}},{key:"isSettable",get:function(){return this.settable}},{key:"isQueryable",get:function(){return this.queryable}},{key:"binaryValue",get:function(){return null!==this.value&&(this.isBoolean?"boolean"==typeof this.value?this.value:["true","1","t","y","yes"].includes(this.value.toString().toLocaleLowerCase()):!!this.isEnum&&"on"===this.value)}},{key:"binaryExpected",get:function(){return null===this.expected?null:this.isBoolean?"boolean"==typeof this.expected?this.expected:["true","1","t","y","yes"].includes(this.expected.toString().toLocaleLowerCase()):!!this.isEnum&&"on"===this.expected}},{key:"analogValue",get:function(){return this.formattedValue}},{key:"analogExpected",get:function(){return null===this.expected?null:this.formattedValue}},{key:"formattedValue",get:function(){var e,t,r,n=parseFloat(this.value),i="".concat(n).replace(/[^0-9+\-Ee.]/g,""),a=isFinite(+i)?+i:0,c=isFinite(2)?Math.abs(2):0,o=(c?(e=a,t=c,r=Math.pow(10,t),"".concat(Math.round(e*r)/r)):"".concat(Math.round(a))).split(".");return o[0].length>3&&(o[0]=o[0].replace(/\B(?=(?:\d{3})+(?!\d))/g," ")),(o[1]||"").length<c&&(o[1]=o[1]||"",o[1]+=new Array(c-o[1].length+1).join("0")),o.join(",")}},{key:"icon",get:function(){switch(this.identifier){case"temperature":return"thermometer-half";case"humidity":return"tint";case"air_quality":return"fan";case"light_level":return"sun";case"noise_level":return"microphone-alt";case"power":return"plug";case"current":case"voltage":return"bolt";case"energy":return"calculator"}return"chart-bar"}}],[{key:"fields",value:function(){return{id:this.string(""),key:this.string(""),identifier:this.string(""),name:this.string(null).nullable(),settable:this.boolean(!1),queryable:this.boolean(!1),dataType:this.string(""),unit:this.string(null).nullable(),format:this.string(null).nullable(),value:this.attr(null).nullable(),expected:this.attr(null).nullable(),pending:this.boolean(!1),relationshipNames:this.attr([])}}}]),n}(r.Model);!function(e){e.FETCHING="fetching",e.GETTING="getting",e.CREATING="creating",e.UPDATING="updating",e.DELETING="deleting"}(ue||(ue={})),function(e){e.PROPERTY="devices-module/device-property"}(se||(se={}));var pe,le,fe,he,Ee=function(e){W(a,e);var t,r,n,i=ae(a);function a(){var e;B(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return J(ne(e=i.call.apply(i,[this].concat(r))),"type",void 0),J(ne(e),"device",void 0),J(ne(e),"deviceBackward",void 0),J(ne(e),"deviceId",void 0),e}return Z(a,[{key:"title",get:function(){return null!==this.name?this.name:O.default(this.identifier)}}],[{key:"entity",get:function(){return"device_property"}},{key:"fields",value:function(){return Object.assign(de.fields(),{type:this.string(se.PROPERTY),device:this.belongsTo(Se,"id"),deviceBackward:this.hasOne(Se,"id","deviceId"),deviceId:this.string("")})}},{key:"get",value:(n=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("get",{device:t,id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetch",value:(r=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("fetch",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"edit",value:(t=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("edit",{property:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"transmitData",value:function(e,t){return a.dispatch("transmitData",{property:e,value:t})}},{key:"reset",value:function(){a.dispatch("reset")}}]),a}(de);!function(e){e.FETCHING="fetching",e.GETTING="getting",e.CREATING="creating",e.UPDATING="updating",e.DELETING="deleting"}(pe||(pe={})),function(e){e.CONFIGURATION="devices-module/device-configuration"}(le||(le={})),function(e){e[e.CHAR=t.DataType.CHAR]="CHAR",e[e.UNSIGNED_CHAR=t.DataType.UCHAR]="UNSIGNED_CHAR",e[e.SHORT=t.DataType.SHORT]="SHORT",e[e.UNSIGNED_SHORT=t.DataType.USHORT]="UNSIGNED_SHORT",e[e.INT=t.DataType.INT]="INT",e[e.UNSIGNED_INT=t.DataType.UINT]="UNSIGNED_INT",e[e.FLOAT=t.DataType.FLOAT]="FLOAT"}(fe||(fe={})),function(e){e[e.CHAR=t.DataType.CHAR]="CHAR",e[e.UNSIGNED_CHAR=t.DataType.UCHAR]="UNSIGNED_CHAR",e[e.SHORT=t.DataType.SHORT]="SHORT",e[e.UNSIGNED_SHORT=t.DataType.USHORT]="UNSIGNED_SHORT",e[e.INT=t.DataType.INT]="INT",e[e.UNSIGNED_INT=t.DataType.UINT]="UNSIGNED_INT"}(he||(he={}));var ve,me,ge,Te,ye=function(e){W(n,e);var r=ae(n);function n(){var e;B(this,n);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return J(ne(e=r.call.apply(r,[this].concat(i))),"id",void 0),J(ne(e),"key",void 0),J(ne(e),"identifier",void 0),J(ne(e),"name",void 0),J(ne(e),"comment",void 0),J(ne(e),"value",void 0),J(ne(e),"default",void 0),J(ne(e),"dataType",void 0),J(ne(e),"min",void 0),J(ne(e),"max",void 0),J(ne(e),"step",void 0),J(ne(e),"values",void 0),J(ne(e),"relationshipNames",void 0),e}return Z(n,[{key:"isInteger",get:function(){return Object.values(he).includes(this.dataType)}},{key:"isFloat",get:function(){return this.dataType===t.DataType.FLOAT}},{key:"isNumber",get:function(){return Object.values(fe).includes(this.dataType)}},{key:"isBoolean",get:function(){return this.dataType===t.DataType.BOOLEAN}},{key:"isString",get:function(){return this.dataType===t.DataType.STRING}},{key:"isSelect",get:function(){return this.dataType===t.DataType.ENUM}}],[{key:"fields",value:function(){return{id:this.string(""),key:this.string(""),identifier:this.string(""),name:this.string(null).nullable(),comment:this.string(null).nullable(),value:this.attr(null).nullable(),default:this.attr(null).nullable(),dataType:this.string(""),min:this.number(null).nullable(),max:this.number(null).nullable(),step:this.number(null).nullable(),values:this.attr([]),relationshipNames:this.attr([])}}}]),n}(r.Model),Re=function(e){W(a,e);var t,r,n,i=ae(a);function a(){var e;B(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return J(ne(e=i.call.apply(i,[this].concat(r))),"type",void 0),J(ne(e),"device",void 0),J(ne(e),"deviceBackward",void 0),J(ne(e),"deviceId",void 0),e}return Z(a,[{key:"title",get:function(){return null!==this.name?this.name:O.default(this.identifier)}},{key:"description",get:function(){return null!==this.comment?this.comment:null}},{key:"selectValues",get:function(){if(!this.isSelect)throw new Error("This field is not allowed for entity type ".concat(this.type));return this.values}},{key:"formattedValue",get:function(){return this.isSelect,this.value}}],[{key:"entity",get:function(){return"device_configuration"}},{key:"fields",value:function(){return Object.assign(ye.fields(),{type:this.string(le.CONFIGURATION),device:this.belongsTo(Se,"id"),deviceBackward:this.hasOne(Se,"id","deviceId"),deviceId:this.string("")})}},{key:"get",value:(n=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("get",{device:t,id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetch",value:(r=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("fetch",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"edit",value:(t=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("edit",{property:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"transmitData",value:function(e,t){return a.dispatch("transmitData",{property:e,value:t})}},{key:"reset",value:function(){a.dispatch("reset")}}]),a}(ye);!function(e){e.FETCHING="fetching",e.GETTING="getting",e.CREATING="creating",e.UPDATING="updating",e.DELETING="deleting"}(ve||(ve={})),function(e){e.CHANNEL="devices-module/channel"}(me||(me={})),function(e){e.FETCHING="fetching",e.GETTING="getting",e.CREATING="creating",e.UPDATING="updating",e.DELETING="deleting"}(ge||(ge={})),function(e){e.PROPERTY="devices-module/channel-property"}(Te||(Te={}));var we,Ne,Ie=function(e){W(a,e);var t,r,n,i=ae(a);function a(){var e;B(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return J(ne(e=i.call.apply(i,[this].concat(r))),"type",void 0),J(ne(e),"channel",void 0),J(ne(e),"channelBackward",void 0),J(ne(e),"channelId",void 0),e}return Z(a,[{key:"title",get:function(){return null!==this.name?this.name:O.default(this.identifier)}},{key:"device",get:function(){if(null===this.channel){var e=Ae.query().where("id",this.channelId).first();return null!==e?Se.query().where("id",e.deviceId).first():null}return Se.query().where("id",this.channel.deviceId).first()}}],[{key:"entity",get:function(){return"channel_property"}},{key:"fields",value:function(){return Object.assign(de.fields(),{type:this.string(Te.PROPERTY),channel:this.belongsTo(Ae,"id"),channelBackward:this.hasOne(Ae,"id","channelId"),channelId:this.string("")})}},{key:"get",value:(n=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("get",{channel:t,id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetch",value:(r=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("fetch",{channel:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"edit",value:(t=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("edit",{property:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"transmitData",value:function(e,t){return a.dispatch("transmitData",{property:e,value:t})}},{key:"reset",value:function(){a.dispatch("reset")}}]),a}(de),be=function(e){W(a,e);var t,r,n,i=ae(a);function a(){var e;B(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return J(ne(e=i.call.apply(i,[this].concat(r))),"type",void 0),J(ne(e),"channel",void 0),J(ne(e),"channelBackward",void 0),J(ne(e),"channelId",void 0),e}return Z(a,[{key:"title",get:function(){return null!==this.name?this.name:O.default(this.identifier)}},{key:"description",get:function(){return null!==this.comment?this.comment:null}},{key:"selectValues",get:function(){if(!this.isSelect)throw new Error("This field is not allowed for entity type ".concat(this.type));return this.values}},{key:"formattedValue",get:function(){return this.isSelect,this.value}},{key:"device",get:function(){if(null===this.channel){var e=Ae.query().where("id",this.channelId).first();return null!==e?Se.query().where("id",e.deviceId).first():null}return Se.query().where("id",this.channel.deviceId).first()}}],[{key:"entity",get:function(){return"channel_configuration"}},{key:"fields",value:function(){return Object.assign(ye.fields(),{type:this.string(""),channel:this.belongsTo(Ae,"id"),channelBackward:this.hasOne(Ae,"id","channelId"),channelId:this.string("")})}},{key:"get",value:(n=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("get",{channel:t,id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetch",value:(r=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("fetch",{channel:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"edit",value:(t=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("edit",{property:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"transmitData",value:function(e,t){return a.dispatch("transmitData",{property:e,value:t})}},{key:"reset",value:function(){a.dispatch("reset")}}]),a}(ye),Ae=function(e){W(a,e);var t,r,n,i=ae(a);function a(){var e;B(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return J(ne(e=i.call.apply(i,[this].concat(r))),"id",void 0),J(ne(e),"type",void 0),J(ne(e),"key",void 0),J(ne(e),"identifier",void 0),J(ne(e),"name",void 0),J(ne(e),"comment",void 0),J(ne(e),"control",void 0),J(ne(e),"relationshipNames",void 0),J(ne(e),"properties",void 0),J(ne(e),"configuration",void 0),J(ne(e),"device",void 0),J(ne(e),"deviceBackward",void 0),J(ne(e),"deviceId",void 0),e}return Z(a,[{key:"title",get:function(){return null!==this.name?this.name:O.default(this.identifier)}}],[{key:"entity",get:function(){return"channel"}},{key:"fields",value:function(){return{id:this.string(""),type:this.string(me.CHANNEL),key:this.string(""),identifier:this.string(""),name:this.string(null).nullable(),comment:this.string(null).nullable(),control:this.attr([]),relationshipNames:this.attr([]),properties:this.hasMany(Ie,"channelId"),configuration:this.hasMany(be,"channelId"),device:this.belongsTo(Se,"id"),deviceBackward:this.hasOne(Se,"id","deviceId"),deviceId:this.string("")}}},{key:"get",value:(n=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("get",{device:t,id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetch",value:(r=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("fetch",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"edit",value:(t=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("edit",{channel:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"transmitCommand",value:function(e,t){return a.dispatch("transmitCommand",{channel:e,command:t})}},{key:"reset",value:function(){a.dispatch("reset")}}]),a}(r.Model);!function(e){e.FETCHING="fetching",e.GETTING="getting",e.CREATING="creating",e.UPDATING="updating",e.DELETING="deleting"}(we||(we={})),function(e){e.CONNECTOR="devices-module/device-connector"}(Ne||(Ne={}));var De,ke,Oe=function(e){W(a,e);var t,r,n,i=ae(a);function a(){var e;B(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return J(ne(e=i.call.apply(i,[this].concat(r))),"id",void 0),J(ne(e),"type",void 0),J(ne(e),"name",void 0),J(ne(e),"enabled",void 0),J(ne(e),"control",void 0),J(ne(e),"relationshipNames",void 0),J(ne(e),"devices",void 0),J(ne(e),"address",void 0),J(ne(e),"serialInterface",void 0),J(ne(e),"baudRate",void 0),J(ne(e),"server",void 0),J(ne(e),"port",void 0),J(ne(e),"securedPort",void 0),J(ne(e),"username",void 0),J(ne(e),"password",void 0),e}return Z(a,[{key:"isEnabled",get:function(){return this.enabled}},{key:"icon",get:function(){return"magic"}}],[{key:"entity",get:function(){return"connector"}},{key:"fields",value:function(){return{id:this.string(""),type:this.string(""),name:this.string(""),enabled:this.boolean(!0),relationshipNames:this.attr([]),devices:this.hasMany(_e,"connectorId"),address:this.number(null).nullable(),serialInterface:this.string(null).nullable(),baudRate:this.number(null).nullable(),server:this.string(null).nullable(),port:this.number(null).nullable(),securedPort:this.number(null).nullable(),username:this.string(null).nullable(),password:this.string(null).nullable()}}},{key:"get",value:(n=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("get",{id:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"fetch",value:(r=z(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("fetch");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"edit",value:(t=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("edit",{connector:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"transmitCommand",value:function(e,t){return a.dispatch("transmitCommand",{connector:e,command:t})}},{key:"reset",value:function(){a.dispatch("reset")}}]),a}(r.Model),_e=function(e){W(o,e);var t,r,n,i,a,c=ae(o);function o(){var e;B(this,o);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return J(ne(e=c.call.apply(c,[this].concat(r))),"id",void 0),J(ne(e),"type",void 0),J(ne(e),"draft",void 0),J(ne(e),"address",void 0),J(ne(e),"maxPacketLength",void 0),J(ne(e),"descriptionSupport",void 0),J(ne(e),"settingsSupport",void 0),J(ne(e),"configuredKeyLength",void 0),J(ne(e),"pubSubPubSupport",void 0),J(ne(e),"pubSubSubSupport",void 0),J(ne(e),"pubSubSubMaxSubscriptions",void 0),J(ne(e),"pubSubSubMaxConditions",void 0),J(ne(e),"pubSubSubMaxActions",void 0),J(ne(e),"username",void 0),J(ne(e),"password",void 0),J(ne(e),"relationshipNames",void 0),J(ne(e),"device",void 0),J(ne(e),"deviceBackward",void 0),J(ne(e),"connector",void 0),J(ne(e),"connectorBackward",void 0),J(ne(e),"deviceId",void 0),J(ne(e),"connectorId",void 0),e}return Z(o,null,[{key:"entity",get:function(){return"device_connector"}},{key:"fields",value:function(){return{id:this.string(""),type:this.string(Ne.CONNECTOR),draft:this.boolean(!1),address:this.number(0),maxPacketLength:this.number(0),descriptionSupport:this.boolean(!1),settingsSupport:this.boolean(!1),configuredKeyLength:this.number(0),pubSubPubSupport:this.boolean(!1),pubSubSubSupport:this.boolean(!1),pubSubSubMaxSubscriptions:this.number(0),pubSubSubMaxConditions:this.number(0),pubSubSubMaxActions:this.number(0),username:this.string(""),password:this.string(""),relationshipNames:this.attr([]),device:this.belongsTo(Se,"id"),deviceBackward:this.hasOne(Se,"id","deviceId"),connector:this.belongsTo(Oe,"id"),connectorBackward:this.hasOne(Oe,"id","connectorId"),deviceId:this.string(""),connectorId:this.string("")}}},{key:"get",value:(a=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch("get",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"add",value:(i=z(regeneratorRuntime.mark((function e(t,r,n,i){var a,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(c.length>4&&void 0!==c[4])||c[4],e.next=3,o.dispatch("add",{id:i,draft:a,device:t,connector:r,data:n});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return i.apply(this,arguments)})},{key:"edit",value:(n=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch("edit",{connector:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"save",value:(r=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch("save",{connector:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"remove",value:(t=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dispatch("remove",{connector:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"reset",value:function(){o.dispatch("reset")}}]),o}(r.Model),Se=function(e){W(s,e);var r,n,i,a,c,o,u=ae(s);function s(){var e;B(this,s);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return J(ne(e=u.call.apply(u,[this].concat(r))),"id",void 0),J(ne(e),"type",void 0),J(ne(e),"draft",void 0),J(ne(e),"parentId",void 0),J(ne(e),"key",void 0),J(ne(e),"identifier",void 0),J(ne(e),"name",void 0),J(ne(e),"comment",void 0),J(ne(e),"state",void 0),J(ne(e),"enabled",void 0),J(ne(e),"hardwareModel",void 0),J(ne(e),"hardwareManufacturer",void 0),J(ne(e),"hardwareVersion",void 0),J(ne(e),"macAddress",void 0),J(ne(e),"firmwareManufacturer",void 0),J(ne(e),"firmwareVersion",void 0),J(ne(e),"control",void 0),J(ne(e),"owner",void 0),J(ne(e),"relationshipNames",void 0),J(ne(e),"children",void 0),J(ne(e),"channels",void 0),J(ne(e),"properties",void 0),J(ne(e),"configuration",void 0),J(ne(e),"connector",void 0),e}return Z(s,[{key:"isEnabled",get:function(){return this.enabled}},{key:"isReady",get:function(){return this.state===t.DeviceConnectionState.READY||this.state===t.DeviceConnectionState.RUNNING}},{key:"icon",get:function(){if(this.hardwareManufacturer===t.HardwareManufacturer.ITEAD)switch(this.hardwareModel){case t.DeviceModel.SONOFF_SC:return"thermometer-half";case t.DeviceModel.SONOFF_POW:case t.DeviceModel.SONOFF_POW_R2:return"calculator"}return"plug"}},{key:"title",get:function(){return null!==this.name?this.name:O.default(this.identifier)}},{key:"hasComment",get:function(){return null!==this.comment&&""!==this.comment}},{key:"isCustomModel",get:function(){return this.hardwareModel===t.DeviceModel.CUSTOM}}],[{key:"entity",get:function(){return"device"}},{key:"fields",value:function(){return{id:this.string(""),type:this.string(w.DEVICE),draft:this.boolean(!1),parentId:this.string(null).nullable(),key:this.string(""),identifier:this.string(""),name:this.string(null).nullable(),comment:this.string(null).nullable(),state:this.string(t.DeviceConnectionState.UNKNOWN),enabled:this.boolean(!1),hardwareModel:this.string(t.DeviceModel.CUSTOM),hardwareManufacturer:this.string(t.HardwareManufacturer.GENERIC),hardwareVersion:this.string(null).nullable(),macAddress:this.string(null).nullable(),firmwareManufacturer:this.string(t.FirmwareManufacturer.GENERIC),firmwareVersion:this.string(null).nullable(),control:this.attr([]),owner:this.string(null).nullable(),relationshipNames:this.attr([]),children:this.hasMany(s,"parentId"),channels:this.hasMany(Ae,"deviceId"),properties:this.hasMany(Ee,"deviceId"),configuration:this.hasMany(Re,"deviceId"),connector:this.hasOne(_e,"deviceId")}}},{key:"get",value:(o=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.dispatch("get",{id:t,includeChannels:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"fetch",value:(c=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.dispatch("fetch",{includeChannels:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"add",value:(a=z(regeneratorRuntime.mark((function e(t,r){var n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(i.length>2&&void 0!==i[2])||i[2],e.next=3,s.dispatch("add",{id:r,draft:n,data:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return a.apply(this,arguments)})},{key:"edit",value:(i=z(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.dispatch("edit",{device:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"save",value:(n=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.dispatch("save",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"remove",value:(r=z(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.dispatch("remove",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"transmitCommand",value:function(e,t){return s.dispatch("transmitCommand",{device:e,command:t})}},{key:"reset",value:function(){s.dispatch("reset")}}]),s}(r.Model),xe=function(e){W(r,e);var t=ae(r);function r(e,n){var i;B(this,r);for(var a=arguments.length,c=new Array(a>2?a-2:0),o=2;o<a;o++)c[o-2]=arguments[o];return J(ne(i=t.call.apply(t,[this].concat(c))),"type",void 0),J(ne(i),"exception",void 0),Error.captureStackTrace&&Error.captureStackTrace(ne(i),r),i.type=e,i.exception=n,i}return r}(re(Error)),Ce=function(e){W(r,e);var t=ae(r);function r(){return B(this,r),t.apply(this,arguments)}return r}(xe),Pe=function(e){W(r,e);var t=ae(r);function r(){return B(this,r),t.apply(this,arguments)}return r}(xe);!function(e){e.FETCHING="fetching",e.GETTING="getting",e.CREATING="creating",e.UPDATING="updating",e.DELETING="deleting"}(De||(De={})),function(e){e.CONFIGURATION="devices-module/channel-configuration"}(ke||(ke={}));var Ge,Me,He,Le,Ue,Fe,Ye,je,Ve,Ke,qe=function(e){W(r,e);var t=ae(r);function r(){return B(this,r),t.apply(this,arguments)}return Z(r,[{key:"getAttributes",value:function(e){var t=["id","$id","type","draft","relationshipNames"];e.type===me.CHANNEL||e.type===se.PROPERTY||e.type===le.CONFIGURATION||e.type===Ne.CONNECTOR?(t.push("deviceId"),t.push("device"),t.push("device_backward")):e.type===Te.PROPERTY||e.type===ke.CONFIGURATION?(t.push("channelId"),t.push("channel"),t.push("channel_backward")):e.type===Ne.CONNECTOR&&(t.push("connectorId"),t.push("connector"),t.push("connector_backward")),Array.isArray(e.relationshipNames)&&t.push.apply(t,ce(e.relationshipNames));var r={};return Object.keys(e).forEach((function(n){if(!t.includes(n)){var i=n.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())})),a=e[n];"object"===K(a)&&null!==a&&(a={},Object.keys(e[n]).forEach((function(t){var r=t.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));Object.assign(a,J({},r,e[n][t]))}))),r[i]=a}})),r}},{key:"getRelationships",value:function(e){if(!Object.prototype.hasOwnProperty.call(e,"relationshipNames")||!Array.isArray(e.relationshipNames))return{};var t=e.relationshipNames,r={};if(t.forEach((function(t){var n=t.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));void 0!==e[t]&&(Array.isArray(e[t])?r[n]=e[t].map((function(e){return{id:e.id,type:e.type}})):"object"===K(e[t])&&null!==e[t]&&(r[n]={id:e[t].id,type:e[t].type}))})),Object.prototype.hasOwnProperty.call(e,"deviceId")){var n=Se.find(e.deviceId);null!==n&&(r.device={id:n.id,type:n.type})}if(Object.prototype.hasOwnProperty.call(e,"channelId")){var i=Ae.find(e.deviceId);null!==i&&(r.channel={id:i.id,type:i.type})}if(Object.prototype.hasOwnProperty.call(e,"connectorId")){var a=Oe.find(e.connectorId);null!==a&&(r.connector={id:a.id,type:a.type})}return r}}]),r}(a.ModelPropertiesMapper),ze=function(e){W(r,e);var t=ae(r);function r(){var e;B(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return J(ne(e=t.call.apply(t,[this].concat(i))),"caseRegExp","_([a-z0-9])"),e}return Z(r,[{key:"createModel",value:function(e){return{type:e}}},{key:"setId",value:function(e,t){Object.assign(e,{id:t})}},{key:"setAttributes",value:function(e,t){var r=new RegExp(this.caseRegExp,"g");Object.keys(t).forEach((function(n){var i=n.replace(r,(function(e){return e[1].toUpperCase()})),a=t[n];"object"===K(a)&&null!==a&&(a={},Object.keys(t[n]).forEach((function(e){var i=e.replace(r,(function(e){return e[1].toUpperCase()}));Object.assign(a,J({},i,t[n][e]))}))),"control"===n&&(a=Object.values(t[n])),Object.assign(e,J({},i,a))})),Object.assign(e,{draft:!1})}},{key:"setRelationships",value:function(e,t){var r=this;Object.keys(t).forEach((function(n){var i=new RegExp(r.caseRegExp,"g"),a=n.replace(i,(function(e){return e[1].toUpperCase()}));if("function"==typeof t[n])d.defineRelationGetter(e,n,t[n]);else{var c=M.default(t[n]);Array.isArray(c)?Object.assign(e,J({},a,c.map((function(e){var t=e;return t=r.transformDevice(t),t=r.transformChannel(t)})))):P.default(c,"type")===w.DEVICE?Object.assign(e,{deviceId:P.default(c,"id")}):P.default(c,"type")===me.CHANNEL?Object.assign(e,{channelId:P.default(c,"id")}):Object.assign(e,J({},a,c))}}));var n=Object.keys(t),i=e.relationshipNames;i&&i.length?Object.assign(e,J({},"relationshipNames",[].concat(ce(i),ce(n)).filter((function(e,t,r){return r.indexOf(e)===t})))):Object.assign(e,J({},"relationshipNames",n))}},{key:"transformDevice",value:function(e){return Object.prototype.hasOwnProperty.call(e,"device")&&(Object.assign(e,{deviceId:e.device.id}),Reflect.deleteProperty(e,"device")),e}},{key:"transformChannel",value:function(e){return Object.prototype.hasOwnProperty.call(e,"channel")&&(Object.assign(e,{channelId:e.channel.id}),Reflect.deleteProperty(e,"channel")),e}}]),r}(a.JsonPropertiesMapper),Be="/".concat(t.ModulePrefix.MODULE_DEVICES_PREFIX),$e=new S.default({modelPropertiesMapper:new qe,jsonPropertiesMapper:new ze}),Ze={dataTransformer:function(e){return $e.deserialize(e.data)}},Je=new x.default,We={semaphore:{fetching:{items:!1,item:[]},creating:[],updating:[],deleting:[]},firstLoad:!1},Qe={state:function(){return We},getters:{firstLoadFinished:function(e){return function(){return!!e.firstLoad}},getting:function(e){return function(t){return e.semaphore.fetching.item.includes(t)}},fetching:function(e){return function(){return!!e.semaphore.fetching.items}}},actions:{get:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:R.GETTING,id:t.id}),r.prev=4,r.next=7,Se.api().get("".concat(Be,"/v1/devices/").concat(t.id,"?include=properties,configuration,connector"),Ze);case 7:if(!t.includeChannels){r.next=12;break}if(null===(a=Se.find(t.id))){r.next=12;break}return r.next=12,Ae.fetch(a);case 12:return r.abrupt("return",!0);case 15:throw r.prev=15,r.t0=r.catch(4),new Ce("devices-module.devices.fetch.failed",r.t0,"Fetching devices failed.");case 18:return r.prev=18,i("CLEAR_SEMAPHORE",{type:R.GETTING,id:t.id}),r.finish(18);case 21:case"end":return r.stop()}}),r,null,[[4,15,18,21]])})))()},fetch:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:R.FETCHING}),r.prev=4,r.next=7,Se.api().get("".concat(Be,"/v1/devices?include=properties,configuration,connector"),Ze);case 7:if(!t.includeChannels){r.next=15;break}return r.next=10,Se.all();case 10:return a=r.sent,c=[],a.forEach((function(e){c.push(Ae.fetch(e))})),r.next=15,Promise.all(c);case 15:return i("SET_FIRST_LOAD",!0),r.abrupt("return",!0);case 19:throw r.prev=19,r.t0=r.catch(4),new Ce("devices-module.devices.fetch.failed",r.t0,"Fetching devices failed.");case 22:return r.prev=22,i("CLEAR_SEMAPHORE",{type:R.FETCHING}),r.finish(22);case 25:case"end":return r.stop()}}),r,null,[[4,19,22,25]])})))()},add:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.commit,i=void 0!==t.id&&null!==t.id&&""!==t.id?t.id:C.default.v4().toString(),a=void 0!==t.draft&&t.draft,n("SET_SEMAPHORE",{type:R.CREATING,id:i}),r.prev=4,r.next=7,Se.insert({data:Object.assign({},t.data,{id:i,draft:a})});case 7:r.next=13;break;case 9:throw r.prev=9,r.t0=r.catch(4),n("CLEAR_SEMAPHORE",{type:R.CREATING,id:i}),new Pe("devices-module.devices.create.failed",r.t0,"Create new device failed.");case 13:if(null!==(c=Se.find(i))){r.next=19;break}return r.next=17,Se.delete(i);case 17:throw n("CLEAR_SEMAPHORE",{type:R.CREATING,id:i}),new Error("devices-module.devices.create.failed");case 19:if(!a){r.next=24;break}return n("CLEAR_SEMAPHORE",{type:R.CREATING,id:i}),r.abrupt("return",Se.find(i));case 24:return r.prev=24,r.next=27,Se.api().post("".concat(Be,"/v1/devices?include=properties,configuration,connector"),$e.serialize({stuff:c}),Ze);case 27:return r.abrupt("return",Se.find(i));case 30:return r.prev=30,r.t1=r.catch(24),r.next=34,Se.delete(i);case 34:throw new Ce("devices-module.devices.create.failed",r.t1,"Create new device failed.");case 35:return r.prev=35,n("CLEAR_SEMAPHORE",{type:R.CREATING,id:i}),r.finish(35);case 38:case"end":return r.stop()}}),r,null,[[4,9],[24,30,35,38]])})))()},edit:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.device.id)){r.next=3;break}throw new Error("devices-module.devices.update.inProgress");case 3:if(Se.query().where("id",t.device.id).exists()){r.next=5;break}throw new Error("devices-module.devices.update.failed");case 5:return i("SET_SEMAPHORE",{type:R.UPDATING,id:t.device.id}),r.prev=6,r.next=9,Se.update({where:t.device.id,data:t.data});case 9:r.next=14;break;case 11:throw r.prev=11,r.t0=r.catch(6),new Pe("devices-module.devices.update.failed",r.t0,"Edit device failed.");case 14:if(null!==(a=Se.find(t.device.id))){r.next=20;break}return r.next=18,Se.get(t.device.id,!1);case 18:throw i("CLEAR_SEMAPHORE",{type:R.UPDATING,id:t.device.id}),new Error("devices-module.devices.update.failed");case 20:if(!a.draft){r.next=25;break}return i("CLEAR_SEMAPHORE",{type:R.UPDATING,id:t.device.id}),r.abrupt("return",Se.find(t.device.id));case 25:return r.prev=25,r.next=28,Se.api().patch("".concat(Be,"/v1/devices/").concat(a.id,"?include=properties,configuration,connector"),$e.serialize({stuff:a}),Ze);case 28:return r.abrupt("return",Se.find(t.device.id));case 31:return r.prev=31,r.t1=r.catch(25),r.next=35,Se.get(t.device.id,!1);case 35:throw new Ce("devices-module.devices.update.failed",r.t1,"Edit device failed.");case 36:return r.prev=36,i("CLEAR_SEMAPHORE",{type:R.UPDATING,id:t.device.id}),r.finish(36);case 39:case"end":return r.stop()}}),r,null,[[6,11],[25,31,36,39]])})))()},save:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.device.id)){r.next=3;break}throw new Error("devices-module.devices.save.inProgress");case 3:if(Se.query().where("id",t.device.id).where("draft",!0).exists()){r.next=5;break}throw new Error("devices-module.devices.save.failed");case 5:if(i("SET_SEMAPHORE",{type:R.UPDATING,id:t.device.id}),null!==(a=Se.find(t.device.id))){r.next=10;break}throw i("CLEAR_SEMAPHORE",{type:R.UPDATING,id:t.device.id}),new Error("devices-module.devices.save.failed");case 10:return r.prev=10,r.next=13,Se.api().post("".concat(Be,"/v1/devices?include=properties,configuration,connector"),$e.serialize({stuff:a}),Ze);case 13:return r.abrupt("return",Se.find(t.device.id));case 16:throw r.prev=16,r.t0=r.catch(10),new Ce("devices-module.devices.save.failed",r.t0,"Save draft device failed.");case 19:return r.prev=19,i("CLEAR_SEMAPHORE",{type:R.UPDATING,id:t.device.id}),r.finish(19);case 22:case"end":return r.stop()}}),r,null,[[10,16,19,22]])})))()},remove:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.deleting.includes(t.device.id)){r.next=3;break}throw new Error("devices-module.devices.delete.inProgress");case 3:if(Se.query().where("id",t.device.id).exists()){r.next=5;break}return r.abrupt("return",!0);case 5:return i("SET_SEMAPHORE",{type:R.DELETING,id:t.device.id}),r.prev=6,r.next=9,Se.delete(t.device.id);case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:R.DELETING,id:t.device.id}),new Pe("devices-module.devices.delete.failed",r.t0,"Delete device failed.");case 15:if(!t.device.draft){r.next=20;break}return i("CLEAR_SEMAPHORE",{type:R.DELETING,id:t.device.id}),r.abrupt("return",!0);case 20:return r.prev=20,r.next=23,Se.api().delete("".concat(Be,"/v1/devices/").concat(t.device.id),{save:!1});case 23:return r.abrupt("return",!0);case 26:return r.prev=26,r.t1=r.catch(20),r.next=30,Se.get(t.device.id,!1);case 30:throw new Pe("devices-module.devices.delete.failed",r.t1,"Delete device failed.");case 31:return r.prev=31,i("CLEAR_SEMAPHORE",{type:R.DELETING,id:t.device.id}),r.finish(31);case 34:case"end":return r.stop()}}),r,null,[[6,11],[20,26,31,34]])})))()},transmitCommand:function(e,r){if(!Se.query().where("id",r.device.id).exists())throw new Error("devices-module.device.transmit.failed");return new Promise((function(e,n){Se.wamp().call({routing_key:t.DevicesModule.DEVICES_CONTROLS,origin:Se.$devicesModuleOrigin,data:{control:r.command,device:r.device.key}}).then((function(t){"accepted"===P.default(t.data,"response")?e(!0):n(new Error("devices-module.device.transmit.failed"))})).catch((function(){n(new Error("devices-module.device.transmit.failed"))}))}))},socketData:function(e,r){return z(regeneratorRuntime.mark((function n(){var i,a,c,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.state,a=e.commit,r.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){n.next=3;break}return n.abrupt("return",!1);case 3:if([t.DevicesModule.DEVICES_CREATED_ENTITY,t.DevicesModule.DEVICES_UPDATED_ENTITY,t.DevicesModule.DEVICES_DELETED_ENTITY].includes(r.routingKey)){n.next=5;break}return n.abrupt("return",!1);case 5:if(c=JSON.parse(r.data),!Je.compile(_)(c)){n.next=46;break}if(Se.query().where("id",c.id).exists()||r.routingKey!==t.DevicesModule.DEVICES_UPDATED_ENTITY&&r.routingKey!==t.DevicesModule.DEVICES_DELETED_ENTITY){n.next=10;break}throw new Error("devices-module.devices.update.failed");case 10:if(r.routingKey!==t.DevicesModule.DEVICES_DELETED_ENTITY){n.next=25;break}return a("SET_SEMAPHORE",{type:R.DELETING,id:c.id}),n.prev=12,n.next=15,Se.delete(c.id);case 15:n.next=20;break;case 17:throw n.prev=17,n.t0=n.catch(12),new Pe("devices-module.devices.delete.failed",n.t0,"Delete device failed.");case 20:return n.prev=20,a("CLEAR_SEMAPHORE",{type:R.DELETING,id:c.id}),n.finish(20);case 23:n.next=43;break;case 25:if(r.routingKey!==t.DevicesModule.DEVICES_UPDATED_ENTITY||!i.semaphore.updating.includes(c.id)){n.next=27;break}return n.abrupt("return",!0);case 27:return a("SET_SEMAPHORE",{type:r.routingKey===t.DevicesModule.DEVICES_UPDATED_ENTITY?R.UPDATING:R.CREATING,id:c.id}),o={},Object.keys(c).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));o[t]=c[e]})),n.prev=30,n.next=33,Se.insertOrUpdate({data:o});case 33:n.next=40;break;case 35:return n.prev=35,n.t1=n.catch(30),n.next=39,Se.get(c.id,!1);case 39:throw new Pe("devices-module.devices.update.failed",n.t1,"Edit device failed.");case 40:return n.prev=40,a("CLEAR_SEMAPHORE",{type:r.routingKey===t.DevicesModule.DEVICES_UPDATED_ENTITY?R.UPDATING:R.CREATING,id:c.id}),n.finish(40);case 43:return n.abrupt("return",!0);case 46:return n.abrupt("return",!1);case 47:case"end":return n.stop()}}),n,null,[[12,17,20,23],[30,35,40,43]])})))()},reset:function(e){(0,e.commit)("RESET_STATE"),Ae.reset()}},mutations:(J(Ge={},"SET_FIRST_LOAD",(function(e,t){e.firstLoad=t})),J(Ge,"SET_SEMAPHORE",(function(e,t){switch(t.type){case R.FETCHING:e.semaphore.fetching.items=!0;break;case R.GETTING:e.semaphore.fetching.item.push(P.default(t,"id","notValid")),e.semaphore.fetching.item=G.default(e.semaphore.fetching.item);break;case R.CREATING:e.semaphore.creating.push(P.default(t,"id","notValid")),e.semaphore.creating=G.default(e.semaphore.creating);break;case R.UPDATING:e.semaphore.updating.push(P.default(t,"id","notValid")),e.semaphore.updating=G.default(e.semaphore.updating);break;case R.DELETING:e.semaphore.deleting.push(P.default(t,"id","notValid")),e.semaphore.deleting=G.default(e.semaphore.deleting)}})),J(Ge,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case R.FETCHING:e.semaphore.fetching.items=!1;break;case R.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===P.default(t,"id","notValid")&&e.semaphore.fetching.item.splice(n,1)}));break;case R.CREATING:e.semaphore.creating.forEach((function(r,n){r===P.default(t,"id","notValid")&&e.semaphore.creating.splice(n,1)}));break;case R.UPDATING:e.semaphore.updating.forEach((function(r,n){r===P.default(t,"id","notValid")&&e.semaphore.updating.splice(n,1)}));break;case R.DELETING:e.semaphore.deleting.forEach((function(r,n){r===P.default(t,"id","notValid")&&e.semaphore.deleting.splice(n,1)}))}})),J(Ge,"RESET_STATE",(function(e){Object.assign(e,We)})),Ge)},Xe=new S.default({modelPropertiesMapper:new qe,jsonPropertiesMapper:new ze}),et={dataTransformer:function(e){return Xe.deserialize(e.data)}},tt=new x.default,rt={semaphore:{fetching:{items:[],item:[]},creating:[],updating:[],deleting:[]}},nt={state:function(){return rt},actions:{get:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:ue.GETTING,id:t.id}),r.prev=4,r.next=7,Ee.api().get("".concat(Be,"/v1/devices/").concat(t.device.id,"/properties/").concat(t.id),et);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new Ce("devices-module.device-properties.fetch.failed",r.t0,"Fetching device property failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:ue.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items.includes(t.device.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:ue.FETCHING,id:t.device.id}),r.prev=4,r.next=7,Ee.api().get("".concat(Be,"/v1/devices/").concat(t.device.id,"/properties"),et);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new Ce("devices-module.device-properties.fetch.failed",r.t0,"Fetching device properties failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:ue.FETCHING,id:t.device.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},edit:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.property.id)){r.next=3;break}throw new Error("devices-module.device-properties.update.inProgress");case 3:if(Ee.query().where("id",t.property.id).exists()){r.next=5;break}throw new Error("devices-module.device-properties.update.failed");case 5:return i("SET_SEMAPHORE",{type:ue.UPDATING,id:t.property.id}),r.prev=6,r.next=9,Ee.update({where:t.property.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:ue.UPDATING,id:t.property.id}),new Pe("devices-module.device-properties.update.failed",r.t0,"Edit device property failed.");case 15:if(null!==(a=Ee.find(t.property.id))){r.next=23;break}if(null===(c=Se.find(t.property.deviceId))){r.next=21;break}return r.next=21,Ee.get(c,t.property.id);case 21:throw i("CLEAR_SEMAPHORE",{type:ue.UPDATING,id:t.property.id}),new Error("devices-module.device-properties.update.failed");case 23:return r.prev=23,r.next=26,Ee.api().patch("".concat(Be,"/v1/devices/").concat(a.deviceId,"/properties/").concat(a.id),Xe.serialize({stuff:a}),et);case 26:return r.abrupt("return",Ee.find(t.property.id));case 29:if(r.prev=29,r.t1=r.catch(23),null===(o=Se.find(t.property.deviceId))){r.next=35;break}return r.next=35,Ee.get(o,t.property.id);case 35:throw new Ce("devices-module.device-properties.update.failed",r.t1,"Edit device property failed.");case 36:return r.prev=36,i("CLEAR_SEMAPHORE",{type:ue.UPDATING,id:t.property.id}),r.finish(36);case 39:case"end":return r.stop()}}),r,null,[[6,11],[23,29,36,39]])})))()},transmitData:function(e,r){return z(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ee.query().where("id",r.property.id).exists()){e.next=2;break}throw new Error("devices-module.device-properties.transmit.failed");case 2:if(null!==(n=Se.find(r.property.deviceId))){e.next=5;break}throw new Error("devices-module.device-properties.transmit.failed");case 5:return i=r.property.value,e.prev=6,e.next=9,Ee.update({where:r.property.id,data:{value:r.value}});case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(6),new Pe("devices-module.device-properties.transmit.failed",e.t0,"Edit device property failed.");case 14:return e.abrupt("return",new Promise((function(e,a){Ee.wamp().call({routing_key:t.DevicesModule.DEVICES_PROPERTIES_DATA,origin:Ee.$devicesModuleOrigin,data:{device:n.key,property:r.property.key,expected:r.value}}).then((function(t){"accepted"===P.default(t.data,"response")?e(!0):(Ee.update({where:r.property.id,data:{value:i}}),a(new Error("devices-module.device-properties.transmit.failed")))})).catch((function(){Ee.update({where:r.property.id,data:{value:i}}),a(new Error("devices-module.device-properties.transmit.failed"))}))})));case 15:case"end":return e.stop()}}),e,null,[[6,11]])})))()},socketData:function(e,r){return z(regeneratorRuntime.mark((function n(){var i,a,c,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.state,a=e.commit,r.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){n.next=3;break}return n.abrupt("return",!1);case 3:if([t.DevicesModule.DEVICES_PROPERTY_CREATED_ENTITY,t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY,t.DevicesModule.DEVICES_PROPERTY_DELETED_ENTITY].includes(r.routingKey)){n.next=5;break}return n.abrupt("return",!1);case 5:if(c=JSON.parse(r.data),!tt.compile(H)(c)){n.next=48;break}if(Ee.query().where("id",c.id).exists()||r.routingKey!==t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY&&r.routingKey!==t.DevicesModule.DEVICES_PROPERTY_DELETED_ENTITY){n.next=10;break}throw new Error("devices-module.device-properties.update.failed");case 10:if(r.routingKey!==t.DevicesModule.DEVICES_PROPERTY_DELETED_ENTITY){n.next=25;break}return a("SET_SEMAPHORE",{type:ue.DELETING,id:c.id}),n.prev=12,n.next=15,Ee.delete(c.id);case 15:n.next=20;break;case 17:throw n.prev=17,n.t0=n.catch(12),new Pe("devices-module.device-properties.delete.failed",n.t0,"Delete device property failed.");case 20:return n.prev=20,a("CLEAR_SEMAPHORE",{type:ue.DELETING,id:c.id}),n.finish(20);case 23:n.next=45;break;case 25:if(r.routingKey!==t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY||!i.semaphore.updating.includes(c.id)){n.next=27;break}return n.abrupt("return",!0);case 27:return a("SET_SEMAPHORE",{type:r.routingKey===t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY?ue.UPDATING:ue.CREATING,id:c.id}),o={type:se.PROPERTY},Object.keys(c).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("device"===t){var r=Se.query().where("identifier",c[e]).first();null!==r&&(o.deviceId=r.id)}else o[t]=c[e]})),n.prev=30,n.next=33,Ee.insertOrUpdate({data:o});case 33:n.next=42;break;case 35:if(n.prev=35,n.t1=n.catch(30),null===(u=Ee.query().with("device").where("id",c.id).first())||null===u.device){n.next=41;break}return n.next=41,Ee.get(u.device,c.id);case 41:throw new Pe("devices-module.device-properties.update.failed",n.t1,"Edit device property failed.");case 42:return n.prev=42,a("CLEAR_SEMAPHORE",{type:r.routingKey===t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY?ue.UPDATING:ue.CREATING,id:c.id}),n.finish(42);case 45:return n.abrupt("return",!0);case 48:return n.abrupt("return",!1);case 49:case"end":return n.stop()}}),n,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(J(Me={},"SET_SEMAPHORE",(function(e,t){switch(t.type){case ue.FETCHING:e.semaphore.fetching.items.push(t.id),e.semaphore.fetching.items=G.default(e.semaphore.fetching.items);break;case ue.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=G.default(e.semaphore.fetching.item);break;case ue.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=G.default(e.semaphore.creating);break;case ue.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=G.default(e.semaphore.updating);break;case ue.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=G.default(e.semaphore.deleting)}})),J(Me,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case ue.FETCHING:e.semaphore.fetching.items.forEach((function(r,n){r===t.id&&e.semaphore.fetching.items.splice(n,1)}));break;case ue.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case ue.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case ue.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case ue.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),J(Me,"RESET_STATE",(function(e){Object.assign(e,rt)})),Me)},it=new S.default({modelPropertiesMapper:new qe,jsonPropertiesMapper:new ze}),at={dataTransformer:function(e){return it.deserialize(e.data)}},ct=new x.default,ot={semaphore:{fetching:{items:[],item:[]},creating:[],updating:[],deleting:[]}},ut={state:function(){return ot},actions:{get:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:pe.GETTING,id:t.id}),r.prev=4,r.next=7,Re.api().get("".concat(Be,"/v1/devices/").concat(t.device.id,"/configuration/").concat(t.id),at);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new Ce("devices-module.device-configuration.fetch.failed",r.t0,"Fetching device configuration failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:pe.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items.includes(t.device.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:pe.FETCHING,id:t.device.id}),r.prev=4,r.next=7,Re.api().get("".concat(Be,"/v1/devices/").concat(t.device.id,"/configuration"),at);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new Ce("devices-module.device-configuration.fetch.failed",r.t0,"Fetching device configuration failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:pe.FETCHING,id:t.device.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},edit:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.configuration.id)){r.next=3;break}throw new Error("devices-module.device-configuration.update.inProgress");case 3:if(Re.query().where("id",t.configuration.id).exists()){r.next=5;break}throw new Error("devices-module.device-configuration.update.failed");case 5:return i("SET_SEMAPHORE",{type:pe.UPDATING,id:t.configuration.id}),r.prev=6,r.next=9,Re.update({where:t.configuration.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:pe.UPDATING,id:t.configuration.id}),new Pe("devices-module.device-configuration.update.failed",r.t0,"Edit device configuration failed.");case 15:if(null!==(a=Re.find(t.configuration.id))){r.next=23;break}if(null===(c=Se.find(t.configuration.deviceId))){r.next=21;break}return r.next=21,Re.get(c,t.configuration.id);case 21:throw i("CLEAR_SEMAPHORE",{type:pe.UPDATING,id:t.configuration.id}),new Error("devices-module.device-configuration.update.failed");case 23:if(null!==(o=Se.find(t.configuration.deviceId))){r.next=26;break}throw new Error("devices-module.device-configuration.update.failed");case 26:return r.prev=26,r.next=29,Re.api().patch("".concat(Be,"/v1/devices/").concat(o.id,"/configuration/").concat(a.id),it.serialize({stuff:a}),at);case 29:return r.abrupt("return",Re.find(t.configuration.id));case 32:return r.prev=32,r.t1=r.catch(26),r.next=36,Re.get(o,t.configuration.id);case 36:throw new Ce("devices-module.device-configuration.update.failed",r.t1,"Edit device configuration failed.");case 37:return r.prev=37,i("CLEAR_SEMAPHORE",{type:pe.UPDATING,id:t.configuration.id}),r.finish(37);case 40:case"end":return r.stop()}}),r,null,[[6,11],[26,32,37,40]])})))()},transmitData:function(e,r){return z(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Re.query().where("id",r.configuration.id).exists()){e.next=2;break}throw new Error("devices-module.device-configuration.transmit.failed");case 2:if(null!==(n=Se.find(r.configuration.deviceId))){e.next=5;break}throw new Error("devices-module.device-configuration.transmit.failed");case 5:return i=r.configuration.value,e.prev=6,e.next=9,Re.update({where:r.configuration.id,data:{value:r.value}});case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(6),new Pe("devices-module.device-configuration.transmit.failed",e.t0,"Edit device configuration failed.");case 14:return e.abrupt("return",new Promise((function(e,a){Re.wamp().call({routing_key:t.DevicesModule.DEVICES_CONFIGURATION_DATA,origin:Re.$devicesModuleOrigin,data:{device:n.key,configuration:r.configuration.key,expected:r.value}}).then((function(t){"accepted"===P.default(t.data,"response")?e(!0):(Re.update({where:r.configuration.id,data:{value:i}}),a(new Error("devices-module.device-configuration.transmit.failed")))})).catch((function(){Re.update({where:r.configuration.id,data:{value:i}}),a(new Error("devices-module.device-configuration.transmit.failed"))}))})));case 15:case"end":return e.stop()}}),e,null,[[6,11]])})))()},socketData:function(e,r){return z(regeneratorRuntime.mark((function n(){var i,a,c,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.state,a=e.commit,r.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){n.next=3;break}return n.abrupt("return",!1);case 3:if([t.DevicesModule.DEVICES_CONFIGURATION_CREATED_ENTITY,t.DevicesModule.DEVICES_CONFIGURATION_UPDATED_ENTITY,t.DevicesModule.DEVICES_CONFIGURATION_DELETED_ENTITY].includes(r.routingKey)){n.next=5;break}return n.abrupt("return",!1);case 5:if(c=JSON.parse(r.data),!ct.compile(L)(c)){n.next=48;break}if(Re.query().where("id",c.id).exists()||r.routingKey!==t.DevicesModule.DEVICES_CONFIGURATION_UPDATED_ENTITY&&r.routingKey!==t.DevicesModule.DEVICES_CONFIGURATION_DELETED_ENTITY){n.next=10;break}throw new Error("devices-module.device-configuration.update.failed");case 10:if(r.routingKey!==t.DevicesModule.DEVICES_CONFIGURATION_DELETED_ENTITY){n.next=25;break}return a("SET_SEMAPHORE",{type:pe.DELETING,id:c.id}),n.prev=12,n.next=15,Re.delete(c.id);case 15:n.next=20;break;case 17:throw n.prev=17,n.t0=n.catch(12),new Pe("devices-module.device-configuration.delete.failed",n.t0,"Delete device configuration failed.");case 20:return n.prev=20,a("CLEAR_SEMAPHORE",{type:pe.DELETING,id:c.id}),n.finish(20);case 23:n.next=45;break;case 25:if(r.routingKey!==t.DevicesModule.DEVICES_CONFIGURATION_UPDATED_ENTITY||!i.semaphore.updating.includes(c.id)){n.next=27;break}return n.abrupt("return",!0);case 27:return a("SET_SEMAPHORE",{type:r.routingKey===t.DevicesModule.DEVICES_CONFIGURATION_UPDATED_ENTITY?pe.UPDATING:pe.CREATING,id:c.id}),o={type:le.CONFIGURATION},Object.keys(c).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("device"===t){var r=Se.query().where("device",c[e]).first();null!==r&&(o.deviceId=r.id)}else o[t]=c[e]})),n.prev=30,n.next=33,Re.insertOrUpdate({data:o});case 33:n.next=42;break;case 35:if(n.prev=35,n.t1=n.catch(30),null===(u=Re.query().with("device").where("id",c.id).first())||null===u.device){n.next=41;break}return n.next=41,Re.get(u.device,c.id);case 41:throw new Pe("devices-module.device-configuration.update.failed",n.t1,"Edit device configuration failed.");case 42:return n.prev=42,a("CLEAR_SEMAPHORE",{type:r.routingKey===t.DevicesModule.DEVICES_CONFIGURATION_UPDATED_ENTITY?pe.UPDATING:pe.CREATING,id:c.id}),n.finish(42);case 45:return n.abrupt("return",!0);case 48:return n.abrupt("return",!1);case 49:case"end":return n.stop()}}),n,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(J(He={},"SET_SEMAPHORE",(function(e,t){switch(t.type){case pe.FETCHING:e.semaphore.fetching.items.push(t.id),e.semaphore.fetching.items=G.default(e.semaphore.fetching.items);break;case pe.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=G.default(e.semaphore.fetching.item);break;case pe.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=G.default(e.semaphore.creating);break;case pe.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=G.default(e.semaphore.updating);break;case pe.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=G.default(e.semaphore.deleting)}})),J(He,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case pe.FETCHING:e.semaphore.fetching.items.forEach((function(r,n){r===t.id&&e.semaphore.fetching.items.splice(n,1)}));break;case pe.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case pe.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case pe.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case pe.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),J(He,"RESET_STATE",(function(e){Object.assign(e,ot)})),He)},st=new S.default({modelPropertiesMapper:new qe,jsonPropertiesMapper:new ze}),dt={dataTransformer:function(e){return st.deserialize(e.data)}},pt=new x.default,lt={semaphore:{fetching:{item:[]},creating:[],updating:[],deleting:[]}},ft={state:function(){return lt},actions:{get:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.device.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:we.GETTING,id:t.device.id}),r.prev=4,r.next=7,_e.api().get("".concat(Be,"/v1/devices/").concat(t.device.id,"/connector"),dt);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new Ce("devices-module.device-connector.get.failed",r.t0,"Fetching device connector failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:we.GETTING,id:t.device.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},add:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.commit,i=void 0!==t.id&&null!==t.id&&""!==t.id?t.id:C.default.v4().toString(),a=void 0!==t.draft&&t.draft,n("SET_SEMAPHORE",{type:we.CREATING,id:i}),r.prev=4,r.next=7,_e.insert({data:Object.assign({},t.data,{id:i,draft:a,deviceId:t.device.id,connectorId:t.connector.id})});case 7:r.next=13;break;case 9:throw r.prev=9,r.t0=r.catch(4),n("CLEAR_SEMAPHORE",{type:we.CREATING,id:i}),new Pe("devices-module.device-connector.create.failed",r.t0,"Create device connector failed.");case 13:if(null!==(c=_e.find(i))){r.next=19;break}return r.next=17,_e.delete(i);case 17:throw n("CLEAR_SEMAPHORE",{type:we.CREATING,id:i}),new Error("devices-module.device-connector.create.failed");case 19:if(!a){r.next=24;break}return n("CLEAR_SEMAPHORE",{type:we.CREATING,id:i}),r.abrupt("return",_e.find(i));case 24:return r.prev=24,r.next=27,_e.api().post("".concat(Be,"/v1/devices/").concat(t.device.id,"/connector"),st.serialize({stuff:c}),dt);case 27:return r.abrupt("return",_e.find(i));case 30:return r.prev=30,r.t1=r.catch(24),r.next=34,_e.delete(i);case 34:throw new Ce("devices-module.device-connector.create.failed",r.t1,"Create device connector failed.");case 35:return r.prev=35,n("CLEAR_SEMAPHORE",{type:we.CREATING,id:i}),r.finish(35);case 38:case"end":return r.stop()}}),r,null,[[4,9],[24,30,35,38]])})))()},edit:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.connector.id)){r.next=3;break}throw new Error("devices-module.device-connector.update.inProgress");case 3:if(_e.query().where("id",t.connector.id).exists()){r.next=5;break}throw new Error("devices-module.device-connector.update.failed");case 5:return i("SET_SEMAPHORE",{type:we.UPDATING,id:t.connector.id}),r.prev=6,r.next=9,_e.update({where:t.connector.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:we.UPDATING,id:t.connector.id}),new Pe("devices-module.device-connector.update.failed",r.t0,"Edit device connector failed.");case 15:if(null!==(a=_e.find(t.connector.id))){r.next=23;break}if(null===(c=Se.find(t.connector.deviceId))){r.next=21;break}return r.next=21,_e.get(c);case 21:throw i("CLEAR_SEMAPHORE",{type:we.UPDATING,id:t.connector.id}),new Error("devices-module.device-connector.update.failed");case 23:if(!a.draft){r.next=28;break}return i("CLEAR_SEMAPHORE",{type:we.UPDATING,id:t.connector.id}),r.abrupt("return",_e.find(t.connector.id));case 28:return r.prev=28,r.next=31,_e.api().patch("".concat(Be,"/v1/devices/").concat(a.deviceId,"/connector"),st.serialize({stuff:a}),dt);case 31:return r.abrupt("return",_e.find(t.connector.id));case 34:if(r.prev=34,r.t1=r.catch(28),null===(o=Se.find(t.connector.deviceId))){r.next=40;break}return r.next=40,_e.get(o);case 40:throw new Ce("devices-module.device-connector.update.failed",r.t1,"Edit device connector failed.");case 41:return r.prev=41,i("CLEAR_SEMAPHORE",{type:we.UPDATING,id:t.connector.id}),r.finish(41);case 44:case"end":return r.stop()}}),r,null,[[6,11],[28,34,41,44]])})))()},save:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.connector.id)){r.next=3;break}throw new Error("devices-module.device-connector.save.inProgress");case 3:if(_e.query().where("id",t.connector.id).where("draft",!0).exists()){r.next=5;break}throw new Error("devices-module.device-connector.save.failed");case 5:if(i("SET_SEMAPHORE",{type:we.UPDATING,id:t.connector.id}),null!==(a=_e.find(t.connector.id))){r.next=10;break}throw i("CLEAR_SEMAPHORE",{type:we.UPDATING,id:t.connector.id}),new Error("devices-module.device-connector.save.failed");case 10:return r.prev=10,r.next=13,_e.api().post("".concat(Be,"/v1/devices/").concat(a.deviceId,"/connector"),st.serialize({stuff:a}),dt);case 13:return r.abrupt("return",_e.find(t.connector.id));case 16:throw r.prev=16,r.t0=r.catch(10),new Ce("devices-module.device-connector.save.failed",r.t0,"Save draft device connector failed.");case 19:return r.prev=19,i("CLEAR_SEMAPHORE",{type:we.UPDATING,id:t.connector.id}),r.finish(19);case 22:case"end":return r.stop()}}),r,null,[[10,16,19,22]])})))()},socketData:function(e,r){return z(regeneratorRuntime.mark((function n(){var i,a,c,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.state,a=e.commit,r.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){n.next=3;break}return n.abrupt("return",!1);case 3:if([t.DevicesModule.DEVICES_CONNECTOR_CREATED_ENTITY,t.DevicesModule.DEVICES_CONNECTOR_UPDATED_ENTITY,t.DevicesModule.DEVICES_CONNECTOR_DELETED_ENTITY].includes(r.routingKey)){n.next=5;break}return n.abrupt("return",!1);case 5:if(c=JSON.parse(r.data),!pt.compile(U)(c)){n.next=48;break}if(_e.query().where("id",c.id).exists()||r.routingKey!==t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY&&r.routingKey!==t.DevicesModule.DEVICES_PROPERTY_DELETED_ENTITY){n.next=10;break}throw new Error("devices-module.device-connector.update.failed");case 10:if(r.routingKey!==t.DevicesModule.DEVICES_PROPERTY_DELETED_ENTITY){n.next=25;break}return a("SET_SEMAPHORE",{type:we.DELETING,id:c.id}),n.prev=12,n.next=15,_e.delete(c.id);case 15:n.next=20;break;case 17:throw n.prev=17,n.t0=n.catch(12),new Pe("devices-module.device-connector.delete.failed",n.t0,"Delete device connector failed.");case 20:return n.prev=20,a("CLEAR_SEMAPHORE",{type:we.DELETING,id:c.id}),n.finish(20);case 23:n.next=45;break;case 25:if(r.routingKey!==t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY||!i.semaphore.updating.includes(c.id)){n.next=27;break}return n.abrupt("return",!0);case 27:return a("SET_SEMAPHORE",{type:r.routingKey===t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY?we.UPDATING:we.CREATING,id:c.id}),o={type:Ne.CONNECTOR},Object.keys(c).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("device"===t){var r=Se.query().where("identifier",c[e]).first();null!==r&&(o.deviceId=r.id)}else o[t]=c[e]})),n.prev=30,n.next=33,_e.insertOrUpdate({data:o});case 33:n.next=42;break;case 35:if(n.prev=35,n.t1=n.catch(30),null===(u=_e.query().with("device").where("id",c.id).first())||null===u.device){n.next=41;break}return n.next=41,_e.get(u.device);case 41:throw new Pe("devices-module.device-connector.update.failed",n.t1,"Edit device connector failed.");case 42:return n.prev=42,a("CLEAR_SEMAPHORE",{type:r.routingKey===t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY?we.UPDATING:we.CREATING,id:c.id}),n.finish(42);case 45:return n.abrupt("return",!0);case 48:return n.abrupt("return",!1);case 49:case"end":return n.stop()}}),n,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(J(Le={},"SET_SEMAPHORE",(function(e,t){switch(t.type){case we.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=G.default(e.semaphore.fetching.item);break;case we.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=G.default(e.semaphore.creating);break;case we.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=G.default(e.semaphore.updating);break;case we.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=G.default(e.semaphore.deleting)}})),J(Le,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case we.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case we.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case we.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case we.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),J(Le,"RESET_STATE",(function(e){Object.assign(e,lt)})),Le)},ht=new S.default({modelPropertiesMapper:new qe,jsonPropertiesMapper:new ze}),Et={dataTransformer:function(e){return ht.deserialize(e.data)}},vt=new x.default,mt={semaphore:{fetching:{items:[],item:[]},creating:[],updating:[],deleting:[]},firstLoad:[]},gt={state:function(){return mt},getters:{firstLoadFinished:function(e){return function(t){return e.firstLoad.includes(t)}},getting:function(e){return function(t){return e.semaphore.fetching.item.includes(t)}},fetching:function(e){return function(t){return null!==t?e.semaphore.fetching.items.includes(t):e.semaphore.fetching.items.length>0}}},actions:{get:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:ve.GETTING,id:t.id}),r.prev=4,r.next=7,Ae.api().get("".concat(Be,"/v1/devices/").concat(t.device.id,"/channels/").concat(t.id,"?include=properties,configuration"),Et);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new Ce("devices-module.channels.get.failed",r.t0,"Fetching channel failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:ve.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items.includes(t.device.id)&&!t.device.draft){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:ve.FETCHING,id:t.device.id}),r.prev=4,r.next=7,Ae.api().get("".concat(Be,"/v1/devices/").concat(t.device.id,"/channels?include=properties,configuration"),Et);case 7:return i("SET_FIRST_LOAD",{id:t.device.id}),r.abrupt("return",!0);case 11:throw r.prev=11,r.t0=r.catch(4),new Ce("devices-module.channels.fetch.failed",r.t0,"Fetching channels failed.");case 14:return r.prev=14,i("CLEAR_SEMAPHORE",{type:ve.FETCHING,id:t.device.id}),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[4,11,14,17]])})))()},edit:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.channel.id)){r.next=3;break}throw new Error("devices-module.channels.update.inProgress");case 3:if(Ae.query().where("id",t.channel.id).exists()){r.next=5;break}throw new Error("devices-module.channels.update.failed");case 5:return i("SET_SEMAPHORE",{type:ve.UPDATING,id:t.channel.id}),r.prev=6,r.next=9,Ae.update({where:t.channel.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:ve.UPDATING,id:t.channel.id}),new Pe("devices-module.channels.edit.failed",r.t0,"Edit channel failed.");case 15:if(null!==(a=Ae.find(t.channel.id))){r.next=23;break}if(null===(c=Se.find(t.channel.deviceId))){r.next=21;break}return r.next=21,Ae.get(c,t.channel.id);case 21:throw i("CLEAR_SEMAPHORE",{type:ve.UPDATING,id:t.channel.id}),new Error("devices-module.channels.update.failed");case 23:return r.prev=23,r.next=26,Ae.api().patch("".concat(Be,"/v1/devices/").concat(a.deviceId,"/channels/").concat(a.id,"?include=properties,configuration"),ht.serialize({stuff:a}),Et);case 26:return r.abrupt("return",Ae.find(t.channel.id));case 29:if(r.prev=29,r.t1=r.catch(23),null===(o=Se.find(t.channel.deviceId))){r.next=35;break}return r.next=35,Ae.get(o,t.channel.id);case 35:throw new Ce("devices-module.channels.update.failed",r.t1,"Edit channel failed.");case 36:return r.prev=36,i("CLEAR_SEMAPHORE",{type:ve.UPDATING,id:t.channel.id}),r.finish(36);case 39:case"end":return r.stop()}}),r,null,[[6,11],[23,29,36,39]])})))()},transmitCommand:function(e,r){if(!Ae.query().where("id",r.channel.id).exists())throw new Error("devices-module.channel.transmit.failed");var n=Se.find(r.channel.deviceId);if(null===n)throw new Error("devices-module.channel.transmit.failed");return new Promise((function(e,i){Ae.wamp().call({routing_key:t.DevicesModule.CHANNELS_CONTROLS,origin:Ae.$devicesModuleOrigin,data:{control:r.command,device:n.key,channel:r.channel.key}}).then((function(t){"accepted"===P.default(t.data,"response")?e(!0):i(new Error("devices-module.channel.transmit.failed"))})).catch((function(){i(new Error("devices-module.channel.transmit.failed"))}))}))},socketData:function(e,r){return z(regeneratorRuntime.mark((function n(){var i,a,c,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.state,a=e.commit,r.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){n.next=3;break}return n.abrupt("return",!1);case 3:if([t.DevicesModule.CHANNELS_CREATED_ENTITY,t.DevicesModule.CHANNELS_UPDATED_ENTITY,t.DevicesModule.CHANNELS_DELETED_ENTITY].includes(r.routingKey)){n.next=5;break}return n.abrupt("return",!1);case 5:if(c=JSON.parse(r.data),!vt.compile(F)(c)){n.next=48;break}if(Ae.query().where("id",c.id).exists()||r.routingKey!==t.DevicesModule.CHANNELS_UPDATED_ENTITY&&r.routingKey!==t.DevicesModule.CHANNELS_DELETED_ENTITY){n.next=10;break}throw new Error("devices-module.channels.update.failed");case 10:if(r.routingKey!==t.DevicesModule.CHANNELS_DELETED_ENTITY){n.next=25;break}return a("SET_SEMAPHORE",{type:ve.DELETING,id:c.id}),n.prev=12,n.next=15,Ae.delete(c.id);case 15:n.next=20;break;case 17:throw n.prev=17,n.t0=n.catch(12),new Pe("devices-module.channels.delete.failed",n.t0,"Delete channel failed.");case 20:return n.prev=20,a("CLEAR_SEMAPHORE",{type:ve.DELETING,id:c.id}),n.finish(20);case 23:n.next=45;break;case 25:if(r.routingKey!==t.DevicesModule.CHANNELS_UPDATED_ENTITY||!i.semaphore.updating.includes(c.id)){n.next=27;break}return n.abrupt("return",!0);case 27:return a("SET_SEMAPHORE",{type:r.routingKey===t.DevicesModule.CHANNELS_UPDATED_ENTITY?ve.UPDATING:ve.CREATING,id:c.id}),o={type:me.CHANNEL},Object.keys(c).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("device"===t){var r=Se.query().where("identifier",c[e]).first();null!==r&&(o.deviceId=r.id)}else o[t]=c[e]})),n.prev=30,n.next=33,Ae.insertOrUpdate({data:o});case 33:n.next=42;break;case 35:if(n.prev=35,n.t1=n.catch(30),null===(u=Ae.query().with("device").where("id",c.id).first())||null===u.device){n.next=41;break}return n.next=41,Ae.get(u.device,c.id);case 41:throw new Pe("devices-module.channels.update.failed",n.t1,"Edit channel failed.");case 42:return n.prev=42,a("CLEAR_SEMAPHORE",{type:r.routingKey===t.DevicesModule.CHANNELS_UPDATED_ENTITY?ve.UPDATING:ve.CREATING,id:c.id}),n.finish(42);case 45:return n.abrupt("return",!0);case 48:return n.abrupt("return",!1);case 49:case"end":return n.stop()}}),n,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(J(Ue={},"SET_FIRST_LOAD",(function(e,t){e.firstLoad.push(t.id),e.firstLoad=G.default(e.firstLoad)})),J(Ue,"SET_SEMAPHORE",(function(e,t){switch(t.type){case ve.FETCHING:e.semaphore.fetching.items.push(t.id),e.semaphore.fetching.items=G.default(e.semaphore.fetching.items);break;case ve.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=G.default(e.semaphore.fetching.item);break;case ve.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=G.default(e.semaphore.creating);break;case ve.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=G.default(e.semaphore.updating);break;case ve.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=G.default(e.semaphore.deleting)}})),J(Ue,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case ve.FETCHING:e.semaphore.fetching.items.forEach((function(r,n){r===t.id&&e.semaphore.fetching.items.splice(n,1)}));break;case ve.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case ve.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case ve.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case ve.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),J(Ue,"RESET_STATE",(function(e){Object.assign(e,mt)})),Ue)},Tt=new S.default({modelPropertiesMapper:new qe,jsonPropertiesMapper:new ze}),yt={dataTransformer:function(e){return Tt.deserialize(e.data)}},Rt=new x.default,wt={semaphore:{fetching:{items:[],item:[]},creating:[],updating:[],deleting:[]}},Nt={state:function(){return wt},actions:{get:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:ge.GETTING,id:t.id}),r.prev=4,r.next=7,Ie.api().get("".concat(Be,"/v1/devices/").concat(t.channel.deviceId,"/channels/").concat(t.channel.id,"/properties/").concat(t.id),yt);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new Ce("devices-module.channel-properties.fetch.failed",r.t0,"Fetching channel property failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:ge.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items.includes(t.channel.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:ge.FETCHING,id:t.channel.id}),r.prev=4,r.next=7,Ie.api().get("".concat(Be,"/v1/devices/").concat(t.channel.deviceId,"/channels/").concat(t.channel.id,"/properties"),yt);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new Ce("devices-module.channel-properties.fetch.failed",r.t0,"Fetching channel properties failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:ge.FETCHING,id:t.channel.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},edit:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.property.id)){r.next=3;break}throw new Error("devices-module.channel-properties.update.inProgress");case 3:if(Ie.query().where("id",t.property.id).exists()){r.next=5;break}throw new Error("devices-module.channel-properties.update.failed");case 5:return i("SET_SEMAPHORE",{type:ge.UPDATING,id:t.property.id}),r.prev=6,r.next=9,Ie.update({where:t.property.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:ge.UPDATING,id:t.property.id}),new Pe("devices-module.channel-properties.update.failed",r.t0,"Edit channel property failed.");case 15:if(null!==(a=Ie.find(t.property.id))){r.next=23;break}if(null===(c=Ae.find(t.property.channelId))){r.next=21;break}return r.next=21,Ie.get(c,t.property.id);case 21:throw i("CLEAR_SEMAPHORE",{type:ge.UPDATING,id:t.property.id}),new Error("devices-module.channel-properties.update.failed");case 23:if(null!==(o=Ae.find(t.property.channelId))){r.next=26;break}throw new Error("devices-module.channel-properties.update.failed");case 26:return r.prev=26,r.next=29,Ie.api().patch("".concat(Be,"/v1/devices/").concat(o.deviceId,"/channels/").concat(a.channelId,"/properties/").concat(a.id),Tt.serialize({stuff:a}),yt);case 29:return r.abrupt("return",Ie.find(t.property.id));case 32:return r.prev=32,r.t1=r.catch(26),r.next=36,Ie.get(o,t.property.id);case 36:throw new Ce("devices-module.channel-properties.update.failed",r.t1,"Edit channel property failed.");case 37:return r.prev=37,i("CLEAR_SEMAPHORE",{type:ge.UPDATING,id:t.property.id}),r.finish(37);case 40:case"end":return r.stop()}}),r,null,[[6,11],[26,32,37,40]])})))()},transmitData:function(e,r){return z(regeneratorRuntime.mark((function e(){var n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ie.query().where("id",r.property.id).exists()){e.next=2;break}throw new Error("devices-module.channel-properties.transmit.failed");case 2:if(null!==(n=Ae.find(r.property.channelId))){e.next=5;break}throw new Error("devices-module.channel-properties.transmit.failed");case 5:if(null!==(i=Se.find(n.deviceId))){e.next=8;break}throw new Error("devices-module.channel-properties.transmit.failed");case 8:return a=r.property.value,e.prev=9,e.next=12,Ie.update({where:r.property.id,data:{value:r.value}});case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(9),new Pe("devices-module.channel-properties.transmit.failed",e.t0,"Edit channel property failed.");case 17:return e.abrupt("return",new Promise((function(e,c){Ie.wamp().call({routing_key:t.DevicesModule.CHANNELS_PROPERTIES_DATA,origin:Ie.$devicesModuleOrigin,data:{device:i.key,channel:n.key,property:r.property.key,expected:r.value}}).then((function(t){"accepted"===P.default(t.data,"response")?e(!0):(Ie.update({where:r.property.id,data:{value:a}}),c(new Error("devices-module.channel-properties.transmit.failed")))})).catch((function(){Ie.update({where:r.property.id,data:{value:a}}),c(new Error("devices-module.channel-properties.transmit.failed"))}))})));case 18:case"end":return e.stop()}}),e,null,[[9,14]])})))()},socketData:function(e,r){return z(regeneratorRuntime.mark((function n(){var i,a,c,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.state,a=e.commit,r.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){n.next=3;break}return n.abrupt("return",!1);case 3:if([t.DevicesModule.CHANNELS_PROPERTY_CREATED_ENTITY,t.DevicesModule.CHANNELS_PROPERTY_UPDATED_ENTITY,t.DevicesModule.CHANNELS_PROPERTY_DELETED_ENTITY].includes(r.routingKey)){n.next=5;break}return n.abrupt("return",!1);case 5:if(c=JSON.parse(r.data),!Rt.compile(Y)(c)){n.next=48;break}if(Ie.query().where("id",c.id).exists()||r.routingKey!==t.DevicesModule.CHANNELS_PROPERTY_UPDATED_ENTITY&&r.routingKey!==t.DevicesModule.CHANNELS_PROPERTY_DELETED_ENTITY){n.next=10;break}throw new Error("devices-module.channel-properties.update.failed");case 10:if(r.routingKey!==t.DevicesModule.CHANNELS_PROPERTY_DELETED_ENTITY){n.next=25;break}return a("SET_SEMAPHORE",{type:ge.DELETING,id:c.id}),n.prev=12,n.next=15,Ie.delete(c.id);case 15:n.next=20;break;case 17:throw n.prev=17,n.t0=n.catch(12),new Pe("devices-module.channel-properties.delete.failed",n.t0,"Delete channel property failed.");case 20:return n.prev=20,a("CLEAR_SEMAPHORE",{type:ge.DELETING,id:c.id}),n.finish(20);case 23:n.next=45;break;case 25:if(r.routingKey!==t.DevicesModule.CHANNELS_PROPERTY_UPDATED_ENTITY||!i.semaphore.updating.includes(c.id)){n.next=27;break}return n.abrupt("return",!0);case 27:return a("SET_SEMAPHORE",{type:r.routingKey===t.DevicesModule.CHANNELS_PROPERTY_UPDATED_ENTITY?ge.UPDATING:ge.CREATING,id:c.id}),o={type:Te.PROPERTY},Object.keys(c).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("channel"===t){var r=Ae.query().where("channel",c[e]).first();null!==r&&(o.channelId=r.id)}else o[t]=c[e]})),n.prev=30,n.next=33,Ie.insertOrUpdate({data:o});case 33:n.next=42;break;case 35:if(n.prev=35,n.t1=n.catch(30),null===(u=Ie.query().with("channel").where("id",c.id).first())||null===u.channel){n.next=41;break}return n.next=41,Ie.get(u.channel,c.id);case 41:throw new Pe("devices-module.channel-properties.update.failed",n.t1,"Edit channel property failed.");case 42:return n.prev=42,a("CLEAR_SEMAPHORE",{type:r.routingKey===t.DevicesModule.CHANNELS_PROPERTY_UPDATED_ENTITY?ge.UPDATING:ge.CREATING,id:c.id}),n.finish(42);case 45:return n.abrupt("return",!0);case 48:return n.abrupt("return",!1);case 49:case"end":return n.stop()}}),n,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(J(Fe={},"SET_SEMAPHORE",(function(e,t){switch(t.type){case ge.FETCHING:e.semaphore.fetching.items.push(t.id),e.semaphore.fetching.items=G.default(e.semaphore.fetching.items);break;case ge.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=G.default(e.semaphore.fetching.item);break;case ge.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=G.default(e.semaphore.creating);break;case ge.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=G.default(e.semaphore.updating);break;case ge.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=G.default(e.semaphore.deleting)}})),J(Fe,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case ge.FETCHING:e.semaphore.fetching.items.forEach((function(r,n){r===t.id&&e.semaphore.fetching.items.splice(n,1)}));break;case ge.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case ge.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case ge.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case ge.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),J(Fe,"RESET_STATE",(function(e){Object.assign(e,wt)})),Fe)},It=new S.default({modelPropertiesMapper:new qe,jsonPropertiesMapper:new ze}),bt={dataTransformer:function(e){return It.deserialize(e.data)}},At=new x.default,Dt={semaphore:{fetching:{items:[],item:[]},creating:[],updating:[],deleting:[]}},kt={state:function(){return Dt},actions:{get:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:De.GETTING,id:t.id}),r.prev=4,r.next=7,be.api().get("".concat(Be,"/v1/devices/").concat(t.channel.deviceId,"/channels/").concat(t.channel.id,"/configuration/").concat(t.id),bt);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new Ce("devices-module.channel-configuration.fetch.failed",r.t0,"Fetching channel configuration failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:De.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items.includes(t.channel.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:De.FETCHING,id:t.channel.id}),r.prev=4,r.next=7,be.api().get("".concat(Be,"/v1/devices/").concat(t.channel.deviceId,"/channels/").concat(t.channel.id,"/configuration"),bt);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new Ce("devices-module.channel-configuration.fetch.failed",r.t0,"Fetching channel configuration failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:De.FETCHING,id:t.channel.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},edit:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.configuration.id)){r.next=3;break}throw new Error("devices-module.channel-configuration.update.inProgress");case 3:if(be.query().where("id",t.configuration.id).exists()){r.next=5;break}throw new Error("devices-module.channel-configuration.update.failed");case 5:return i("SET_SEMAPHORE",{type:De.UPDATING,id:t.configuration.id}),r.prev=6,r.next=9,be.update({where:t.configuration.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:De.UPDATING,id:t.configuration.id}),new Pe("devices-module.channel-configuration.update.failed",r.t0,"Edit channel configuration failed.");case 15:if(null!==(a=be.find(t.configuration.id))){r.next=23;break}if(null===(c=Ae.find(t.configuration.channelId))){r.next=21;break}return r.next=21,be.get(c,t.configuration.id);case 21:throw i("CLEAR_SEMAPHORE",{type:De.UPDATING,id:t.configuration.id}),new Error("devices-module.channel-configuration.update.failed");case 23:if(null!==(o=Ae.find(t.configuration.channelId))){r.next=26;break}throw new Error("devices-module.channel-configuration.update.failed");case 26:return r.prev=26,r.next=29,be.api().patch("".concat(Be,"/v1/devices/").concat(o.deviceId,"/channels/").concat(a.channelId,"/configuration/").concat(a.id),It.serialize({stuff:a}),bt);case 29:return r.abrupt("return",be.find(t.configuration.id));case 32:return r.prev=32,r.t1=r.catch(26),r.next=36,be.get(o,t.configuration.id);case 36:throw new Ce("devices-module.channel-configuration.update.failed",r.t1,"Edit channel configuration failed.");case 37:return r.prev=37,i("CLEAR_SEMAPHORE",{type:De.UPDATING,id:t.configuration.id}),r.finish(37);case 40:case"end":return r.stop()}}),r,null,[[6,11],[26,32,37,40]])})))()},transmitData:function(e,r){return z(regeneratorRuntime.mark((function e(){var n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(be.query().where("id",r.configuration.id).exists()){e.next=2;break}throw new Error("devices-module.channel-configuration.transmit.failed");case 2:if(null!==(n=Ae.find(r.configuration.channelId))){e.next=5;break}throw new Error("devices-module.channel-configuration.transmit.failed");case 5:if(null!==(i=Se.find(n.deviceId))){e.next=8;break}throw new Error("devices-module.channel-configuration.transmit.failed");case 8:return a=r.configuration.value,e.prev=9,e.next=12,be.update({where:r.configuration.id,data:{value:r.value}});case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(9),new Pe("devices-module.channel-configuration.transmit.failed",e.t0,"Edit channel configuration failed.");case 17:return e.abrupt("return",new Promise((function(e,c){be.wamp().call({routing_key:t.DevicesModule.CHANNELS_CONFIGURATION_DATA,origin:be.$devicesModuleOrigin,data:{device:i.key,channel:n.key,configuration:r.configuration.key,expected:r.value}}).then((function(t){"accepted"===P.default(t.data,"response")?e(!0):(be.update({where:r.configuration.id,data:{value:a}}),c(new Error("devices-module.channel-configuration.transmit.failed")))})).catch((function(){be.update({where:r.configuration.id,data:{value:a}}),c(new Error("devices-module.channel-configuration.transmit.failed"))}))})));case 18:case"end":return e.stop()}}),e,null,[[9,14]])})))()},socketData:function(e,r){return z(regeneratorRuntime.mark((function n(){var i,a,c,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.state,a=e.commit,r.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){n.next=3;break}return n.abrupt("return",!1);case 3:if([t.DevicesModule.CHANNELS_CONFIGURATION_CREATED_ENTITY,t.DevicesModule.CHANNELS_CONFIGURATION_UPDATED_ENTITY,t.DevicesModule.CHANNELS_CONFIGURATION_DELETED_ENTITY].includes(r.routingKey)){n.next=5;break}return n.abrupt("return",!1);case 5:if(c=JSON.parse(r.data),!At.compile(j)(c)){n.next=48;break}if(be.query().where("id",c.id).exists()||r.routingKey!==t.DevicesModule.CHANNELS_CONFIGURATION_UPDATED_ENTITY&&r.routingKey!==t.DevicesModule.CHANNELS_CONFIGURATION_DELETED_ENTITY){n.next=10;break}throw new Error("devices-module.channel-configuration.update.failed");case 10:if(r.routingKey!==t.DevicesModule.CHANNELS_CONFIGURATION_DELETED_ENTITY){n.next=25;break}return a("SET_SEMAPHORE",{type:De.DELETING,id:c.id}),n.prev=12,n.next=15,be.delete(c.id);case 15:n.next=20;break;case 17:throw n.prev=17,n.t0=n.catch(12),new Pe("devices-module.channel-configuration.delete.failed",n.t0,"Delete channel configuration failed.");case 20:return n.prev=20,a("CLEAR_SEMAPHORE",{type:De.DELETING,id:c.id}),n.finish(20);case 23:n.next=45;break;case 25:if(r.routingKey!==t.DevicesModule.CHANNELS_CONFIGURATION_UPDATED_ENTITY||!i.semaphore.updating.includes(c.id)){n.next=27;break}return n.abrupt("return",!0);case 27:return a("SET_SEMAPHORE",{type:r.routingKey===t.DevicesModule.CHANNELS_CONFIGURATION_UPDATED_ENTITY?De.UPDATING:De.CREATING,id:c.id}),o={type:ke.CONFIGURATION},Object.keys(c).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("channel"===t){var r=Ae.query().where("channel",c[e]).first();null!==r&&(o.channelId=r.id)}else o[t]=c[e]})),n.prev=30,n.next=33,be.insertOrUpdate({data:o});case 33:n.next=42;break;case 35:if(n.prev=35,n.t1=n.catch(30),null===(u=be.query().with("channel").where("id",c.id).first())||null===u.channel){n.next=41;break}return n.next=41,be.get(u.channel,c.id);case 41:throw new Pe("devices-module.channel-configuration.update.failed",n.t1,"Edit channel configuration failed.");case 42:return n.prev=42,a("CLEAR_SEMAPHORE",{type:r.routingKey===t.DevicesModule.CHANNELS_CONFIGURATION_UPDATED_ENTITY?De.UPDATING:De.CREATING,id:c.id}),n.finish(42);case 45:return n.abrupt("return",!0);case 48:return n.abrupt("return",!1);case 49:case"end":return n.stop()}}),n,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(J(Ye={},"SET_SEMAPHORE",(function(e,t){switch(t.type){case De.FETCHING:e.semaphore.fetching.items.push(t.id),e.semaphore.fetching.items=G.default(e.semaphore.fetching.items);break;case De.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=G.default(e.semaphore.fetching.item);break;case De.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=G.default(e.semaphore.creating);break;case De.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=G.default(e.semaphore.updating);break;case De.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=G.default(e.semaphore.deleting)}})),J(Ye,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case De.FETCHING:e.semaphore.fetching.items.forEach((function(r,n){r===t.id&&e.semaphore.fetching.items.splice(n,1)}));break;case De.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case De.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case De.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case De.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),J(Ye,"RESET_STATE",(function(e){Object.assign(e,Dt)})),Ye)};!function(e){e.FETCHING="fetching",e.GETTING="getting",e.CREATING="creating",e.UPDATING="updating",e.DELETING="deleting"}(je||(je={})),function(e){e.FB_BUS="devices-module/connector-fb-bus",e.FB_MQTT_V1="devices-module/connector-fb-mqtt-v1"}(Ve||(Ve={}));var Ot=new S.default({modelPropertiesMapper:new qe,jsonPropertiesMapper:new ze}),_t={dataTransformer:function(e){return Ot.deserialize(e.data)}},St=new x.default,xt={semaphore:{fetching:{items:!1,item:[]},updating:[]},firstLoad:!1},Ct={state:function(){return xt},getters:{firstLoadFinished:function(e){return function(){return!!e.firstLoad}},getting:function(e){return function(t){return e.semaphore.fetching.item.includes(t)}},fetching:function(e){return function(){return e.semaphore.fetching.items}}},actions:{get:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:je.GETTING,id:t.id}),r.prev=4,r.next=7,Oe.api().get("".concat(Be,"/v1/connectors/").concat(t.id),_t);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new Ce("devices-module.connectors.fetch.failed",r.t0,"Fetching connectors failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:je.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e){return z(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.state,n=e.commit,!r.semaphore.fetching.items){t.next=3;break}return t.abrupt("return",!1);case 3:return n("SET_SEMAPHORE",{type:je.FETCHING}),t.prev=4,t.next=7,Oe.api().get("".concat(Be,"/v1/connectors"),_t);case 7:return n("SET_FIRST_LOAD",!0),t.abrupt("return",!0);case 11:throw t.prev=11,t.t0=t.catch(4),new Ce("devices-module.connectors.fetch.failed",t.t0,"Fetching connectors failed.");case 14:return t.prev=14,n("CLEAR_SEMAPHORE",{type:je.FETCHING}),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[4,11,14,17]])})))()},edit:function(e,t){return z(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.connector.id)){r.next=3;break}throw new Error("devices-module.connectors.update.inProgress");case 3:if(Oe.query().where("id",t.connector.id).exists()){r.next=5;break}throw new Error("devices-module.connectors.update.failed");case 5:return i("SET_SEMAPHORE",{type:je.UPDATING,id:t.connector.id}),r.prev=6,r.next=9,Oe.update({where:t.connector.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:je.UPDATING,id:t.connector.id}),new Pe("devices-module.connectors.update.failed",r.t0,"Edit connector failed.");case 15:if(null!==(a=Oe.find(t.connector.id))){r.next=21;break}return r.next=19,Oe.get(t.connector.id);case 19:throw i("CLEAR_SEMAPHORE",{type:je.UPDATING,id:t.connector.id}),new Error("devices-module.connectors.update.failed");case 21:return r.prev=21,r.next=24,Oe.api().patch("".concat(Be,"/v1/connectors/").concat(a.id),Ot.serialize({stuff:a}),_t);case 24:return r.abrupt("return",Oe.find(t.connector.id));case 27:return r.prev=27,r.t1=r.catch(21),r.next=31,Oe.get(t.connector.id);case 31:throw new Ce("devices-module.connectors.update.failed",r.t1,"Edit connector failed.");case 32:return r.prev=32,i("CLEAR_SEMAPHORE",{type:je.UPDATING,id:t.connector.id}),r.finish(32);case 35:case"end":return r.stop()}}),r,null,[[6,11],[21,27,32,35]])})))()},transmitCommand:function(e,r){if(!Oe.query().where("id",r.connector.id).exists())throw new Error("devices-module.connector.transmit.failed");return new Promise((function(e,n){Oe.wamp().call({routing_key:t.DevicesModule.CONNECTOR_CONTROLS,origin:Oe.$devicesModuleOrigin,data:{control:r.command,connector:r.connector.id}}).then((function(t){"accepted"===P.default(t.data,"response")?e(!0):n(new Error("devices-module.connector.transmit.failed"))})).catch((function(){n(new Error("devices-module.connector.transmit.failed"))}))}))},socketData:function(e,r){return z(regeneratorRuntime.mark((function n(){var i,a,c,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.state,a=e.commit,r.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){n.next=3;break}return n.abrupt("return",!1);case 3:if([t.DevicesModule.CONNECTOR_CREATED_ENTITY,t.DevicesModule.CONNECTOR_UPDATED_ENTITY,t.DevicesModule.CONNECTOR_DELETED_ENTITY].includes(r.routingKey)){n.next=5;break}return n.abrupt("return",!1);case 5:if(c=JSON.parse(r.data),!St.compile(V)(c)){n.next=46;break}if(Oe.query().where("id",c.id).exists()||r.routingKey!==t.DevicesModule.CONNECTOR_UPDATED_ENTITY&&r.routingKey!==t.DevicesModule.CONNECTOR_DELETED_ENTITY){n.next=10;break}throw new Error("devices-module.connectors.update.failed");case 10:if(r.routingKey!==t.DevicesModule.CONNECTOR_DELETED_ENTITY){n.next=25;break}return a("SET_SEMAPHORE",{type:je.DELETING,id:c.id}),n.prev=12,n.next=15,Oe.delete(c.id);case 15:n.next=20;break;case 17:throw n.prev=17,n.t0=n.catch(12),new Pe("devices-module.connectors.delete.failed",n.t0,"Delete connector failed.");case 20:return n.prev=20,a("CLEAR_SEMAPHORE",{type:je.DELETING,id:c.id}),n.finish(20);case 23:n.next=43;break;case 25:if(r.routingKey!==t.DevicesModule.CONNECTOR_UPDATED_ENTITY||!i.semaphore.updating.includes(c.id)){n.next=27;break}return n.abrupt("return",!0);case 27:return a("SET_SEMAPHORE",{type:r.routingKey===t.DevicesModule.CONNECTOR_UPDATED_ENTITY?je.UPDATING:je.CREATING,id:c.id}),o={},Object.keys(c).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));o[t]=c[e]})),n.prev=30,n.next=33,Oe.insertOrUpdate({data:o});case 33:n.next=40;break;case 35:return n.prev=35,n.t1=n.catch(30),n.next=39,Oe.get(c.id);case 39:throw new Pe("devices-module.connectors.update.failed",n.t1,"Edit connector failed.");case 40:return n.prev=40,a("CLEAR_SEMAPHORE",{type:r.routingKey===t.DevicesModule.CONNECTOR_UPDATED_ENTITY?je.UPDATING:je.CREATING,id:c.id}),n.finish(40);case 43:return n.abrupt("return",!0);case 46:return n.abrupt("return",!1);case 47:case"end":return n.stop()}}),n,null,[[12,17,20,23],[30,35,40,43]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(J(Ke={},"SET_FIRST_LOAD",(function(e,t){e.firstLoad=t})),J(Ke,"SET_SEMAPHORE",(function(e,t){switch(t.type){case je.FETCHING:e.semaphore.fetching.items=!0;break;case je.GETTING:e.semaphore.fetching.item.push(P.default(t,"id","notValid")),e.semaphore.fetching.item=G.default(e.semaphore.fetching.item);break;case je.UPDATING:e.semaphore.updating.push(P.default(t,"id","notValid")),e.semaphore.updating=G.default(e.semaphore.updating)}})),J(Ke,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case je.FETCHING:e.semaphore.fetching.items=!1;break;case je.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===P.default(t,"id","notValid")&&e.semaphore.fetching.item.splice(n,1)}));break;case je.UPDATING:e.semaphore.updating.forEach((function(r,n){r===P.default(t,"id","notValid")&&e.semaphore.updating.splice(n,1)}))}})),J(Ke,"RESET_STATE",(function(e){Object.assign(e,xt)})),Ke)},Pt={install:function(e,r){void 0!==r.originName?e.Model.prototype.$devicesModuleOrigin=r.originName:e.Model.prototype.$devicesModuleOrigin=t.ModuleOrigin.MODULE_DEVICES_ORIGIN,r.database.register(Se,Qe),r.database.register(Ee,nt),r.database.register(Re,ut),r.database.register(_e,ft),r.database.register(Ae,gt),r.database.register(Ie,Nt),r.database.register(be,kt),r.database.register(Oe,Ct)}};return e.default=Pt,Object.defineProperty(e,"__esModule",{value:!0}),e}({},modulesMetadata,core,capitalize,exchangeEntitySchema,Jsona,Ajv,uuid,get,uniq,simplePropertyMappers,clone,exchangeEntitySchema$1,exchangeEntitySchema$2,exchangeEntitySchema$3,exchangeEntitySchema$4,exchangeEntitySchema$5,exchangeEntitySchema$6,exchangeEntitySchema$7);