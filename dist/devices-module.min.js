var DevicesModule=function(e,t,r,n,i,a,c,o,s,u,d,p,l,f,h,v,E,m,g){"use strict";function y(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function T(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var w,b,R,N,I,A,D=y(n),S=T(i),O=y(a),k=y(c),_=y(s),C=y(u),x=y(p),P=T(l),M=T(f),G=T(h),H=T(v),L=T(E),U=T(m),Y=T(g);function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t,r,n,i,a,c){try{var o=e[a](c),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(n,i)}function $(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function c(e){j(a,n,i,c,o,"next",e)}function o(e){j(a,n,i,c,o,"throw",e)}c(void 0)}))}}function V(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function K(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function q(e,t,r){return t&&K(e.prototype,t),r&&K(e,r),e}function z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function B(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function W(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Q(e,t,r){return(Q=W()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&J(i,r.prototype),i}).apply(null,arguments)}function X(e){var t="function"==typeof Map?new Map:void 0;return(X=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Q(e,arguments,Z(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),J(n,e)})(e)}function ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function te(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?ee(e):t}function re(e){var t=W();return function(){var r,n=Z(e);if(t){var i=Z(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return te(this,r)}}function ne(e){return function(e){if(Array.isArray(e))return ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ie(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ie(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}e.DeviceEntityTypes=void 0,(e.DeviceEntityTypes||(e.DeviceEntityTypes={})).DEVICE="devices-module/device",e.PropertyNumberDatatypeTypes=void 0,(w=e.PropertyNumberDatatypeTypes||(e.PropertyNumberDatatypeTypes={}))[w.CHAR=t.DataType.CHAR]="CHAR",w[w.UNSIGNED_CHAR=t.DataType.UCHAR]="UNSIGNED_CHAR",w[w.SHORT=t.DataType.SHORT]="SHORT",w[w.UNSIGNED_SHORT=t.DataType.USHORT]="UNSIGNED_SHORT",w[w.INT=t.DataType.INT]="INT",w[w.UNSIGNED_INT=t.DataType.UINT]="UNSIGNED_INT",w[w.FLOAT=t.DataType.FLOAT]="FLOAT",e.PropertyIntegerDatatypeTypes=void 0,(b=e.PropertyIntegerDatatypeTypes||(e.PropertyIntegerDatatypeTypes={}))[b.CHAR=t.DataType.CHAR]="CHAR",b[b.UNSIGNED_CHAR=t.DataType.UCHAR]="UNSIGNED_CHAR",b[b.SHORT=t.DataType.SHORT]="SHORT",b[b.UNSIGNED_SHORT=t.DataType.USHORT]="UNSIGNED_SHORT",b[b.INT=t.DataType.INT]="INT",b[b.UNSIGNED_INT=t.DataType.UINT]="UNSIGNED_INT",e.PropertyCommandState=void 0,(R=e.PropertyCommandState||(e.PropertyCommandState={})).SENDING="sending",R.COMPLETED="completed",e.PropertyCommandResult=void 0,(N=e.PropertyCommandResult||(e.PropertyCommandResult={})).OK="ok",N.ERR="err",e.SensorNameTypes=void 0,(I=e.SensorNameTypes||(e.SensorNameTypes={})).SENSOR="sensor",I.AIR_QUALITY="air_quality",I.LIGHT_LEVEL="light_level",I.NOISE_LEVEL="noise_level",I.TEMPERATURE="temperature",I.HUMIDITY="humidity",e.ActorNameTypes=void 0,(A=e.ActorNameTypes||(e.ActorNameTypes={})).ACTOR="actor",A.SWITCH="switch";var ae=function(r){B(i,r);var n=re(i);function i(){var e;V(this,i);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return z(ee(e=n.call.apply(n,[this].concat(r))),"id",void 0),z(ee(e),"key",void 0),z(ee(e),"identifier",void 0),z(ee(e),"name",void 0),z(ee(e),"settable",void 0),z(ee(e),"queryable",void 0),z(ee(e),"dataType",void 0),z(ee(e),"unit",void 0),z(ee(e),"format",void 0),z(ee(e),"value",void 0),z(ee(e),"expected",void 0),z(ee(e),"pending",void 0),z(ee(e),"command",void 0),z(ee(e),"lastResult",void 0),z(ee(e),"backup",void 0),z(ee(e),"relationshipNames",void 0),z(ee(e),"device",void 0),z(ee(e),"deviceBackward",void 0),z(ee(e),"deviceId",void 0),e}return q(i,[{key:"isAnalogSensor",get:function(){return!this.isSettable&&Object.values(e.PropertyNumberDatatypeTypes).includes(this.dataType)}},{key:"isBinarySensor",get:function(){return!this.isSettable&&[t.DataType.BOOLEAN].includes(this.dataType)}},{key:"isAnalogActor",get:function(){return this.isSettable&&Object.values(e.PropertyNumberDatatypeTypes).includes(this.dataType)}},{key:"isBinaryActor",get:function(){return this.isSettable&&[t.DataType.BOOLEAN].includes(this.dataType)}},{key:"isSwitch",get:function(){return"switch"===this.identifier}},{key:"isInteger",get:function(){return Object.values(e.PropertyIntegerDatatypeTypes).includes(this.dataType)}},{key:"isFloat",get:function(){return this.dataType===t.DataType.FLOAT}},{key:"isNumber",get:function(){return Object.values(e.PropertyNumberDatatypeTypes).includes(this.dataType)}},{key:"isBoolean",get:function(){return this.dataType===t.DataType.BOOLEAN}},{key:"isString",get:function(){return this.dataType===t.DataType.STRING}},{key:"isEnum",get:function(){return this.dataType===t.DataType.ENUM}},{key:"isColor",get:function(){return this.dataType===t.DataType.COLOR}},{key:"isSettable",get:function(){return this.settable}},{key:"isQueryable",get:function(){return this.queryable}},{key:"binaryValue",get:function(){return null!==this.value&&(this.isBoolean?"boolean"==typeof this.value?this.value:["true","1","t","y","yes"].includes(this.value.toString().toLocaleLowerCase()):!!this.isEnum&&"on"===this.value)}},{key:"binaryExpected",get:function(){return null===this.expected?null:this.isBoolean?"boolean"==typeof this.expected?this.expected:["true","1","t","y","yes"].includes(this.expected.toString().toLocaleLowerCase()):!!this.isEnum&&"on"===this.expected}},{key:"analogValue",get:function(){var e=i.store();if(null!==this.device&&this.device.hardwareManufacturer===t.HardwareManufacturer.ITEAD&&Object.prototype.hasOwnProperty.call(e,"$i18n"))switch(this.identifier){case"air_quality":return this.value>7?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.unhealthy")).toString():this.value>4?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.moderate")).toString():e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.good")).toString();case"light_level":return this.value>8?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.dusky")).toString():this.value>4?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.normal")).toString():e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.bright")).toString();case"noise_level":return this.value>6?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.noisy")).toString():this.value>3?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.normal")).toString():e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.quiet")).toString()}return this.formattedValue}},{key:"analogExpected",get:function(){if(null===this.expected)return null;var e=i.store();if(null!==this.device&&this.device.hardwareManufacturer===t.HardwareManufacturer.ITEAD&&Object.prototype.hasOwnProperty.call(e,"$i18n"))switch(this.identifier){case"air_quality":return this.expected>7?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.unhealthy")).toString():this.expected>4?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.moderate")).toString():e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.good")).toString();case"light_level":return this.expected>8?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.dusky")).toString():this.expected>4?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.normal")).toString():e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.bright")).toString();case"noise_level":return this.expected>6?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.noisy")).toString():this.expected>3?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.normal")).toString():e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".values.quiet")).toString()}return this.formattedValue}},{key:"formattedValue",get:function(){var e,t,r,n=parseFloat(this.value),i="".concat(n).replace(/[^0-9+\-Ee.]/g,""),a=isFinite(+i)?+i:0,c=isFinite(2)?Math.abs(2):0,o=(c?(e=a,t=c,r=Math.pow(10,t),"".concat(Math.round(e*r)/r)):"".concat(Math.round(a))).split(".");return o[0].length>3&&(o[0]=o[0].replace(/\B(?=(?:\d{3})+(?!\d))/g," ")),(o[1]||"").length<c&&(o[1]=o[1]||"",o[1]+=new Array(c-o[1].length+1).join("0")),o.join(",")}},{key:"icon",get:function(){switch(this.identifier){case"temperature":return"thermometer-half";case"humidity":return"tint";case"air_quality":return"fan";case"light_level":return"sun";case"noise_level":return"microphone-alt";case"power":return"plug";case"current":case"voltage":return"bolt";case"energy":return"calculator"}return"chart-bar"}}],[{key:"fields",value:function(){return{id:this.string(""),key:this.string(""),identifier:this.string(""),name:this.string(null).nullable(),settable:this.boolean(!1),queryable:this.boolean(!1),dataType:this.string(""),unit:this.string(null).nullable(),format:this.string(null).nullable(),value:this.attr(null).nullable(),expected:this.attr(null).nullable(),pending:this.boolean(!1),device:this.belongsTo(Ee,"id"),deviceBackward:this.hasOne(Ee,"id","deviceId"),deviceId:this.string(""),relationshipNames:this.attr([])}}}]),i}(r.Model);e.DevicePropertyEntityTypes=void 0,(e.DevicePropertyEntityTypes||(e.DevicePropertyEntityTypes={})).PROPERTY="devices-module/device-property";var ce,oe,se=function(t){B(c,t);var r,n,i,a=re(c);function c(){var e;V(this,c);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return z(ee(e=a.call.apply(a,[this].concat(r))),"type",void 0),e}return q(c,[{key:"title",get:function(){if(null!==this.name)return this.name;var e=c.store();return null!==this.device&&!this.device.isCustomModel&&Object.prototype.hasOwnProperty.call(e,"$i18n")&&e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".title")).toString().includes("devices.vendors.")?e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".title")).toString():D.default(this.identifier)}}],[{key:"entity",get:function(){return"device_property"}},{key:"fields",value:function(){return Object.assign(ae.fields(),{type:this.string(e.DevicePropertyEntityTypes.PROPERTY)})}},{key:"get",value:(i=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("get",{device:t,id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"fetch",value:(n=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("fetch",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"edit",value:(r=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("edit",{property:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"transmitData",value:function(e,t){return c.dispatch("transmitData",{property:e,value:t})}},{key:"reset",value:function(){c.dispatch("reset")}}]),c}(ae);e.DeviceConfigurationEntityTypes=void 0,(e.DeviceConfigurationEntityTypes||(e.DeviceConfigurationEntityTypes={})).CONFIGURATION="devices-module/device-configuration",e.ConfigurationNumberDatatypeTypes=void 0,(ce=e.ConfigurationNumberDatatypeTypes||(e.ConfigurationNumberDatatypeTypes={}))[ce.CHAR=t.DataType.CHAR]="CHAR",ce[ce.UNSIGNED_CHAR=t.DataType.UCHAR]="UNSIGNED_CHAR",ce[ce.SHORT=t.DataType.SHORT]="SHORT",ce[ce.UNSIGNED_SHORT=t.DataType.USHORT]="UNSIGNED_SHORT",ce[ce.INT=t.DataType.INT]="INT",ce[ce.UNSIGNED_INT=t.DataType.UINT]="UNSIGNED_INT",ce[ce.FLOAT=t.DataType.FLOAT]="FLOAT",e.ConfigurationIntegerDatatypeTypes=void 0,(oe=e.ConfigurationIntegerDatatypeTypes||(e.ConfigurationIntegerDatatypeTypes={}))[oe.CHAR=t.DataType.CHAR]="CHAR",oe[oe.UNSIGNED_CHAR=t.DataType.UCHAR]="UNSIGNED_CHAR",oe[oe.SHORT=t.DataType.SHORT]="SHORT",oe[oe.UNSIGNED_SHORT=t.DataType.USHORT]="UNSIGNED_SHORT",oe[oe.INT=t.DataType.INT]="INT",oe[oe.UNSIGNED_INT=t.DataType.UINT]="UNSIGNED_INT";var ue=function(r){B(i,r);var n=re(i);function i(){var e;V(this,i);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return z(ee(e=n.call.apply(n,[this].concat(r))),"id",void 0),z(ee(e),"key",void 0),z(ee(e),"identifier",void 0),z(ee(e),"name",void 0),z(ee(e),"comment",void 0),z(ee(e),"value",void 0),z(ee(e),"default",void 0),z(ee(e),"dataType",void 0),z(ee(e),"min",void 0),z(ee(e),"max",void 0),z(ee(e),"step",void 0),z(ee(e),"values",void 0),z(ee(e),"relationshipNames",void 0),e}return q(i,[{key:"isInteger",get:function(){return Object.values(e.ConfigurationIntegerDatatypeTypes).includes(this.dataType)}},{key:"isFloat",get:function(){return this.dataType===t.DataType.FLOAT}},{key:"isNumber",get:function(){return Object.values(e.ConfigurationNumberDatatypeTypes).includes(this.dataType)}},{key:"isBoolean",get:function(){return this.dataType===t.DataType.BOOLEAN}},{key:"isString",get:function(){return this.dataType===t.DataType.STRING}},{key:"isSelect",get:function(){return this.dataType===t.DataType.ENUM}}],[{key:"fields",value:function(){return{id:this.string(""),key:this.string(""),identifier:this.string(""),name:this.string(null).nullable(),comment:this.string(null).nullable(),value:this.attr(null).nullable(),default:this.attr(null).nullable(),dataType:this.string(""),min:this.number(null).nullable(),max:this.number(null).nullable(),step:this.number(null).nullable(),values:this.attr([]),relationshipNames:this.attr([])}}}]),i}(r.Model),de=function(t){B(c,t);var r,n,i,a=re(c);function c(){var e;V(this,c);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return z(ee(e=a.call.apply(a,[this].concat(r))),"type",void 0),z(ee(e),"device",void 0),z(ee(e),"deviceBackward",void 0),z(ee(e),"deviceId",void 0),e}return q(c,[{key:"title",get:function(){if(null!==this.name)return this.name;var e=c.store();return null===this.device||this.device.isCustomModel||!Object.prototype.hasOwnProperty.call(e,"$i18n")||e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".identifier.").concat(this.identifier,".title")).toString().includes("devices.vendors.")?D.default(this.identifier):e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".configuration.").concat(this.identifier,".title")).toString()}},{key:"description",get:function(){if(null!==this.comment)return this.comment;var e=c.store();return null===this.device||this.device.isCustomModel||!Object.prototype.hasOwnProperty.call(e,"$i18n")||e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".configuration.").concat(this.identifier,".description")).toString().includes("devices.vendors.")?null:e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".configuration.").concat(this.identifier,".description")).toString()}},{key:"selectValues",get:function(){var e=this;if(!this.isSelect)throw new Error("This field is not allowed for entity type ".concat(this.type));var t=c.store();if(null!==this.device&&!this.device.isCustomModel&&Object.prototype.hasOwnProperty.call(t,"$i18n")){var r=[];return this.values.forEach((function(n){var i;r.push({value:n.value,name:t.$i18n.t("devices.vendors.".concat(null===(i=e.device)||void 0===i?void 0:i.hardwareManufacturer,".configuration.").concat(e.identifier,".values.").concat(n.name)).toString()})})),r}return this.values}},{key:"formattedValue",get:function(){var e=this;if(this.isSelect){var t=c.store();null!==this.device&&!this.device.isCustomModel&&Object.prototype.hasOwnProperty.call(t,"$i18n")&&this.values.forEach((function(r){var n,i;if(r.value==e.value)return t.$i18n.t("devices.vendors.".concat(null===(n=e.device)||void 0===n?void 0:n.hardwareManufacturer,".configuration.").concat(e.identifier,".values.").concat(r.name)).toString().includes("devices.vendors.")?e.value:t.$i18n.t("devices.vendors.".concat(null===(i=e.device)||void 0===i?void 0:i.hardwareManufacturer,".configuration.").concat(e.identifier,".values.").concat(r.name))}))}return this.value}}],[{key:"entity",get:function(){return"device_configuration"}},{key:"fields",value:function(){return Object.assign(ue.fields(),{type:this.string(e.DeviceConfigurationEntityTypes.CONFIGURATION),device:this.belongsTo(Ee,"id"),deviceBackward:this.hasOne(Ee,"id","deviceId"),deviceId:this.string("")})}},{key:"get",value:(i=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("get",{device:t,id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"fetch",value:(n=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("fetch",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"edit",value:(r=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("edit",{property:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"transmitData",value:function(e,t){return c.dispatch("transmitData",{property:e,value:t})}},{key:"reset",value:function(){c.dispatch("reset")}}]),c}(ue);e.ChannelEntityTypes=void 0,(e.ChannelEntityTypes||(e.ChannelEntityTypes={})).CHANNEL="devices-module/channel",e.ChannelPropertyEntityTypes=void 0,(e.ChannelPropertyEntityTypes||(e.ChannelPropertyEntityTypes={})).PROPERTY="devices-module/channel-property";var pe=function(t){B(c,t);var r,n,i,a=re(c);function c(){var e;V(this,c);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return z(ee(e=a.call.apply(a,[this].concat(r))),"type",void 0),z(ee(e),"channel",void 0),z(ee(e),"channelBackward",void 0),z(ee(e),"channelId",void 0),e}return q(c,[{key:"title",get:function(){if(null!==this.name)return this.name;var e=c.store();if(null!==this.device&&!this.device.isCustomModel&&Object.prototype.hasOwnProperty.call(e,"$i18n")){if(this.identifier.includes("_")){var t=this.identifier.substring(0,this.identifier.indexOf("_")),r=parseInt(this.identifier.substring(this.identifier.indexOf("_")+1),10);if(!e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".devices.").concat(this.device.hardwareModel,".properties.").concat(t,".title")).toString().includes("devices.vendors."))return e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".devices.").concat(this.device.hardwareModel,".properties.").concat(t,".title"),{number:r}).toString();if(!e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(t,".title")).toString().includes("devices.vendors."))return e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(t,".title"),{number:r}).toString()}if(!e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".devices.").concat(this.device.hardwareModel,".properties.").concat(this.identifier,".title")).toString().includes("devices.vendors."))return e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".devices.").concat(this.device.hardwareModel,".properties.").concat(this.identifier,".title")).toString();if(!e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".title")).toString().includes("devices.vendors."))return e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".properties.").concat(this.identifier,".title")).toString()}return D.default(this.identifier)}},{key:"device",get:function(){if(null===this.channel){var e=fe.query().where("id",this.channelId).first();return null!==e?Ee.query().where("id",e.deviceId).first():null}return Ee.query().where("id",this.channel.deviceId).first()}}],[{key:"entity",get:function(){return"channel_property"}},{key:"fields",value:function(){return Object.assign(ae.fields(),{type:this.string(e.ChannelPropertyEntityTypes.PROPERTY),channel:this.belongsTo(fe,"id"),channelBackward:this.hasOne(fe,"id","channelId"),channelId:this.string("")})}},{key:"get",value:(i=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("get",{channel:t,id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"fetch",value:(n=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("fetch",{channel:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"edit",value:(r=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("edit",{property:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"transmitData",value:function(e,t){return c.dispatch("transmitData",{property:e,value:t})}},{key:"reset",value:function(){c.dispatch("reset")}}]),c}(ae),le=function(e){B(a,e);var t,r,n,i=re(a);function a(){var e;V(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return z(ee(e=i.call.apply(i,[this].concat(r))),"type",void 0),z(ee(e),"channel",void 0),z(ee(e),"channelBackward",void 0),z(ee(e),"channelId",void 0),e}return q(a,[{key:"title",get:function(){if(null!==this.name)return this.name;var e=a.store();if(null!==this.device&&!this.device.isCustomModel&&Object.prototype.hasOwnProperty.call(e,"$i18n")){if(this.identifier.includes("_")){var t=this.identifier.substring(0,this.identifier.indexOf("_")).toLowerCase(),r=parseInt(this.identifier.substring(this.identifier.indexOf("_")+1),10);if(!e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".devices.").concat(this.device.hardwareModel,".configuration.").concat(t,".title")).toString().includes("devices.vendors."))return e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".devices.").concat(this.device.hardwareModel,".configuration.").concat(t,".title"),{number:r}).toString();if(!e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".configuration.").concat(t,".title")).toString().includes("devices.vendors."))return e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".configuration.").concat(t,".title"),{number:r}).toString()}if(!e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".devices.").concat(this.device.hardwareModel,".configuration.").concat(this.identifier,".title")).toString().includes("devices.vendors."))return e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".devices.").concat(this.device.hardwareModel,".configuration.").concat(this.identifier,".title")).toString();if(!e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".configuration.").concat(this.identifier,".title")).toString().includes("devices.vendors."))return e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".configuration.").concat(this.identifier,".title")).toString()}return D.default(this.identifier)}},{key:"description",get:function(){if(null!==this.comment)return this.comment;var e=a.store();if(null!==this.device&&!this.device.isCustomModel&&Object.prototype.hasOwnProperty.call(e,"$i18n")){if(!e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".devices.").concat(this.device.hardwareModel,".configuration.").concat(this.identifier,".description")).toString().includes("devices.vendors."))return e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".devices.").concat(this.device.hardwareModel,".configuration.").concat(this.identifier,".description")).toString();if(!e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".configuration.").concat(this.identifier,".description")).toString().includes("devices.vendors."))return e.$i18n.t("devices.vendors.".concat(this.device.hardwareManufacturer,".configuration.").concat(this.identifier,".description")).toString()}return null}},{key:"selectValues",get:function(){var e=this;if(!this.isSelect)throw new Error("This field is not allowed for entity type ".concat(this.type));var t=a.store();if(null!==this.device&&!this.device.isCustomModel&&Object.prototype.hasOwnProperty.call(t,"$i18n")){var r=[];return this.values.forEach((function(n){var i,a,c,o,s,u=n.name;if(t.$i18n.t("devices.vendors.".concat(null===(i=e.device)||void 0===i?void 0:i.hardwareManufacturer,".devices.").concat(null===(a=e.device)||void 0===a?void 0:a.hardwareModel,".configuration.").concat(e.identifier,".values.").concat(n.name)).toString().includes("devices.vendors.")){if(!t.$i18n.t("devices.vendors.".concat(null===(c=e.device)||void 0===c?void 0:c.hardwareManufacturer,".configuration.").concat(e.identifier,".values.").concat(n.name)).toString().includes("devices.vendors.")){var d;u=t.$i18n.t("devices.vendors.".concat(null===(d=e.device)||void 0===d?void 0:d.hardwareManufacturer,".configuration.").concat(e.identifier,".values.").concat(n.name)).toString()}}else u=t.$i18n.t("devices.vendors.".concat(null===(o=e.device)||void 0===o?void 0:o.hardwareManufacturer,".devices.").concat(null===(s=e.device)||void 0===s?void 0:s.hardwareModel,".configuration.").concat(e.identifier,".values.").concat(n.name)).toString();r.push({value:n.value,name:u})})),r}return this.values}},{key:"formattedValue",get:function(){var e=this;if(this.isSelect){var t=a.store();null!==this.device&&!this.device.isCustomModel&&Object.prototype.hasOwnProperty.call(t,"$i18n")&&this.values.forEach((function(r){var n,i,a,c,o,s;if(r.value==e.value)return t.$i18n.t("devices.vendors.".concat(null===(n=e.device)||void 0===n?void 0:n.hardwareManufacturer,".devices.").concat(null===(i=e.device)||void 0===i?void 0:i.hardwareModel,".configuration.").concat(e.identifier,".values.").concat(r.name)).toString().includes("devices.vendors.")?t.$i18n.t("devices.vendors.".concat(null===(a=e.device)||void 0===a?void 0:a.hardwareManufacturer,".configuration.").concat(e.identifier,".values.").concat(r.name)).toString().includes("devices.vendors.")?e.value:t.$i18n.t("devices.vendors.".concat(null===(c=e.device)||void 0===c?void 0:c.hardwareManufacturer,".configuration.").concat(e.identifier,".values.").concat(r.name)).toString():t.$i18n.t("devices.vendors.".concat(null===(o=e.device)||void 0===o?void 0:o.hardwareManufacturer,".devices.").concat(null===(s=e.device)||void 0===s?void 0:s.hardwareModel,".configuration.").concat(e.identifier,".values.").concat(r.name)).toString()}))}return this.value}},{key:"device",get:function(){if(null===this.channel){var e=fe.query().where("id",this.channelId).first();return null!==e?Ee.query().where("id",e.deviceId).first():null}return Ee.query().where("id",this.channel.deviceId).first()}}],[{key:"entity",get:function(){return"channel_configuration"}},{key:"fields",value:function(){return Object.assign(ue.fields(),{type:this.string(""),channel:this.belongsTo(fe,"id"),channelBackward:this.hasOne(fe,"id","channelId"),channelId:this.string("")})}},{key:"get",value:(n=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("get",{channel:t,id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetch",value:(r=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("fetch",{channel:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"edit",value:(t=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("edit",{property:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"transmitData",value:function(e,t){return a.dispatch("transmitData",{property:e,value:t})}},{key:"reset",value:function(){a.dispatch("reset")}}]),a}(ue),fe=function(t){B(c,t);var r,n,i,a=re(c);function c(){var e;V(this,c);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return z(ee(e=a.call.apply(a,[this].concat(r))),"id",void 0),z(ee(e),"type",void 0),z(ee(e),"key",void 0),z(ee(e),"identifier",void 0),z(ee(e),"name",void 0),z(ee(e),"comment",void 0),z(ee(e),"control",void 0),z(ee(e),"relationshipNames",void 0),z(ee(e),"properties",void 0),z(ee(e),"configuration",void 0),z(ee(e),"device",void 0),z(ee(e),"deviceBackward",void 0),z(ee(e),"deviceId",void 0),e}return q(c,[{key:"title",get:function(){if(null!==this.name)return this.name;var e=Ee.query().where("id",this.deviceId).first(),t=c.store();if(null!==e&&!e.isCustomModel&&Object.prototype.hasOwnProperty.call(t,"$i18n")){if(this.identifier.includes("_")){var r=this.identifier.substring(0,this.identifier.indexOf("_")),n=parseInt(this.identifier.substring(this.identifier.indexOf("_")+1),10);if(!t.$i18n.t("devices.vendors.".concat(e.hardwareManufacturer,".devices.").concat(e.hardwareModel,".channels.").concat(r,".title")).toString().includes("devices.vendors."))return t.$i18n.t("devices.vendors.".concat(e.hardwareManufacturer,".devices.").concat(e.hardwareModel,".channels.").concat(r,".title"),{number:n+1}).toString();if(!t.$i18n.t("devices.vendors.".concat(e.hardwareManufacturer,".channels.").concat(r,".title")).toString().includes("devices.vendors."))return t.$i18n.t("devices.vendors.".concat(e.hardwareManufacturer,".channels.").concat(r,".title"),{number:n+1}).toString()}if(!t.$i18n.t("devices.vendors.".concat(e.hardwareManufacturer,".devices.").concat(e.hardwareModel,".channels.").concat(this.identifier,".title")).toString().includes("devices.vendors."))return t.$i18n.t("devices.vendors.".concat(e.hardwareManufacturer,".devices.").concat(e.hardwareModel,".channels.").concat(this.identifier,".title")).toString();if(!t.$i18n.t("devices.vendors.".concat(e.hardwareManufacturer,".channels.").concat(this.identifier,".title")).toString().includes("devices.vendors."))return t.$i18n.t("devices.vendors.".concat(e.hardwareManufacturer,".channels.").concat(this.identifier,".title")).toString()}return D.default(this.identifier)}}],[{key:"entity",get:function(){return"channel"}},{key:"fields",value:function(){return{id:this.string(""),type:this.string(e.ChannelEntityTypes.CHANNEL),key:this.string(""),identifier:this.string(""),name:this.string(null).nullable(),comment:this.string(null).nullable(),control:this.attr([]),relationshipNames:this.attr([]),properties:this.hasMany(pe,"channelId"),configuration:this.hasMany(le,"channelId"),device:this.belongsTo(Ee,"id"),deviceBackward:this.hasOne(Ee,"id","deviceId"),deviceId:this.string("")}}},{key:"get",value:(i=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("get",{device:t,id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"fetch",value:(n=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("fetch",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"edit",value:(r=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.dispatch("edit",{channel:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"transmitCommand",value:function(e,t){return c.dispatch("transmitCommand",{channel:e,command:t})}},{key:"reset",value:function(){c.dispatch("reset")}}]),c}(r.Model);e.DeviceConnectorEntityTypes=void 0,(e.DeviceConnectorEntityTypes||(e.DeviceConnectorEntityTypes={})).CONNECTOR="devices-module/device-connector";var he=function(e){B(a,e);var t,r,n,i=re(a);function a(){var e;V(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return z(ee(e=i.call.apply(i,[this].concat(r))),"id",void 0),z(ee(e),"type",void 0),z(ee(e),"name",void 0),z(ee(e),"enabled",void 0),z(ee(e),"control",void 0),z(ee(e),"relationshipNames",void 0),z(ee(e),"devices",void 0),z(ee(e),"address",void 0),z(ee(e),"serialInterface",void 0),z(ee(e),"baudRate",void 0),z(ee(e),"server",void 0),z(ee(e),"port",void 0),z(ee(e),"securedPort",void 0),z(ee(e),"username",void 0),z(ee(e),"password",void 0),e}return q(a,[{key:"isEnabled",get:function(){return this.enabled}},{key:"icon",get:function(){return"magic"}}],[{key:"entity",get:function(){return"connector"}},{key:"fields",value:function(){return{id:this.string(""),type:this.string(""),name:this.string(""),enabled:this.boolean(!0),relationshipNames:this.attr([]),devices:this.hasMany(ve,"connectorId"),address:this.number(null).nullable(),serialInterface:this.string(null).nullable(),baudRate:this.number(null).nullable(),server:this.string(null).nullable(),port:this.number(null).nullable(),securedPort:this.number(null).nullable(),username:this.string(null).nullable(),password:this.string(null).nullable()}}},{key:"get",value:(n=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("get",{id:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"fetch",value:(r=$(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("fetch");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"edit",value:(t=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch("edit",{connector:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"transmitCommand",value:function(e,t){return a.dispatch("transmitCommand",{connector:e,command:t})}},{key:"reset",value:function(){a.dispatch("reset")}}]),a}(r.Model),ve=function(t){B(s,t);var r,n,i,a,c,o=re(s);function s(){var e;V(this,s);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return z(ee(e=o.call.apply(o,[this].concat(r))),"id",void 0),z(ee(e),"type",void 0),z(ee(e),"draft",void 0),z(ee(e),"address",void 0),z(ee(e),"maxPacketLength",void 0),z(ee(e),"descriptionSupport",void 0),z(ee(e),"settingsSupport",void 0),z(ee(e),"configuredKeyLength",void 0),z(ee(e),"pubSubPubSupport",void 0),z(ee(e),"pubSubSubSupport",void 0),z(ee(e),"pubSubSubMaxSubscriptions",void 0),z(ee(e),"pubSubSubMaxConditions",void 0),z(ee(e),"pubSubSubMaxActions",void 0),z(ee(e),"username",void 0),z(ee(e),"password",void 0),z(ee(e),"relationshipNames",void 0),z(ee(e),"device",void 0),z(ee(e),"deviceBackward",void 0),z(ee(e),"connector",void 0),z(ee(e),"connectorBackward",void 0),z(ee(e),"deviceId",void 0),z(ee(e),"connectorId",void 0),e}return q(s,null,[{key:"entity",get:function(){return"device_connector"}},{key:"fields",value:function(){return{id:this.string(""),type:this.string(e.DeviceConnectorEntityTypes.CONNECTOR),draft:this.boolean(!1),address:this.number(0),maxPacketLength:this.number(0),descriptionSupport:this.boolean(!1),settingsSupport:this.boolean(!1),configuredKeyLength:this.number(0),pubSubPubSupport:this.boolean(!1),pubSubSubSupport:this.boolean(!1),pubSubSubMaxSubscriptions:this.number(0),pubSubSubMaxConditions:this.number(0),pubSubSubMaxActions:this.number(0),username:this.string(""),password:this.string(""),relationshipNames:this.attr([]),device:this.belongsTo(Ee,"id"),deviceBackward:this.hasOne(Ee,"id","deviceId"),connector:this.belongsTo(he,"id"),connectorBackward:this.hasOne(he,"id","connectorId"),deviceId:this.string(""),connectorId:this.string("")}}},{key:"get",value:(c=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.dispatch("get",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"add",value:(a=$(regeneratorRuntime.mark((function e(t,r,n,i){var a,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(c.length>4&&void 0!==c[4])||c[4],e.next=3,s.dispatch("add",{id:i,draft:a,device:t,connector:r,data:n});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return a.apply(this,arguments)})},{key:"edit",value:(i=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.dispatch("edit",{connector:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"save",value:(n=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.dispatch("save",{connector:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"remove",value:(r=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.dispatch("remove",{connector:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"reset",value:function(){s.dispatch("reset")}}]),s}(r.Model),Ee=function(r){B(d,r);var n,i,a,c,o,s,u=re(d);function d(){var e;V(this,d);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return z(ee(e=u.call.apply(u,[this].concat(r))),"id",void 0),z(ee(e),"type",void 0),z(ee(e),"draft",void 0),z(ee(e),"parentId",void 0),z(ee(e),"key",void 0),z(ee(e),"identifier",void 0),z(ee(e),"name",void 0),z(ee(e),"comment",void 0),z(ee(e),"state",void 0),z(ee(e),"enabled",void 0),z(ee(e),"hardwareModel",void 0),z(ee(e),"hardwareManufacturer",void 0),z(ee(e),"hardwareVersion",void 0),z(ee(e),"macAddress",void 0),z(ee(e),"firmwareManufacturer",void 0),z(ee(e),"firmwareVersion",void 0),z(ee(e),"control",void 0),z(ee(e),"owner",void 0),z(ee(e),"relationshipNames",void 0),z(ee(e),"children",void 0),z(ee(e),"channels",void 0),z(ee(e),"properties",void 0),z(ee(e),"configuration",void 0),z(ee(e),"connector",void 0),e}return q(d,[{key:"isEnabled",get:function(){return this.enabled}},{key:"isReady",get:function(){return this.state===t.DeviceConnectionState.READY||this.state===t.DeviceConnectionState.RUNNING}},{key:"icon",get:function(){if(this.hardwareManufacturer===t.HardwareManufacturer.ITEAD)switch(this.hardwareModel){case t.DeviceModel.SONOFF_SC:return"thermometer-half";case t.DeviceModel.SONOFF_POW:case t.DeviceModel.SONOFF_POW_R2:return"calculator"}return"plug"}},{key:"title",get:function(){if(null!==this.name)return this.name;var e=d.store();if(Object.prototype.hasOwnProperty.call(e,"$i18n")){if(this.isCustomModel)return D.default(this.identifier);if(!e.$i18n.t("devices.vendors.".concat(this.hardwareManufacturer,".devices.").concat(this.hardwareModel,".title")).toString().includes("devices.vendors."))return e.$i18n.t("devices.vendors.".concat(this.hardwareManufacturer,".devices.").concat(this.hardwareModel,".title")).toString()}return D.default(this.identifier)}},{key:"hasComment",get:function(){return null!==this.comment&&""!==this.comment}},{key:"isCustomModel",get:function(){return this.hardwareModel===t.DeviceModel.CUSTOM}}],[{key:"entity",get:function(){return"device"}},{key:"fields",value:function(){return{id:this.string(""),type:this.string(e.DeviceEntityTypes.DEVICE),draft:this.boolean(!1),parentId:this.string(null).nullable(),key:this.string(""),identifier:this.string(""),name:this.string(null).nullable(),comment:this.string(null).nullable(),state:this.string(t.DeviceConnectionState.UNKNOWN),enabled:this.boolean(!1),hardwareModel:this.string(t.DeviceModel.CUSTOM),hardwareManufacturer:this.string(t.HardwareManufacturer.GENERIC),hardwareVersion:this.string(null).nullable(),macAddress:this.string(null).nullable(),firmwareManufacturer:this.string(t.FirmwareManufacturer.GENERIC),firmwareVersion:this.string(null).nullable(),control:this.attr([]),owner:this.string(null).nullable(),relationshipNames:this.attr([]),children:this.hasMany(d,"parentId"),channels:this.hasMany(fe,"deviceId"),properties:this.hasMany(se,"deviceId"),configuration:this.hasMany(de,"deviceId"),connector:this.hasOne(ve,"deviceId")}}},{key:"get",value:(s=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.dispatch("get",{id:t,includeChannels:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})},{key:"fetch",value:(o=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.dispatch("fetch",{includeChannels:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"add",value:(c=$(regeneratorRuntime.mark((function e(t,r){var n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(i.length>2&&void 0!==i[2])||i[2],e.next=3,d.dispatch("add",{id:r,draft:n,data:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return c.apply(this,arguments)})},{key:"edit",value:(a=$(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.dispatch("edit",{device:t,data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return a.apply(this,arguments)})},{key:"save",value:(i=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.dispatch("save",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"remove",value:(n=$(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.dispatch("remove",{device:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"transmitCommand",value:function(e,t){return d.dispatch("transmitCommand",{device:e,command:t})}},{key:"reset",value:function(){d.dispatch("reset")}}]),d}(r.Model),me=function(e){B(r,e);var t=re(r);function r(e,n){var i;V(this,r);for(var a=arguments.length,c=new Array(a>2?a-2:0),o=2;o<a;o++)c[o-2]=arguments[o];return z(ee(i=t.call.apply(t,[this].concat(c))),"type",void 0),z(ee(i),"exception",void 0),Error.captureStackTrace&&Error.captureStackTrace(ee(i),r),i.type=e,i.exception=n,i}return r}(X(Error)),ge=function(e){B(r,e);var t=re(r);function r(){return V(this,r),t.apply(this,arguments)}return r}(me),ye=function(e){B(r,e);var t=re(r);function r(){return V(this,r),t.apply(this,arguments)}return r}(me);e.ChannelConfigurationEntityTypes=void 0,(e.ChannelConfigurationEntityTypes||(e.ChannelConfigurationEntityTypes={})).CONFIGURATION="devices-module/channel-configuration";var Te,we,be=function(t){B(n,t);var r=re(n);function n(){return V(this,n),r.apply(this,arguments)}return q(n,[{key:"getAttributes",value:function(t){var r=["id","$id","type","draft","relationshipNames"];t.type===e.ChannelEntityTypes.CHANNEL||t.type===e.DevicePropertyEntityTypes.PROPERTY||t.type===e.DeviceConfigurationEntityTypes.CONFIGURATION||t.type===e.DeviceConnectorEntityTypes.CONNECTOR?(r.push("deviceId"),r.push("device"),r.push("device_backward")):t.type===e.ChannelPropertyEntityTypes.PROPERTY||t.type===e.ChannelConfigurationEntityTypes.CONFIGURATION?(r.push("channelId"),r.push("channel"),r.push("channel_backward")):t.type===e.DeviceConnectorEntityTypes.CONNECTOR&&(r.push("connectorId"),r.push("connector"),r.push("connector_backward")),Array.isArray(t.relationshipNames)&&r.push.apply(r,ne(t.relationshipNames));var n={};return Object.keys(t).forEach((function(e){if(!r.includes(e)){var i=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())})),a=t[e];"object"===F(a)&&null!==a&&(a={},Object.keys(t[e]).forEach((function(r){var n=r.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));Object.assign(a,z({},n,t[e][r]))}))),n[i]=a}})),n}},{key:"getRelationships",value:function(e){if(!Object.prototype.hasOwnProperty.call(e,"relationshipNames")||!Array.isArray(e.relationshipNames))return{};var t=e.relationshipNames,r={};if(t.forEach((function(t){var n=t.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));void 0!==e[t]&&(Array.isArray(e[t])?r[n]=e[t].map((function(e){return{id:e.id,type:e.type}})):"object"===F(e[t])&&null!==e[t]&&(r[n]={id:e[t].id,type:e[t].type}))})),Object.prototype.hasOwnProperty.call(e,"deviceId")){var n=Ee.find(e.deviceId);null!==n&&(r.device={id:n.id,type:n.type})}if(Object.prototype.hasOwnProperty.call(e,"channelId")){var i=fe.find(e.deviceId);null!==i&&(r.channel={id:i.id,type:i.type})}if(Object.prototype.hasOwnProperty.call(e,"connectorId")){var a=he.find(e.connectorId);null!==a&&(r.connector={id:a.id,type:a.type})}return r}}]),n}(a.ModelPropertiesMapper),Re=function(t){B(n,t);var r=re(n);function n(){var e;V(this,n);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return z(ee(e=r.call.apply(r,[this].concat(i))),"caseRegExp","_([a-z0-9])"),e}return q(n,[{key:"createModel",value:function(e){return{type:e}}},{key:"setId",value:function(e,t){Object.assign(e,{id:t})}},{key:"setAttributes",value:function(e,t){var r=new RegExp(this.caseRegExp,"g");Object.keys(t).forEach((function(n){var i=n.replace(r,(function(e){return e[1].toUpperCase()})),a=t[n];"object"===F(a)&&null!==a&&(a={},Object.keys(t[n]).forEach((function(e){var i=e.replace(r,(function(e){return e[1].toUpperCase()}));Object.assign(a,z({},i,t[n][e]))}))),"control"===n&&(a=Object.values(t[n])),Object.assign(e,z({},i,a))})),Object.assign(e,{draft:!1})}},{key:"setRelationships",value:function(t,r){var n=this;Object.keys(r).forEach((function(i){var a=new RegExp(n.caseRegExp,"g"),c=i.replace(a,(function(e){return e[1].toUpperCase()}));if("function"==typeof r[i])d.defineRelationGetter(t,i,r[i]);else{var o=x.default(r[i]);Array.isArray(o)?Object.assign(t,z({},c,o.map((function(e){var t=e;return t=n.transformDevice(t),t=n.transformChannel(t)})))):_.default(o,"type")===e.DeviceEntityTypes.DEVICE?Object.assign(t,{deviceId:_.default(o,"id")}):_.default(o,"type")===e.ChannelEntityTypes.CHANNEL?Object.assign(t,{channelId:_.default(o,"id")}):Object.assign(t,z({},c,o))}}));var i=Object.keys(r),a=t.relationshipNames;a&&a.length?Object.assign(t,z({},"relationshipNames",[].concat(ne(a),ne(i)).filter((function(e,t,r){return r.indexOf(e)===t})))):Object.assign(t,z({},"relationshipNames",i))}},{key:"transformDevice",value:function(e){return Object.prototype.hasOwnProperty.call(e,"device")&&(Object.assign(e,{deviceId:e.device.id}),Reflect.deleteProperty(e,"device")),e}},{key:"transformChannel",value:function(e){return Object.prototype.hasOwnProperty.call(e,"channel")&&(Object.assign(e,{channelId:e.channel.id}),Reflect.deleteProperty(e,"channel")),e}}]),n}(a.JsonPropertiesMapper),Ne="/".concat(t.ModulePrefix.MODULE_DEVICES_PREFIX);!function(e){e.FETCHING="fetching",e.GETTING="getting",e.CREATING="creating",e.UPDATING="updating",e.DELETING="deleting"}(Te||(Te={}));var Ie,Ae,De,Se,Oe,ke,_e,Ce,xe=new O.default({modelPropertiesMapper:new be,jsonPropertiesMapper:new Re}),Pe={dataTransformer:function(e){return xe.deserialize(e.data)}},Me=new k.default,Ge={semaphore:{fetching:{items:!1,item:[]},creating:[],updating:[],deleting:[]},firstLoad:!1},He={state:function(){return Ge},getters:{firstLoadFinished:function(e){return function(){return!!e.firstLoad}},getting:function(e){return function(t){return e.semaphore.fetching.item.includes(t)}},fetching:function(e){return function(){return!!e.semaphore.fetching.items}}},actions:{get:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.prev=4,r.next=7,Ee.api().get("".concat(Ne,"/v1/devices/").concat(t.id,"?include=properties,configuration,connector"),Pe);case 7:if(!t.includeChannels){r.next=12;break}if(null===(a=Ee.find(t.id))){r.next=12;break}return r.next=12,fe.fetch(a);case 12:return r.abrupt("return",!0);case 15:throw r.prev=15,r.t0=r.catch(4),new ge("devices-module.devices.fetch.failed",r.t0,"Fetching devices failed.");case 18:return r.prev=18,i("CLEAR_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.finish(18);case 21:case"end":return r.stop()}}),r,null,[[4,15,18,21]])})))()},fetch:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.FETCHING}),r.prev=4,r.next=7,Ee.api().get("".concat(Ne,"/v1/devices?include=properties,configuration,connector"),Pe);case 7:if(!t.includeChannels){r.next=15;break}return r.next=10,Ee.all();case 10:return a=r.sent,c=[],a.forEach((function(e){c.push(fe.fetch(e))})),r.next=15,Promise.all(c);case 15:return i("SET_FIRST_LOAD",!0),r.abrupt("return",!0);case 19:throw r.prev=19,r.t0=r.catch(4),new ge("devices-module.devices.fetch.failed",r.t0,"Fetching devices failed.");case 22:return r.prev=22,i("CLEAR_SEMAPHORE",{type:Te.FETCHING}),r.finish(22);case 25:case"end":return r.stop()}}),r,null,[[4,19,22,25]])})))()},add:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.commit,i=void 0!==t.id&&null!==t.id&&""!==t.id?t.id:o.v4().toString(),a=void 0!==t.draft&&t.draft,n("SET_SEMAPHORE",{type:Te.CREATING,id:i}),r.prev=4,r.next=7,Ee.insert({data:Object.assign({},t.data,{id:i,draft:a})});case 7:r.next=13;break;case 9:throw r.prev=9,r.t0=r.catch(4),n("CLEAR_SEMAPHORE",{type:Te.CREATING,id:i}),new ye("devices-module.devices.create.failed",r.t0,"Create new device failed.");case 13:if(null!==(c=Ee.find(i))){r.next=19;break}return r.next=17,Ee.delete(i);case 17:throw n("CLEAR_SEMAPHORE",{type:Te.CREATING,id:i}),new Error("devices-module.devices.create.failed");case 19:if(!a){r.next=24;break}return n("CLEAR_SEMAPHORE",{type:Te.CREATING,id:i}),r.abrupt("return",Ee.find(i));case 24:return r.prev=24,r.next=27,Ee.api().post("".concat(Ne,"/v1/devices?include=properties,configuration,connector"),xe.serialize({stuff:c}),Pe);case 27:return r.abrupt("return",Ee.find(i));case 30:return r.prev=30,r.t1=r.catch(24),r.next=34,Ee.delete(i);case 34:throw new ge("devices-module.devices.create.failed",r.t1,"Create new device failed.");case 35:return r.prev=35,n("CLEAR_SEMAPHORE",{type:Te.CREATING,id:i}),r.finish(35);case 38:case"end":return r.stop()}}),r,null,[[4,9],[24,30,35,38]])})))()},edit:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.device.id)){r.next=3;break}throw new Error("devices-module.devices.update.inProgress");case 3:if(Ee.query().where("id",t.device.id).exists()){r.next=5;break}throw new Error("devices-module.devices.update.failed");case 5:return i("SET_SEMAPHORE",{type:Te.UPDATING,id:t.device.id}),r.prev=6,r.next=9,Ee.update({where:t.device.id,data:t.data});case 9:r.next=14;break;case 11:throw r.prev=11,r.t0=r.catch(6),new ye("devices-module.devices.update.failed",r.t0,"Edit device failed.");case 14:if(null!==(a=Ee.find(t.device.id))){r.next=20;break}return r.next=18,Ee.get(t.device.id,!1);case 18:throw i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.device.id}),new Error("devices-module.devices.update.failed");case 20:if(!a.draft){r.next=25;break}return i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.device.id}),r.abrupt("return",Ee.find(t.device.id));case 25:return r.prev=25,r.next=28,Ee.api().patch("".concat(Ne,"/v1/devices/").concat(a.id,"?include=properties,configuration,connector"),xe.serialize({stuff:a}),Pe);case 28:return r.abrupt("return",Ee.find(t.device.id));case 31:return r.prev=31,r.t1=r.catch(25),r.next=35,Ee.get(t.device.id,!1);case 35:throw new ge("devices-module.devices.update.failed",r.t1,"Edit device failed.");case 36:return r.prev=36,i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.device.id}),r.finish(36);case 39:case"end":return r.stop()}}),r,null,[[6,11],[25,31,36,39]])})))()},save:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.device.id)){r.next=3;break}throw new Error("devices-module.devices.save.inProgress");case 3:if(Ee.query().where("id",t.device.id).where("draft",!0).exists()){r.next=5;break}throw new Error("devices-module.devices.save.failed");case 5:if(i("SET_SEMAPHORE",{type:Te.UPDATING,id:t.device.id}),null!==(a=Ee.find(t.device.id))){r.next=10;break}throw i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.device.id}),new Error("devices-module.devices.save.failed");case 10:return r.prev=10,r.next=13,Ee.api().post("".concat(Ne,"/v1/devices?include=properties,configuration,connector"),xe.serialize({stuff:a}),Pe);case 13:return r.abrupt("return",Ee.find(t.device.id));case 16:throw r.prev=16,r.t0=r.catch(10),new ge("devices-module.devices.save.failed",r.t0,"Save draft device failed.");case 19:return r.prev=19,i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.device.id}),r.finish(19);case 22:case"end":return r.stop()}}),r,null,[[10,16,19,22]])})))()},remove:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.deleting.includes(t.device.id)){r.next=3;break}throw new Error("devices-module.devices.delete.inProgress");case 3:if(Ee.query().where("id",t.device.id).exists()){r.next=5;break}return r.abrupt("return",!0);case 5:return i("SET_SEMAPHORE",{type:Te.DELETING,id:t.device.id}),r.prev=6,r.next=9,Ee.delete(t.device.id);case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:Te.DELETING,id:t.device.id}),new ye("devices-module.devices.delete.failed",r.t0,"Delete device failed.");case 15:if(!t.device.draft){r.next=20;break}return i("CLEAR_SEMAPHORE",{type:Te.DELETING,id:t.device.id}),r.abrupt("return",!0);case 20:return r.prev=20,r.next=23,Ee.api().delete("".concat(Ne,"/v1/devices/").concat(t.device.id),{save:!1});case 23:return r.abrupt("return",!0);case 26:return r.prev=26,r.t1=r.catch(20),r.next=30,Ee.get(t.device.id,!1);case 30:throw new ye("devices-module.devices.delete.failed",r.t1,"Delete device failed.");case 31:return r.prev=31,i("CLEAR_SEMAPHORE",{type:Te.DELETING,id:t.device.id}),r.finish(31);case 34:case"end":return r.stop()}}),r,null,[[6,11],[20,26,31,34]])})))()},transmitCommand:function(e,r){if(!Ee.query().where("id",r.device.id).exists())throw new Error("devices-module.device.transmit.failed");return new Promise((function(e,n){Ee.wamp().call({routing_key:t.DevicesModule.DEVICES_CONTROLS,origin:Ee.$devicesModuleOrigin,data:{control:r.command,device:r.device.key}}).then((function(t){"accepted"===_.default(t.data,"response")?e(!0):n(new Error("devices-module.device.transmit.failed"))})).catch((function(){n(new Error("devices-module.device.transmit.failed"))}))}))},socketData:function(e,r){return $(regeneratorRuntime.mark((function n(){var i,a,c,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.state,a=e.commit,r.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){n.next=3;break}return n.abrupt("return",!1);case 3:if([t.DevicesModule.DEVICES_CREATED_ENTITY,t.DevicesModule.DEVICES_UPDATED_ENTITY,t.DevicesModule.DEVICES_DELETED_ENTITY].includes(r.routingKey)){n.next=5;break}return n.abrupt("return",!1);case 5:if(c=JSON.parse(r.data),!Me.compile(S)(c)){n.next=46;break}if(Ee.query().where("id",c.id).exists()||r.routingKey!==t.DevicesModule.DEVICES_UPDATED_ENTITY&&r.routingKey!==t.DevicesModule.DEVICES_DELETED_ENTITY){n.next=10;break}throw new Error("devices-module.devices.update.failed");case 10:if(r.routingKey!==t.DevicesModule.DEVICES_DELETED_ENTITY){n.next=25;break}return a("SET_SEMAPHORE",{type:Te.DELETING,id:c.id}),n.prev=12,n.next=15,Ee.delete(c.id);case 15:n.next=20;break;case 17:throw n.prev=17,n.t0=n.catch(12),new ye("devices-module.devices.delete.failed",n.t0,"Delete device failed.");case 20:return n.prev=20,a("CLEAR_SEMAPHORE",{type:Te.DELETING,id:c.id}),n.finish(20);case 23:n.next=43;break;case 25:if(r.routingKey!==t.DevicesModule.DEVICES_UPDATED_ENTITY||!i.semaphore.updating.includes(c.id)){n.next=27;break}return n.abrupt("return",!0);case 27:return a("SET_SEMAPHORE",{type:r.routingKey===t.DevicesModule.DEVICES_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:c.id}),o={},Object.keys(c).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));o[t]=c[e]})),n.prev=30,n.next=33,Ee.insertOrUpdate({data:o});case 33:n.next=40;break;case 35:return n.prev=35,n.t1=n.catch(30),n.next=39,Ee.get(c.id,!1);case 39:throw new ye("devices-module.devices.update.failed",n.t1,"Edit device failed.");case 40:return n.prev=40,a("CLEAR_SEMAPHORE",{type:r.routingKey===t.DevicesModule.DEVICES_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:c.id}),n.finish(40);case 43:return n.abrupt("return",!0);case 46:return n.abrupt("return",!1);case 47:case"end":return n.stop()}}),n,null,[[12,17,20,23],[30,35,40,43]])})))()},reset:function(e){(0,e.commit)("RESET_STATE"),fe.reset()}},mutations:(z(we={},"SET_FIRST_LOAD",(function(e,t){e.firstLoad=t})),z(we,"SET_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items=!0;break;case Te.GETTING:e.semaphore.fetching.item.push(_.default(t,"id","notValid")),e.semaphore.fetching.item=C.default(e.semaphore.fetching.item);break;case Te.CREATING:e.semaphore.creating.push(_.default(t,"id","notValid")),e.semaphore.creating=C.default(e.semaphore.creating);break;case Te.UPDATING:e.semaphore.updating.push(_.default(t,"id","notValid")),e.semaphore.updating=C.default(e.semaphore.updating);break;case Te.DELETING:e.semaphore.deleting.push(_.default(t,"id","notValid")),e.semaphore.deleting=C.default(e.semaphore.deleting)}})),z(we,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items=!1;break;case Te.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===_.default(t,"id","notValid")&&e.semaphore.fetching.item.splice(n,1)}));break;case Te.CREATING:e.semaphore.creating.forEach((function(r,n){r===_.default(t,"id","notValid")&&e.semaphore.creating.splice(n,1)}));break;case Te.UPDATING:e.semaphore.updating.forEach((function(r,n){r===_.default(t,"id","notValid")&&e.semaphore.updating.splice(n,1)}));break;case Te.DELETING:e.semaphore.deleting.forEach((function(r,n){r===_.default(t,"id","notValid")&&e.semaphore.deleting.splice(n,1)}))}})),z(we,"RESET_STATE",(function(e){Object.assign(e,Ge)})),we)},Le=new O.default({modelPropertiesMapper:new be,jsonPropertiesMapper:new Re}),Ue={dataTransformer:function(e){return Le.deserialize(e.data)}},Ye=new k.default,Fe={semaphore:{fetching:{items:[],item:[]},creating:[],updating:[],deleting:[]}},je={state:function(){return Fe},actions:{get:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.prev=4,r.next=7,se.api().get("".concat(Ne,"/v1/devices/").concat(t.device.id,"/properties/").concat(t.id),Ue);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new ge("devices-module.device-properties.fetch.failed",r.t0,"Fetching device property failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items.includes(t.device.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.FETCHING,id:t.device.id}),r.prev=4,r.next=7,se.api().get("".concat(Ne,"/v1/devices/").concat(t.device.id,"/properties"),Ue);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new ge("devices-module.device-properties.fetch.failed",r.t0,"Fetching device properties failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:Te.FETCHING,id:t.device.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},edit:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.property.id)){r.next=3;break}throw new Error("devices-module.device-properties.update.inProgress");case 3:if(se.query().where("id",t.property.id).exists()){r.next=5;break}throw new Error("devices-module.device-properties.update.failed");case 5:return i("SET_SEMAPHORE",{type:Te.UPDATING,id:t.property.id}),r.prev=6,r.next=9,se.update({where:t.property.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.property.id}),new ye("devices-module.device-properties.update.failed",r.t0,"Edit device property failed.");case 15:if(null!==(a=se.find(t.property.id))){r.next=23;break}if(null===(c=Ee.find(t.property.deviceId))){r.next=21;break}return r.next=21,se.get(c,t.property.id);case 21:throw i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.property.id}),new Error("devices-module.device-properties.update.failed");case 23:return r.prev=23,r.next=26,se.api().patch("".concat(Ne,"/v1/devices/").concat(a.deviceId,"/properties/").concat(a.id),Le.serialize({stuff:a}),Ue);case 26:return r.abrupt("return",se.find(t.property.id));case 29:if(r.prev=29,r.t1=r.catch(23),null===(o=Ee.find(t.property.deviceId))){r.next=35;break}return r.next=35,se.get(o,t.property.id);case 35:throw new ge("devices-module.device-properties.update.failed",r.t1,"Edit device property failed.");case 36:return r.prev=36,i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.property.id}),r.finish(36);case 39:case"end":return r.stop()}}),r,null,[[6,11],[23,29,36,39]])})))()},transmitData:function(e,r){return $(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se.query().where("id",r.property.id).exists()){e.next=2;break}throw new Error("devices-module.device-properties.transmit.failed");case 2:if(null!==(n=Ee.find(r.property.deviceId))){e.next=5;break}throw new Error("devices-module.device-properties.transmit.failed");case 5:return i=r.property.value,e.prev=6,e.next=9,se.update({where:r.property.id,data:{value:r.value}});case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(6),new ye("devices-module.device-properties.transmit.failed",e.t0,"Edit device property failed.");case 14:return e.abrupt("return",new Promise((function(e,a){se.wamp().call({routing_key:t.DevicesModule.DEVICES_PROPERTIES_DATA,origin:se.$devicesModuleOrigin,data:{device:n.key,property:r.property.key,expected:r.value}}).then((function(t){"accepted"===_.default(t.data,"response")?e(!0):(se.update({where:r.property.id,data:{value:i}}),a(new Error("devices-module.device-properties.transmit.failed")))})).catch((function(){se.update({where:r.property.id,data:{value:i}}),a(new Error("devices-module.device-properties.transmit.failed"))}))})));case 15:case"end":return e.stop()}}),e,null,[[6,11]])})))()},socketData:function(r,n){return $(regeneratorRuntime.mark((function i(){var a,c,o,s,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=r.state,c=r.commit,n.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){i.next=3;break}return i.abrupt("return",!1);case 3:if([t.DevicesModule.DEVICES_PROPERTY_CREATED_ENTITY,t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY,t.DevicesModule.DEVICES_PROPERTY_DELETED_ENTITY].includes(n.routingKey)){i.next=5;break}return i.abrupt("return",!1);case 5:if(o=JSON.parse(n.data),!Ye.compile(P)(o)){i.next=48;break}if(se.query().where("id",o.id).exists()||n.routingKey!==t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY&&n.routingKey!==t.DevicesModule.DEVICES_PROPERTY_DELETED_ENTITY){i.next=10;break}throw new Error("devices-module.device-properties.update.failed");case 10:if(n.routingKey!==t.DevicesModule.DEVICES_PROPERTY_DELETED_ENTITY){i.next=25;break}return c("SET_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.prev=12,i.next=15,se.delete(o.id);case 15:i.next=20;break;case 17:throw i.prev=17,i.t0=i.catch(12),new ye("devices-module.device-properties.delete.failed",i.t0,"Delete device property failed.");case 20:return i.prev=20,c("CLEAR_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.finish(20);case 23:i.next=45;break;case 25:if(n.routingKey!==t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY||!a.semaphore.updating.includes(o.id)){i.next=27;break}return i.abrupt("return",!0);case 27:return c("SET_SEMAPHORE",{type:n.routingKey===t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),s={type:e.DevicePropertyEntityTypes.PROPERTY},Object.keys(o).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("device"===t){var r=Ee.query().where("identifier",o[e]).first();null!==r&&(s.deviceId=r.id)}else s[t]=o[e]})),i.prev=30,i.next=33,se.insertOrUpdate({data:s});case 33:i.next=42;break;case 35:if(i.prev=35,i.t1=i.catch(30),null===(u=se.query().with("device").where("id",o.id).first())||null===u.device){i.next=41;break}return i.next=41,se.get(u.device,o.id);case 41:throw new ye("devices-module.device-properties.update.failed",i.t1,"Edit device property failed.");case 42:return i.prev=42,c("CLEAR_SEMAPHORE",{type:n.routingKey===t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),i.finish(42);case 45:return i.abrupt("return",!0);case 48:return i.abrupt("return",!1);case 49:case"end":return i.stop()}}),i,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(z(Ie={},"SET_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items.push(t.id),e.semaphore.fetching.items=C.default(e.semaphore.fetching.items);break;case Te.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=C.default(e.semaphore.fetching.item);break;case Te.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=C.default(e.semaphore.creating);break;case Te.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=C.default(e.semaphore.updating);break;case Te.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=C.default(e.semaphore.deleting)}})),z(Ie,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items.forEach((function(r,n){r===t.id&&e.semaphore.fetching.items.splice(n,1)}));break;case Te.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case Te.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case Te.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case Te.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),z(Ie,"RESET_STATE",(function(e){Object.assign(e,Fe)})),Ie)},$e=new O.default({modelPropertiesMapper:new be,jsonPropertiesMapper:new Re}),Ve={dataTransformer:function(e){return $e.deserialize(e.data)}},Ke=new k.default,qe={semaphore:{fetching:{items:[],item:[]},creating:[],updating:[],deleting:[]}},ze={state:function(){return qe},actions:{get:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.prev=4,r.next=7,de.api().get("".concat(Ne,"/v1/devices/").concat(t.device.id,"/configuration/").concat(t.id),Ve);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new ge("devices-module.device-configuration.fetch.failed",r.t0,"Fetching device configuration failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items.includes(t.device.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.FETCHING,id:t.device.id}),r.prev=4,r.next=7,de.api().get("".concat(Ne,"/v1/devices/").concat(t.device.id,"/configuration"),Ve);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new ge("devices-module.device-configuration.fetch.failed",r.t0,"Fetching device configuration failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:Te.FETCHING,id:t.device.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},edit:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.configuration.id)){r.next=3;break}throw new Error("devices-module.device-configuration.update.inProgress");case 3:if(de.query().where("id",t.configuration.id).exists()){r.next=5;break}throw new Error("devices-module.device-configuration.update.failed");case 5:return i("SET_SEMAPHORE",{type:Te.UPDATING,id:t.configuration.id}),r.prev=6,r.next=9,de.update({where:t.configuration.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.configuration.id}),new ye("devices-module.device-configuration.update.failed",r.t0,"Edit device configuration failed.");case 15:if(null!==(a=de.find(t.configuration.id))){r.next=23;break}if(null===(c=Ee.find(t.configuration.deviceId))){r.next=21;break}return r.next=21,de.get(c,t.configuration.id);case 21:throw i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.configuration.id}),new Error("devices-module.device-configuration.update.failed");case 23:if(null!==(o=Ee.find(t.configuration.deviceId))){r.next=26;break}throw new Error("devices-module.device-configuration.update.failed");case 26:return r.prev=26,r.next=29,de.api().patch("".concat(Ne,"/v1/devices/").concat(o.id,"/configuration/").concat(a.id),$e.serialize({stuff:a}),Ve);case 29:return r.abrupt("return",de.find(t.configuration.id));case 32:return r.prev=32,r.t1=r.catch(26),r.next=36,de.get(o,t.configuration.id);case 36:throw new ge("devices-module.device-configuration.update.failed",r.t1,"Edit device configuration failed.");case 37:return r.prev=37,i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.configuration.id}),r.finish(37);case 40:case"end":return r.stop()}}),r,null,[[6,11],[26,32,37,40]])})))()},transmitData:function(e,r){return $(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(de.query().where("id",r.configuration.id).exists()){e.next=2;break}throw new Error("devices-module.device-configuration.transmit.failed");case 2:if(null!==(n=Ee.find(r.configuration.deviceId))){e.next=5;break}throw new Error("devices-module.device-configuration.transmit.failed");case 5:return i=r.configuration.value,e.prev=6,e.next=9,de.update({where:r.configuration.id,data:{value:r.value}});case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(6),new ye("devices-module.device-configuration.transmit.failed",e.t0,"Edit device configuration failed.");case 14:return e.abrupt("return",new Promise((function(e,a){de.wamp().call({routing_key:t.DevicesModule.DEVICES_CONFIGURATION_DATA,origin:de.$devicesModuleOrigin,data:{device:n.key,configuration:r.configuration.key,expected:r.value}}).then((function(t){"accepted"===_.default(t.data,"response")?e(!0):(de.update({where:r.configuration.id,data:{value:i}}),a(new Error("devices-module.device-configuration.transmit.failed")))})).catch((function(){de.update({where:r.configuration.id,data:{value:i}}),a(new Error("devices-module.device-configuration.transmit.failed"))}))})));case 15:case"end":return e.stop()}}),e,null,[[6,11]])})))()},socketData:function(r,n){return $(regeneratorRuntime.mark((function i(){var a,c,o,s,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=r.state,c=r.commit,n.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){i.next=3;break}return i.abrupt("return",!1);case 3:if([t.DevicesModule.DEVICES_CONFIGURATION_CREATED_ENTITY,t.DevicesModule.DEVICES_CONFIGURATION_UPDATED_ENTITY,t.DevicesModule.DEVICES_CONFIGURATION_DELETED_ENTITY].includes(n.routingKey)){i.next=5;break}return i.abrupt("return",!1);case 5:if(o=JSON.parse(n.data),!Ke.compile(M)(o)){i.next=48;break}if(de.query().where("id",o.id).exists()||n.routingKey!==t.DevicesModule.DEVICES_CONFIGURATION_UPDATED_ENTITY&&n.routingKey!==t.DevicesModule.DEVICES_CONFIGURATION_DELETED_ENTITY){i.next=10;break}throw new Error("devices-module.device-configuration.update.failed");case 10:if(n.routingKey!==t.DevicesModule.DEVICES_CONFIGURATION_DELETED_ENTITY){i.next=25;break}return c("SET_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.prev=12,i.next=15,de.delete(o.id);case 15:i.next=20;break;case 17:throw i.prev=17,i.t0=i.catch(12),new ye("devices-module.device-configuration.delete.failed",i.t0,"Delete device configuration failed.");case 20:return i.prev=20,c("CLEAR_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.finish(20);case 23:i.next=45;break;case 25:if(n.routingKey!==t.DevicesModule.DEVICES_CONFIGURATION_UPDATED_ENTITY||!a.semaphore.updating.includes(o.id)){i.next=27;break}return i.abrupt("return",!0);case 27:return c("SET_SEMAPHORE",{type:n.routingKey===t.DevicesModule.DEVICES_CONFIGURATION_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),s={type:e.DeviceConfigurationEntityTypes.CONFIGURATION},Object.keys(o).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("device"===t){var r=Ee.query().where("device",o[e]).first();null!==r&&(s.deviceId=r.id)}else s[t]=o[e]})),i.prev=30,i.next=33,de.insertOrUpdate({data:s});case 33:i.next=42;break;case 35:if(i.prev=35,i.t1=i.catch(30),null===(u=de.query().with("device").where("id",o.id).first())||null===u.device){i.next=41;break}return i.next=41,de.get(u.device,o.id);case 41:throw new ye("devices-module.device-configuration.update.failed",i.t1,"Edit device configuration failed.");case 42:return i.prev=42,c("CLEAR_SEMAPHORE",{type:n.routingKey===t.DevicesModule.DEVICES_CONFIGURATION_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),i.finish(42);case 45:return i.abrupt("return",!0);case 48:return i.abrupt("return",!1);case 49:case"end":return i.stop()}}),i,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(z(Ae={},"SET_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items.push(t.id),e.semaphore.fetching.items=C.default(e.semaphore.fetching.items);break;case Te.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=C.default(e.semaphore.fetching.item);break;case Te.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=C.default(e.semaphore.creating);break;case Te.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=C.default(e.semaphore.updating);break;case Te.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=C.default(e.semaphore.deleting)}})),z(Ae,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items.forEach((function(r,n){r===t.id&&e.semaphore.fetching.items.splice(n,1)}));break;case Te.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case Te.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case Te.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case Te.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),z(Ae,"RESET_STATE",(function(e){Object.assign(e,qe)})),Ae)},Be=new O.default({modelPropertiesMapper:new be,jsonPropertiesMapper:new Re}),Ze={dataTransformer:function(e){return Be.deserialize(e.data)}},Je=new k.default,We={semaphore:{fetching:{item:[]},creating:[],updating:[],deleting:[]}},Qe={state:function(){return We},actions:{get:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.device.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.GETTING,id:t.device.id}),r.prev=4,r.next=7,ve.api().get("".concat(Ne,"/v1/devices/").concat(t.device.id,"/connector"),Ze);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new ge("devices-module.device-connector.get.failed",r.t0,"Fetching device connector failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:Te.GETTING,id:t.device.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},add:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.commit,i=void 0!==t.id&&null!==t.id&&""!==t.id?t.id:o.v4().toString(),a=void 0!==t.draft&&t.draft,n("SET_SEMAPHORE",{type:Te.CREATING,id:i}),r.prev=4,r.next=7,ve.insert({data:Object.assign({},t.data,{id:i,draft:a,deviceId:t.device.id,connectorId:t.connector.id})});case 7:r.next=13;break;case 9:throw r.prev=9,r.t0=r.catch(4),n("CLEAR_SEMAPHORE",{type:Te.CREATING,id:i}),new ye("devices-module.device-connector.create.failed",r.t0,"Create device connector failed.");case 13:if(null!==(c=ve.find(i))){r.next=19;break}return r.next=17,ve.delete(i);case 17:throw n("CLEAR_SEMAPHORE",{type:Te.CREATING,id:i}),new Error("devices-module.device-connector.create.failed");case 19:if(!a){r.next=24;break}return n("CLEAR_SEMAPHORE",{type:Te.CREATING,id:i}),r.abrupt("return",ve.find(i));case 24:return r.prev=24,r.next=27,ve.api().post("".concat(Ne,"/v1/devices/").concat(t.device.id,"/connector"),Be.serialize({stuff:c}),Ze);case 27:return r.abrupt("return",ve.find(i));case 30:return r.prev=30,r.t1=r.catch(24),r.next=34,ve.delete(i);case 34:throw new ge("devices-module.device-connector.create.failed",r.t1,"Create device connector failed.");case 35:return r.prev=35,n("CLEAR_SEMAPHORE",{type:Te.CREATING,id:i}),r.finish(35);case 38:case"end":return r.stop()}}),r,null,[[4,9],[24,30,35,38]])})))()},edit:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.connector.id)){r.next=3;break}throw new Error("devices-module.device-connector.update.inProgress");case 3:if(ve.query().where("id",t.connector.id).exists()){r.next=5;break}throw new Error("devices-module.device-connector.update.failed");case 5:return i("SET_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),r.prev=6,r.next=9,ve.update({where:t.connector.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),new ye("devices-module.device-connector.update.failed",r.t0,"Edit device connector failed.");case 15:if(null!==(a=ve.find(t.connector.id))){r.next=23;break}if(null===(c=Ee.find(t.connector.deviceId))){r.next=21;break}return r.next=21,ve.get(c);case 21:throw i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),new Error("devices-module.device-connector.update.failed");case 23:if(!a.draft){r.next=28;break}return i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),r.abrupt("return",ve.find(t.connector.id));case 28:return r.prev=28,r.next=31,ve.api().patch("".concat(Ne,"/v1/devices/").concat(a.deviceId,"/connector"),Be.serialize({stuff:a}),Ze);case 31:return r.abrupt("return",ve.find(t.connector.id));case 34:if(r.prev=34,r.t1=r.catch(28),null===(o=Ee.find(t.connector.deviceId))){r.next=40;break}return r.next=40,ve.get(o);case 40:throw new ge("devices-module.device-connector.update.failed",r.t1,"Edit device connector failed.");case 41:return r.prev=41,i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),r.finish(41);case 44:case"end":return r.stop()}}),r,null,[[6,11],[28,34,41,44]])})))()},save:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.connector.id)){r.next=3;break}throw new Error("devices-module.device-connector.save.inProgress");case 3:if(ve.query().where("id",t.connector.id).where("draft",!0).exists()){r.next=5;break}throw new Error("devices-module.device-connector.save.failed");case 5:if(i("SET_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),null!==(a=ve.find(t.connector.id))){r.next=10;break}throw i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),new Error("devices-module.device-connector.save.failed");case 10:return r.prev=10,r.next=13,ve.api().post("".concat(Ne,"/v1/devices/").concat(a.deviceId,"/connector"),Be.serialize({stuff:a}),Ze);case 13:return r.abrupt("return",ve.find(t.connector.id));case 16:throw r.prev=16,r.t0=r.catch(10),new ge("devices-module.device-connector.save.failed",r.t0,"Save draft device connector failed.");case 19:return r.prev=19,i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),r.finish(19);case 22:case"end":return r.stop()}}),r,null,[[10,16,19,22]])})))()},socketData:function(r,n){return $(regeneratorRuntime.mark((function i(){var a,c,o,s,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=r.state,c=r.commit,n.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){i.next=3;break}return i.abrupt("return",!1);case 3:if([t.DevicesModule.DEVICES_CONNECTOR_CREATED_ENTITY,t.DevicesModule.DEVICES_CONNECTOR_UPDATED_ENTITY,t.DevicesModule.DEVICES_CONNECTOR_DELETED_ENTITY].includes(n.routingKey)){i.next=5;break}return i.abrupt("return",!1);case 5:if(o=JSON.parse(n.data),!Je.compile(G)(o)){i.next=48;break}if(ve.query().where("id",o.id).exists()||n.routingKey!==t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY&&n.routingKey!==t.DevicesModule.DEVICES_PROPERTY_DELETED_ENTITY){i.next=10;break}throw new Error("devices-module.device-connector.update.failed");case 10:if(n.routingKey!==t.DevicesModule.DEVICES_PROPERTY_DELETED_ENTITY){i.next=25;break}return c("SET_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.prev=12,i.next=15,ve.delete(o.id);case 15:i.next=20;break;case 17:throw i.prev=17,i.t0=i.catch(12),new ye("devices-module.device-connector.delete.failed",i.t0,"Delete device connector failed.");case 20:return i.prev=20,c("CLEAR_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.finish(20);case 23:i.next=45;break;case 25:if(n.routingKey!==t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY||!a.semaphore.updating.includes(o.id)){i.next=27;break}return i.abrupt("return",!0);case 27:return c("SET_SEMAPHORE",{type:n.routingKey===t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),s={type:e.DeviceConnectorEntityTypes.CONNECTOR},Object.keys(o).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("device"===t){var r=Ee.query().where("identifier",o[e]).first();null!==r&&(s.deviceId=r.id)}else s[t]=o[e]})),i.prev=30,i.next=33,ve.insertOrUpdate({data:s});case 33:i.next=42;break;case 35:if(i.prev=35,i.t1=i.catch(30),null===(u=ve.query().with("device").where("id",o.id).first())||null===u.device){i.next=41;break}return i.next=41,ve.get(u.device);case 41:throw new ye("devices-module.device-connector.update.failed",i.t1,"Edit device connector failed.");case 42:return i.prev=42,c("CLEAR_SEMAPHORE",{type:n.routingKey===t.DevicesModule.DEVICES_PROPERTY_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),i.finish(42);case 45:return i.abrupt("return",!0);case 48:return i.abrupt("return",!1);case 49:case"end":return i.stop()}}),i,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(z(De={},"SET_SEMAPHORE",(function(e,t){switch(t.type){case Te.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=C.default(e.semaphore.fetching.item);break;case Te.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=C.default(e.semaphore.creating);break;case Te.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=C.default(e.semaphore.updating);break;case Te.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=C.default(e.semaphore.deleting)}})),z(De,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case Te.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case Te.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case Te.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case Te.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),z(De,"RESET_STATE",(function(e){Object.assign(e,We)})),De)},Xe=new O.default({modelPropertiesMapper:new be,jsonPropertiesMapper:new Re}),et={dataTransformer:function(e){return Xe.deserialize(e.data)}},tt=new k.default,rt={semaphore:{fetching:{items:[],item:[]},creating:[],updating:[],deleting:[]},firstLoad:[]},nt={state:function(){return rt},getters:{firstLoadFinished:function(e){return function(t){return e.firstLoad.includes(t)}},getting:function(e){return function(t){return e.semaphore.fetching.item.includes(t)}},fetching:function(e){return function(t){return null!==t?e.semaphore.fetching.items.includes(t):e.semaphore.fetching.items.length>0}}},actions:{get:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.prev=4,r.next=7,fe.api().get("".concat(Ne,"/v1/devices/").concat(t.device.id,"/channels/").concat(t.id,"?include=properties,configuration"),et);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new ge("devices-module.channels.get.failed",r.t0,"Fetching channel failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items.includes(t.device.id)&&!t.device.draft){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.FETCHING,id:t.device.id}),r.prev=4,r.next=7,fe.api().get("".concat(Ne,"/v1/devices/").concat(t.device.id,"/channels?include=properties,configuration"),et);case 7:return i("SET_FIRST_LOAD",{id:t.device.id}),r.abrupt("return",!0);case 11:throw r.prev=11,r.t0=r.catch(4),new ge("devices-module.channels.fetch.failed",r.t0,"Fetching channels failed.");case 14:return r.prev=14,i("CLEAR_SEMAPHORE",{type:Te.FETCHING,id:t.device.id}),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[4,11,14,17]])})))()},edit:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.channel.id)){r.next=3;break}throw new Error("devices-module.channels.update.inProgress");case 3:if(fe.query().where("id",t.channel.id).exists()){r.next=5;break}throw new Error("devices-module.channels.update.failed");case 5:return i("SET_SEMAPHORE",{type:Te.UPDATING,id:t.channel.id}),r.prev=6,r.next=9,fe.update({where:t.channel.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.channel.id}),new ye("devices-module.channels.edit.failed",r.t0,"Edit channel failed.");case 15:if(null!==(a=fe.find(t.channel.id))){r.next=23;break}if(null===(c=Ee.find(t.channel.deviceId))){r.next=21;break}return r.next=21,fe.get(c,t.channel.id);case 21:throw i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.channel.id}),new Error("devices-module.channels.update.failed");case 23:return r.prev=23,r.next=26,fe.api().patch("".concat(Ne,"/v1/devices/").concat(a.deviceId,"/channels/").concat(a.id,"?include=properties,configuration"),Xe.serialize({stuff:a}),et);case 26:return r.abrupt("return",fe.find(t.channel.id));case 29:if(r.prev=29,r.t1=r.catch(23),null===(o=Ee.find(t.channel.deviceId))){r.next=35;break}return r.next=35,fe.get(o,t.channel.id);case 35:throw new ge("devices-module.channels.update.failed",r.t1,"Edit channel failed.");case 36:return r.prev=36,i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.channel.id}),r.finish(36);case 39:case"end":return r.stop()}}),r,null,[[6,11],[23,29,36,39]])})))()},transmitCommand:function(e,r){if(!fe.query().where("id",r.channel.id).exists())throw new Error("devices-module.channel.transmit.failed");var n=Ee.find(r.channel.deviceId);if(null===n)throw new Error("devices-module.channel.transmit.failed");return new Promise((function(e,i){fe.wamp().call({routing_key:t.DevicesModule.CHANNELS_CONTROLS,origin:fe.$devicesModuleOrigin,data:{control:r.command,device:n.key,channel:r.channel.key}}).then((function(t){"accepted"===_.default(t.data,"response")?e(!0):i(new Error("devices-module.channel.transmit.failed"))})).catch((function(){i(new Error("devices-module.channel.transmit.failed"))}))}))},socketData:function(r,n){return $(regeneratorRuntime.mark((function i(){var a,c,o,s,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=r.state,c=r.commit,n.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){i.next=3;break}return i.abrupt("return",!1);case 3:if([t.DevicesModule.CHANNELS_CREATED_ENTITY,t.DevicesModule.CHANNELS_UPDATED_ENTITY,t.DevicesModule.CHANNELS_DELETED_ENTITY].includes(n.routingKey)){i.next=5;break}return i.abrupt("return",!1);case 5:if(o=JSON.parse(n.data),!tt.compile(H)(o)){i.next=48;break}if(fe.query().where("id",o.id).exists()||n.routingKey!==t.DevicesModule.CHANNELS_UPDATED_ENTITY&&n.routingKey!==t.DevicesModule.CHANNELS_DELETED_ENTITY){i.next=10;break}throw new Error("devices-module.channels.update.failed");case 10:if(n.routingKey!==t.DevicesModule.CHANNELS_DELETED_ENTITY){i.next=25;break}return c("SET_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.prev=12,i.next=15,fe.delete(o.id);case 15:i.next=20;break;case 17:throw i.prev=17,i.t0=i.catch(12),new ye("devices-module.channels.delete.failed",i.t0,"Delete channel failed.");case 20:return i.prev=20,c("CLEAR_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.finish(20);case 23:i.next=45;break;case 25:if(n.routingKey!==t.DevicesModule.CHANNELS_UPDATED_ENTITY||!a.semaphore.updating.includes(o.id)){i.next=27;break}return i.abrupt("return",!0);case 27:return c("SET_SEMAPHORE",{type:n.routingKey===t.DevicesModule.CHANNELS_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),s={type:e.ChannelEntityTypes.CHANNEL},Object.keys(o).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("device"===t){var r=Ee.query().where("identifier",o[e]).first();null!==r&&(s.deviceId=r.id)}else s[t]=o[e]})),i.prev=30,i.next=33,fe.insertOrUpdate({data:s});case 33:i.next=42;break;case 35:if(i.prev=35,i.t1=i.catch(30),null===(u=fe.query().with("device").where("id",o.id).first())||null===u.device){i.next=41;break}return i.next=41,fe.get(u.device,o.id);case 41:throw new ye("devices-module.channels.update.failed",i.t1,"Edit channel failed.");case 42:return i.prev=42,c("CLEAR_SEMAPHORE",{type:n.routingKey===t.DevicesModule.CHANNELS_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),i.finish(42);case 45:return i.abrupt("return",!0);case 48:return i.abrupt("return",!1);case 49:case"end":return i.stop()}}),i,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(z(Se={},"SET_FIRST_LOAD",(function(e,t){e.firstLoad.push(t.id),e.firstLoad=C.default(e.firstLoad)})),z(Se,"SET_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items.push(t.id),e.semaphore.fetching.items=C.default(e.semaphore.fetching.items);break;case Te.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=C.default(e.semaphore.fetching.item);break;case Te.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=C.default(e.semaphore.creating);break;case Te.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=C.default(e.semaphore.updating);break;case Te.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=C.default(e.semaphore.deleting)}})),z(Se,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items.forEach((function(r,n){r===t.id&&e.semaphore.fetching.items.splice(n,1)}));break;case Te.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case Te.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case Te.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case Te.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),z(Se,"RESET_STATE",(function(e){Object.assign(e,rt)})),Se)},it=new O.default({modelPropertiesMapper:new be,jsonPropertiesMapper:new Re}),at={dataTransformer:function(e){return it.deserialize(e.data)}},ct=new k.default,ot={semaphore:{fetching:{items:[],item:[]},creating:[],updating:[],deleting:[]}},st={state:function(){return ot},actions:{get:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.prev=4,r.next=7,pe.api().get("".concat(Ne,"/v1/devices/").concat(t.channel.deviceId,"/channels/").concat(t.channel.id,"/properties/").concat(t.id),at);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new ge("devices-module.channel-properties.fetch.failed",r.t0,"Fetching channel property failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items.includes(t.channel.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.FETCHING,id:t.channel.id}),r.prev=4,r.next=7,pe.api().get("".concat(Ne,"/v1/devices/").concat(t.channel.deviceId,"/channels/").concat(t.channel.id,"/properties"),at);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new ge("devices-module.channel-properties.fetch.failed",r.t0,"Fetching channel properties failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:Te.FETCHING,id:t.channel.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},edit:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.property.id)){r.next=3;break}throw new Error("devices-module.channel-properties.update.inProgress");case 3:if(pe.query().where("id",t.property.id).exists()){r.next=5;break}throw new Error("devices-module.channel-properties.update.failed");case 5:return i("SET_SEMAPHORE",{type:Te.UPDATING,id:t.property.id}),r.prev=6,r.next=9,pe.update({where:t.property.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.property.id}),new ye("devices-module.channel-properties.update.failed",r.t0,"Edit channel property failed.");case 15:if(null!==(a=pe.find(t.property.id))){r.next=23;break}if(null===(c=fe.find(t.property.channelId))){r.next=21;break}return r.next=21,pe.get(c,t.property.id);case 21:throw i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.property.id}),new Error("devices-module.channel-properties.update.failed");case 23:if(null!==(o=fe.find(t.property.channelId))){r.next=26;break}throw new Error("devices-module.channel-properties.update.failed");case 26:return r.prev=26,r.next=29,pe.api().patch("".concat(Ne,"/v1/devices/").concat(o.deviceId,"/channels/").concat(a.channelId,"/properties/").concat(a.id),it.serialize({stuff:a}),at);case 29:return r.abrupt("return",pe.find(t.property.id));case 32:return r.prev=32,r.t1=r.catch(26),r.next=36,pe.get(o,t.property.id);case 36:throw new ge("devices-module.channel-properties.update.failed",r.t1,"Edit channel property failed.");case 37:return r.prev=37,i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.property.id}),r.finish(37);case 40:case"end":return r.stop()}}),r,null,[[6,11],[26,32,37,40]])})))()},transmitData:function(e,r){return $(regeneratorRuntime.mark((function e(){var n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pe.query().where("id",r.property.id).exists()){e.next=2;break}throw new Error("devices-module.channel-properties.transmit.failed");case 2:if(null!==(n=fe.find(r.property.channelId))){e.next=5;break}throw new Error("devices-module.channel-properties.transmit.failed");case 5:if(null!==(i=Ee.find(n.deviceId))){e.next=8;break}throw new Error("devices-module.channel-properties.transmit.failed");case 8:return a=r.property.value,e.prev=9,e.next=12,pe.update({where:r.property.id,data:{value:r.value}});case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(9),new ye("devices-module.channel-properties.transmit.failed",e.t0,"Edit channel property failed.");case 17:return e.abrupt("return",new Promise((function(e,c){pe.wamp().call({routing_key:t.DevicesModule.CHANNELS_PROPERTIES_DATA,origin:pe.$devicesModuleOrigin,data:{device:i.key,channel:n.key,property:r.property.key,expected:r.value}}).then((function(t){"accepted"===_.default(t.data,"response")?e(!0):(pe.update({where:r.property.id,data:{value:a}}),c(new Error("devices-module.channel-properties.transmit.failed")))})).catch((function(){pe.update({where:r.property.id,data:{value:a}}),c(new Error("devices-module.channel-properties.transmit.failed"))}))})));case 18:case"end":return e.stop()}}),e,null,[[9,14]])})))()},socketData:function(r,n){return $(regeneratorRuntime.mark((function i(){var a,c,o,s,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=r.state,c=r.commit,n.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){i.next=3;break}return i.abrupt("return",!1);case 3:if([t.DevicesModule.CHANNELS_PROPERTY_CREATED_ENTITY,t.DevicesModule.CHANNELS_PROPERTY_UPDATED_ENTITY,t.DevicesModule.CHANNELS_PROPERTY_DELETED_ENTITY].includes(n.routingKey)){i.next=5;break}return i.abrupt("return",!1);case 5:if(o=JSON.parse(n.data),!ct.compile(L)(o)){i.next=48;break}if(pe.query().where("id",o.id).exists()||n.routingKey!==t.DevicesModule.CHANNELS_PROPERTY_UPDATED_ENTITY&&n.routingKey!==t.DevicesModule.CHANNELS_PROPERTY_DELETED_ENTITY){i.next=10;break}throw new Error("devices-module.channel-properties.update.failed");case 10:if(n.routingKey!==t.DevicesModule.CHANNELS_PROPERTY_DELETED_ENTITY){i.next=25;break}return c("SET_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.prev=12,i.next=15,pe.delete(o.id);case 15:i.next=20;break;case 17:throw i.prev=17,i.t0=i.catch(12),new ye("devices-module.channel-properties.delete.failed",i.t0,"Delete channel property failed.");case 20:return i.prev=20,c("CLEAR_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.finish(20);case 23:i.next=45;break;case 25:if(n.routingKey!==t.DevicesModule.CHANNELS_PROPERTY_UPDATED_ENTITY||!a.semaphore.updating.includes(o.id)){i.next=27;break}return i.abrupt("return",!0);case 27:return c("SET_SEMAPHORE",{type:n.routingKey===t.DevicesModule.CHANNELS_PROPERTY_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),s={type:e.ChannelPropertyEntityTypes.PROPERTY},Object.keys(o).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("channel"===t){var r=fe.query().where("channel",o[e]).first();null!==r&&(s.channelId=r.id)}else s[t]=o[e]})),i.prev=30,i.next=33,pe.insertOrUpdate({data:s});case 33:i.next=42;break;case 35:if(i.prev=35,i.t1=i.catch(30),null===(u=pe.query().with("channel").where("id",o.id).first())||null===u.channel){i.next=41;break}return i.next=41,pe.get(u.channel,o.id);case 41:throw new ye("devices-module.channel-properties.update.failed",i.t1,"Edit channel property failed.");case 42:return i.prev=42,c("CLEAR_SEMAPHORE",{type:n.routingKey===t.DevicesModule.CHANNELS_PROPERTY_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),i.finish(42);case 45:return i.abrupt("return",!0);case 48:return i.abrupt("return",!1);case 49:case"end":return i.stop()}}),i,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(z(Oe={},"SET_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items.push(t.id),e.semaphore.fetching.items=C.default(e.semaphore.fetching.items);break;case Te.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=C.default(e.semaphore.fetching.item);break;case Te.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=C.default(e.semaphore.creating);break;case Te.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=C.default(e.semaphore.updating);break;case Te.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=C.default(e.semaphore.deleting)}})),z(Oe,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items.forEach((function(r,n){r===t.id&&e.semaphore.fetching.items.splice(n,1)}));break;case Te.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case Te.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case Te.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case Te.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),z(Oe,"RESET_STATE",(function(e){Object.assign(e,ot)})),Oe)},ut=new O.default({modelPropertiesMapper:new be,jsonPropertiesMapper:new Re}),dt={dataTransformer:function(e){return ut.deserialize(e.data)}},pt=new k.default,lt={semaphore:{fetching:{items:[],item:[]},creating:[],updating:[],deleting:[]}},ft={state:function(){return lt},actions:{get:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.prev=4,r.next=7,le.api().get("".concat(Ne,"/v1/devices/").concat(t.channel.deviceId,"/channels/").concat(t.channel.id,"/configuration/").concat(t.id),dt);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new ge("devices-module.channel-configuration.fetch.failed",r.t0,"Fetching channel configuration failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.items.includes(t.channel.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.FETCHING,id:t.channel.id}),r.prev=4,r.next=7,le.api().get("".concat(Ne,"/v1/devices/").concat(t.channel.deviceId,"/channels/").concat(t.channel.id,"/configuration"),dt);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new ge("devices-module.channel-configuration.fetch.failed",r.t0,"Fetching channel configuration failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:Te.FETCHING,id:t.channel.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},edit:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.configuration.id)){r.next=3;break}throw new Error("devices-module.channel-configuration.update.inProgress");case 3:if(le.query().where("id",t.configuration.id).exists()){r.next=5;break}throw new Error("devices-module.channel-configuration.update.failed");case 5:return i("SET_SEMAPHORE",{type:Te.UPDATING,id:t.configuration.id}),r.prev=6,r.next=9,le.update({where:t.configuration.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.configuration.id}),new ye("devices-module.channel-configuration.update.failed",r.t0,"Edit channel configuration failed.");case 15:if(null!==(a=le.find(t.configuration.id))){r.next=23;break}if(null===(c=fe.find(t.configuration.channelId))){r.next=21;break}return r.next=21,le.get(c,t.configuration.id);case 21:throw i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.configuration.id}),new Error("devices-module.channel-configuration.update.failed");case 23:if(null!==(o=fe.find(t.configuration.channelId))){r.next=26;break}throw new Error("devices-module.channel-configuration.update.failed");case 26:return r.prev=26,r.next=29,le.api().patch("".concat(Ne,"/v1/devices/").concat(o.deviceId,"/channels/").concat(a.channelId,"/configuration/").concat(a.id),ut.serialize({stuff:a}),dt);case 29:return r.abrupt("return",le.find(t.configuration.id));case 32:return r.prev=32,r.t1=r.catch(26),r.next=36,le.get(o,t.configuration.id);case 36:throw new ge("devices-module.channel-configuration.update.failed",r.t1,"Edit channel configuration failed.");case 37:return r.prev=37,i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.configuration.id}),r.finish(37);case 40:case"end":return r.stop()}}),r,null,[[6,11],[26,32,37,40]])})))()},transmitData:function(e,r){return $(regeneratorRuntime.mark((function e(){var n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(le.query().where("id",r.configuration.id).exists()){e.next=2;break}throw new Error("devices-module.channel-configuration.transmit.failed");case 2:if(null!==(n=fe.find(r.configuration.channelId))){e.next=5;break}throw new Error("devices-module.channel-configuration.transmit.failed");case 5:if(null!==(i=Ee.find(n.deviceId))){e.next=8;break}throw new Error("devices-module.channel-configuration.transmit.failed");case 8:return a=r.configuration.value,e.prev=9,e.next=12,le.update({where:r.configuration.id,data:{value:r.value}});case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(9),new ye("devices-module.channel-configuration.transmit.failed",e.t0,"Edit channel configuration failed.");case 17:return e.abrupt("return",new Promise((function(e,c){le.wamp().call({routing_key:t.DevicesModule.CHANNELS_CONFIGURATION_DATA,origin:le.$devicesModuleOrigin,data:{device:i.key,channel:n.key,configuration:r.configuration.key,expected:r.value}}).then((function(t){"accepted"===_.default(t.data,"response")?e(!0):(le.update({where:r.configuration.id,data:{value:a}}),c(new Error("devices-module.channel-configuration.transmit.failed")))})).catch((function(){le.update({where:r.configuration.id,data:{value:a}}),c(new Error("devices-module.channel-configuration.transmit.failed"))}))})));case 18:case"end":return e.stop()}}),e,null,[[9,14]])})))()},socketData:function(r,n){return $(regeneratorRuntime.mark((function i(){var a,c,o,s,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=r.state,c=r.commit,n.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){i.next=3;break}return i.abrupt("return",!1);case 3:if([t.DevicesModule.CHANNELS_CONFIGURATION_CREATED_ENTITY,t.DevicesModule.CHANNELS_CONFIGURATION_UPDATED_ENTITY,t.DevicesModule.CHANNELS_CONFIGURATION_DELETED_ENTITY].includes(n.routingKey)){i.next=5;break}return i.abrupt("return",!1);case 5:if(o=JSON.parse(n.data),!pt.compile(U)(o)){i.next=48;break}if(le.query().where("id",o.id).exists()||n.routingKey!==t.DevicesModule.CHANNELS_CONFIGURATION_UPDATED_ENTITY&&n.routingKey!==t.DevicesModule.CHANNELS_CONFIGURATION_DELETED_ENTITY){i.next=10;break}throw new Error("devices-module.channel-configuration.update.failed");case 10:if(n.routingKey!==t.DevicesModule.CHANNELS_CONFIGURATION_DELETED_ENTITY){i.next=25;break}return c("SET_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.prev=12,i.next=15,le.delete(o.id);case 15:i.next=20;break;case 17:throw i.prev=17,i.t0=i.catch(12),new ye("devices-module.channel-configuration.delete.failed",i.t0,"Delete channel configuration failed.");case 20:return i.prev=20,c("CLEAR_SEMAPHORE",{type:Te.DELETING,id:o.id}),i.finish(20);case 23:i.next=45;break;case 25:if(n.routingKey!==t.DevicesModule.CHANNELS_CONFIGURATION_UPDATED_ENTITY||!a.semaphore.updating.includes(o.id)){i.next=27;break}return i.abrupt("return",!0);case 27:return c("SET_SEMAPHORE",{type:n.routingKey===t.DevicesModule.CHANNELS_CONFIGURATION_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),s={type:e.ChannelConfigurationEntityTypes.CONFIGURATION},Object.keys(o).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));if("channel"===t){var r=fe.query().where("channel",o[e]).first();null!==r&&(s.channelId=r.id)}else s[t]=o[e]})),i.prev=30,i.next=33,le.insertOrUpdate({data:s});case 33:i.next=42;break;case 35:if(i.prev=35,i.t1=i.catch(30),null===(u=le.query().with("channel").where("id",o.id).first())||null===u.channel){i.next=41;break}return i.next=41,le.get(u.channel,o.id);case 41:throw new ye("devices-module.channel-configuration.update.failed",i.t1,"Edit channel configuration failed.");case 42:return i.prev=42,c("CLEAR_SEMAPHORE",{type:n.routingKey===t.DevicesModule.CHANNELS_CONFIGURATION_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:o.id}),i.finish(42);case 45:return i.abrupt("return",!0);case 48:return i.abrupt("return",!1);case 49:case"end":return i.stop()}}),i,null,[[12,17,20,23],[30,35,42,45]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(z(ke={},"SET_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items.push(t.id),e.semaphore.fetching.items=C.default(e.semaphore.fetching.items);break;case Te.GETTING:e.semaphore.fetching.item.push(t.id),e.semaphore.fetching.item=C.default(e.semaphore.fetching.item);break;case Te.CREATING:e.semaphore.creating.push(t.id),e.semaphore.creating=C.default(e.semaphore.creating);break;case Te.UPDATING:e.semaphore.updating.push(t.id),e.semaphore.updating=C.default(e.semaphore.updating);break;case Te.DELETING:e.semaphore.deleting.push(t.id),e.semaphore.deleting=C.default(e.semaphore.deleting)}})),z(ke,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items.forEach((function(r,n){r===t.id&&e.semaphore.fetching.items.splice(n,1)}));break;case Te.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===t.id&&e.semaphore.fetching.item.splice(n,1)}));break;case Te.CREATING:e.semaphore.creating.forEach((function(r,n){r===t.id&&e.semaphore.creating.splice(n,1)}));break;case Te.UPDATING:e.semaphore.updating.forEach((function(r,n){r===t.id&&e.semaphore.updating.splice(n,1)}));break;case Te.DELETING:e.semaphore.deleting.forEach((function(r,n){r===t.id&&e.semaphore.deleting.splice(n,1)}))}})),z(ke,"RESET_STATE",(function(e){Object.assign(e,lt)})),ke)},ht=new O.default({modelPropertiesMapper:new be,jsonPropertiesMapper:new Re}),vt={dataTransformer:function(e){return ht.deserialize(e.data)}},Et=new k.default,mt={semaphore:{fetching:{items:!1,item:[]},updating:[]},firstLoad:!1},gt={state:function(){return mt},getters:{firstLoadFinished:function(e){return function(){return!!e.firstLoad}},getting:function(e){return function(t){return e.semaphore.fetching.item.includes(t)}},fetching:function(e){return function(){return e.semaphore.fetching.items}}},actions:{get:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.fetching.item.includes(t.id)){r.next=3;break}return r.abrupt("return",!1);case 3:return i("SET_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.prev=4,r.next=7,he.api().get("".concat(Ne,"/v1/connectors/").concat(t.id),vt);case 7:return r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(4),new ge("devices-module.connectors.fetch.failed",r.t0,"Fetching connectors failed.");case 13:return r.prev=13,i("CLEAR_SEMAPHORE",{type:Te.GETTING,id:t.id}),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[4,10,13,16]])})))()},fetch:function(e){return $(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.state,n=e.commit,!r.semaphore.fetching.items){t.next=3;break}return t.abrupt("return",!1);case 3:return n("SET_SEMAPHORE",{type:Te.FETCHING}),t.prev=4,t.next=7,he.api().get("".concat(Ne,"/v1/connectors"),vt);case 7:return n("SET_FIRST_LOAD",!0),t.abrupt("return",!0);case 11:throw t.prev=11,t.t0=t.catch(4),new ge("devices-module.connectors.fetch.failed",t.t0,"Fetching connectors failed.");case 14:return t.prev=14,n("CLEAR_SEMAPHORE",{type:Te.FETCHING}),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[4,11,14,17]])})))()},edit:function(e,t){return $(regeneratorRuntime.mark((function r(){var n,i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.state,i=e.commit,!n.semaphore.updating.includes(t.connector.id)){r.next=3;break}throw new Error("devices-module.connectors.update.inProgress");case 3:if(he.query().where("id",t.connector.id).exists()){r.next=5;break}throw new Error("devices-module.connectors.update.failed");case 5:return i("SET_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),r.prev=6,r.next=9,he.update({where:t.connector.id,data:t.data});case 9:r.next=15;break;case 11:throw r.prev=11,r.t0=r.catch(6),i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),new ye("devices-module.connectors.update.failed",r.t0,"Edit connector failed.");case 15:if(null!==(a=he.find(t.connector.id))){r.next=21;break}return r.next=19,he.get(t.connector.id);case 19:throw i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),new Error("devices-module.connectors.update.failed");case 21:return r.prev=21,r.next=24,he.api().patch("".concat(Ne,"/v1/connectors/").concat(a.id),ht.serialize({stuff:a}),vt);case 24:return r.abrupt("return",he.find(t.connector.id));case 27:return r.prev=27,r.t1=r.catch(21),r.next=31,he.get(t.connector.id);case 31:throw new ge("devices-module.connectors.update.failed",r.t1,"Edit connector failed.");case 32:return r.prev=32,i("CLEAR_SEMAPHORE",{type:Te.UPDATING,id:t.connector.id}),r.finish(32);case 35:case"end":return r.stop()}}),r,null,[[6,11],[21,27,32,35]])})))()},transmitCommand:function(e,r){if(!he.query().where("id",r.connector.id).exists())throw new Error("devices-module.connector.transmit.failed");return new Promise((function(e,n){he.wamp().call({routing_key:t.DevicesModule.CONNECTOR_CONTROLS,origin:he.$devicesModuleOrigin,data:{control:r.command,connector:r.connector.id}}).then((function(t){"accepted"===_.default(t.data,"response")?e(!0):n(new Error("devices-module.connector.transmit.failed"))})).catch((function(){n(new Error("devices-module.connector.transmit.failed"))}))}))},socketData:function(e,r){return $(regeneratorRuntime.mark((function n(){var i,a,c,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.state,a=e.commit,r.origin===t.ModuleOrigin.MODULE_DEVICES_ORIGIN){n.next=3;break}return n.abrupt("return",!1);case 3:if([t.DevicesModule.CONNECTOR_CREATED_ENTITY,t.DevicesModule.CONNECTOR_UPDATED_ENTITY,t.DevicesModule.CONNECTOR_DELETED_ENTITY].includes(r.routingKey)){n.next=5;break}return n.abrupt("return",!1);case 5:if(c=JSON.parse(r.data),!Et.compile(Y)(c)){n.next=46;break}if(he.query().where("id",c.id).exists()||r.routingKey!==t.DevicesModule.CONNECTOR_UPDATED_ENTITY&&r.routingKey!==t.DevicesModule.CONNECTOR_DELETED_ENTITY){n.next=10;break}throw new Error("devices-module.connectors.update.failed");case 10:if(r.routingKey!==t.DevicesModule.CONNECTOR_DELETED_ENTITY){n.next=25;break}return a("SET_SEMAPHORE",{type:Te.DELETING,id:c.id}),n.prev=12,n.next=15,he.delete(c.id);case 15:n.next=20;break;case 17:throw n.prev=17,n.t0=n.catch(12),new ye("devices-module.connectors.delete.failed",n.t0,"Delete connector failed.");case 20:return n.prev=20,a("CLEAR_SEMAPHORE",{type:Te.DELETING,id:c.id}),n.finish(20);case 23:n.next=43;break;case 25:if(r.routingKey!==t.DevicesModule.CONNECTOR_UPDATED_ENTITY||!i.semaphore.updating.includes(c.id)){n.next=27;break}return n.abrupt("return",!0);case 27:return a("SET_SEMAPHORE",{type:r.routingKey===t.DevicesModule.CONNECTOR_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:c.id}),o={},Object.keys(c).forEach((function(e){var t=e.replace(/([a-z][A-Z0-9])/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));o[t]=c[e]})),n.prev=30,n.next=33,he.insertOrUpdate({data:o});case 33:n.next=40;break;case 35:return n.prev=35,n.t1=n.catch(30),n.next=39,he.get(c.id);case 39:throw new ye("devices-module.connectors.update.failed",n.t1,"Edit connector failed.");case 40:return n.prev=40,a("CLEAR_SEMAPHORE",{type:r.routingKey===t.DevicesModule.CONNECTOR_UPDATED_ENTITY?Te.UPDATING:Te.CREATING,id:c.id}),n.finish(40);case 43:return n.abrupt("return",!0);case 46:return n.abrupt("return",!1);case 47:case"end":return n.stop()}}),n,null,[[12,17,20,23],[30,35,40,43]])})))()},reset:function(e){(0,e.commit)("RESET_STATE")}},mutations:(z(_e={},"SET_FIRST_LOAD",(function(e,t){e.firstLoad=t})),z(_e,"SET_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items=!0;break;case Te.GETTING:e.semaphore.fetching.item.push(_.default(t,"id","notValid")),e.semaphore.fetching.item=C.default(e.semaphore.fetching.item);break;case Te.UPDATING:e.semaphore.updating.push(_.default(t,"id","notValid")),e.semaphore.updating=C.default(e.semaphore.updating)}})),z(_e,"CLEAR_SEMAPHORE",(function(e,t){switch(t.type){case Te.FETCHING:e.semaphore.fetching.items=!1;break;case Te.GETTING:e.semaphore.fetching.item.forEach((function(r,n){r===_.default(t,"id","notValid")&&e.semaphore.fetching.item.splice(n,1)}));break;case Te.UPDATING:e.semaphore.updating.forEach((function(r,n){r===_.default(t,"id","notValid")&&e.semaphore.updating.splice(n,1)}))}})),z(_e,"RESET_STATE",(function(e){Object.assign(e,mt)})),_e)};e.ConnectorEntityTypes=void 0,(Ce=e.ConnectorEntityTypes||(e.ConnectorEntityTypes={})).FB_BUS="devices-module/connector-fb-bus",Ce.FB_MQTT_V1="devices-module/connector-fb-mqtt-v1";var yt=function(e,r){yt.installed||(yt.installed=!0,void 0!==r.originName?e.Model.prototype.$devicesModuleOrigin=r.originName:e.Model.prototype.$devicesModuleOrigin=t.ModuleOrigin.MODULE_DEVICES_ORIGIN,r.database.register(Ee,He),r.database.register(se,je),r.database.register(de,ze),r.database.register(ve,Qe),r.database.register(fe,nt),r.database.register(pe,st),r.database.register(le,ft),r.database.register(he,gt))},Tt={install:yt};return e.Channel=fe,e.ChannelConfiguration=le,e.ChannelProperty=pe,e.Connector=he,e.Device=Ee,e.DeviceConfiguration=de,e.DeviceConnector=ve,e.DeviceProperty=se,e.default=Tt,Object.defineProperty(e,"__esModule",{value:!0}),e}({},ModulesMetadata,OrmCore,capitalize,DeviceExchangeEntitySchema,Jsona,Ajv,v4,get,uniq,defineRelationGetter,clone,DevicePropertyExchangeEntitySchema,DeviceConfigurationExchangeEntitySchema,DeviceConnectorExchangeEntitySchema,ChannelExchangeEntitySchema,ChannelPropertyExchangeEntitySchema,ChannelConfigurationExchangeEntitySchema,ConnectorExchangeEntitySchema);